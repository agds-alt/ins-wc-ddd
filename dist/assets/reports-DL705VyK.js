import{h as e,j as s,Y as t,t as n,r,X as a,M as l,K as i,U as o,O as c,C as d,F as x,m,d as h,x as u,_ as g,e as p,$ as b,y as j,w as y,D as f}from"./react-vendor-B7zQ2Eq0.js";import{s as v,u as N,S as w,B as _,C as M,a as k}from"./admin-DR-prBnq.js";import{c as S,g as C,I}from"./inspection-Crqn3n7A.js";import{f as A,a as D,e as E,b as R,i as F,c as P,d as T,g as q,s as O,h as $}from"./date-vendor-CSGrVI8S.js";const z=(s,t)=>e({queryKey:["monthly-inspections",s,A(t,"yyyy-MM")],queryFn:async()=>{if(!s)return[];const e=A(D(t),"yyyy-MM-dd"),n=A(E(t),"yyyy-MM-dd"),{data:r,error:a}=await v.from("inspection_records").select("\n          id,\n          inspection_date,\n          inspection_time,\n          overall_status,\n          responses,\n          photo_urls,\n          notes,\n          location:locations!inner(id, name, building, floor),\n          user:users!inspection_records_user_id_fkey(id, full_name)\n        ").eq("user_id",s).gte("inspection_date",e).lte("inspection_date",n).order("inspection_date",{ascending:!1}).order("inspection_time",{ascending:!1});if(a)throw a;const l=(r||[]).reduce((e,s)=>{const t=s.inspection_date;return e[t]||(e[t]=[]),e[t].push({id:s.id,inspection_date:s.inspection_date,inspection_time:s.inspection_time,overall_status:s.overall_status,responses:s.responses,location:s.location,user:s.user,photo_urls:s.photo_urls||[],notes:s.notes}),e},{});return Object.entries(l).map(([e,s])=>{const t=s.map(e=>(e=>{if(!e)return 0;if("number"==typeof e.score)return e.score;if(Array.isArray(e.ratings)&&e.ratings.length>0)return S(e.ratings);const s=Object.values(e).filter(e=>"string"==typeof e||"boolean"==typeof e);if(0===s.length)return 0;const t=s.filter(e=>!0===e||"good"===e||"excellent"===e||"baik"===e||"bersih"===e).length;return Math.round(t/s.length*100)})(e.responses));return{date:e,inspections:s,averageScore:t.length>0?Math.round(t.reduce((e,s)=>e+s,0)/t.length):0,count:s.length}})},enabled:!!s}),Y=({currentDate:e,onDateChange:r,dateInspections:a,onDateClick:l})=>{const i=D(e),o=E(e),c=R({start:i,end:o}),d=i.getDay(),x=Array(d).fill(null);return s.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100",children:[s.jsxs("div",{className:"p-4 border-b border-gray-100",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("button",{onClick:()=>{r(P(e,1))},className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:s.jsx(t,{className:"w-5 h-5 text-gray-600"})}),s.jsx("h2",{className:"text-lg font-bold text-gray-900",children:A(e,"MMMM yyyy")}),s.jsx("button",{onClick:()=>{r(T(e,1))},className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:s.jsx(n,{className:"w-5 h-5 text-gray-600"})})]}),s.jsx("div",{className:"grid grid-cols-7 gap-1 mt-4",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(e=>s.jsx("div",{className:"text-center text-xs font-medium text-gray-500 py-2",children:e},e))})]}),s.jsx("div",{className:"p-2",children:s.jsxs("div",{className:"grid grid-cols-7 gap-1",children:[x.map((e,t)=>s.jsx("div",{className:"aspect-square"},`empty-${t}`)),c.map(e=>{const t=(e=>{const s=A(e,"yyyy-MM-dd");return a.find(e=>e.date===s)})(e),n=t&&t.count>0,r=F(e),i=A(e,"yyyy-MM-dd");return s.jsxs("button",{onClick:()=>n&&l(i),disabled:!n,className:`\n                  aspect-square p-1 rounded-lg transition-all relative\n                  ${r?"ring-2 ring-blue-500":""}\n                  ${n?"hover:bg-gray-50 cursor-pointer active:scale-95":"cursor-default opacity-40"}\n                `,children:[s.jsx("div",{className:`\n                  text-sm font-medium\n                  ${r?"text-blue-600 font-bold":"text-gray-700"}\n                `,children:A(e,"d")}),n&&s.jsx("div",{className:"absolute bottom-1 left-1/2 transform -translate-x-1/2",children:s.jsx("div",{className:"w-1.5 h-1.5 rounded-full "+(o=t.averageScore,o>=85?"bg-green-500":o>=70?"bg-yellow-500":"bg-red-500")})})]},e.toISOString());var o})]})}),s.jsxs("div",{className:"p-4 border-t border-gray-100 flex items-center justify-center space-x-4 text-xs text-gray-600",children:[s.jsxs("div",{className:"flex items-center space-x-1",children:[s.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500"}),s.jsx("span",{children:"Good (85+)"})]}),s.jsxs("div",{className:"flex items-center space-x-1",children:[s.jsx("div",{className:"w-2 h-2 rounded-full bg-yellow-500"}),s.jsx("span",{children:"Fair (70-84)"})]}),s.jsxs("div",{className:"flex items-center space-x-1",children:[s.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500"}),s.jsx("span",{children:"Poor (<70)"})]})]})]})},L=({isOpen:e,onClose:t,inspections:n,selectedDate:o,onInspectionClick:c})=>{const[d,x]=r.useState(0),[m,h]=r.useState(0),[u,g]=r.useState(!1);if(r.useEffect(()=>(document.body.style.overflow=e?"hidden":"unset",()=>{document.body.style.overflow="unset"}),[e]),!e)return null;const p=A(new Date(o),"EEEE, MMMM d, yyyy");return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 transition-opacity",onClick:t}),s.jsxs("div",{className:"fixed bottom-0 left-0 right-0 bg-white rounded-t-3xl shadow-2xl z-50 max-h-[80vh] flex flex-col transition-transform",style:{transform:`translateY(${m}px)`},children:[s.jsx("div",{className:"py-3 flex justify-center cursor-grab active:cursor-grabbing",onTouchStart:e=>{x(e.touches[0].clientY),g(!0)},onTouchMove:e=>{if(!u)return;const s=e.touches[0].clientY-d;s>0&&h(s)},onTouchEnd:()=>{g(!1),m>100&&t(),h(0)},children:s.jsx("div",{className:"w-12 h-1.5 bg-gray-300 rounded-full"})}),s.jsx("div",{className:"px-6 pb-4 border-b border-gray-100",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"Inspections"}),s.jsx("p",{className:"text-sm text-gray-600 mt-0.5",children:p}),s.jsx("div",{className:"flex items-center space-x-2 mt-2",children:s.jsxs("span",{className:"px-2 py-1 bg-blue-100 text-blue-700 text-xs font-medium rounded-full",children:[n.length," inspection",n.length>1?"s":""]})})]}),s.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:s.jsx(a,{className:"w-5 h-5 text-gray-600"})})]})}),s.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-4 space-y-3",children:n.map(e=>{var t;const n=(null==(t=e.responses)?void 0:t.score)||0,r=(e=>e>=85?"bg-green-100 text-green-700 border-green-200":e>=70?"bg-yellow-100 text-yellow-700 border-yellow-200":"bg-red-100 text-red-700 border-red-200")(n),a=(e=>e>=85?"ðŸ˜Š":e>=70?"ðŸ˜":"ðŸ˜Ÿ")(n);return s.jsxs("button",{onClick:()=>c(e),className:"w-full bg-gray-50 rounded-xl p-4 hover:bg-gray-100 transition-colors active:scale-[0.98] text-left",children:[s.jsxs("div",{className:"flex items-start justify-between space-x-3",children:[s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[s.jsx(l,{className:"w-4 h-4 text-blue-600 flex-shrink-0"}),s.jsx("h3",{className:"font-semibold text-gray-900 truncate",children:e.location.name})]}),s.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.location.building&&s.jsxs("p",{className:"truncate",children:["ðŸ¢ ",e.location.building," â€¢ ",e.location.floor]}),s.jsxs("div",{className:"flex items-center space-x-1",children:[s.jsx(i,{className:"w-3.5 h-3.5"}),s.jsx("span",{children:e.inspection_time})]})]}),e.photo_urls.length>0&&s.jsx("div",{className:"mt-2",children:s.jsxs("span",{className:"text-xs text-gray-500",children:["ðŸ“¸ ",e.photo_urls.length," photo",e.photo_urls.length>1?"s":""]})})]}),s.jsxs("div",{className:"flex flex-col items-end flex-shrink-0",children:[s.jsxs("div",{className:`\n                      px-3 py-2 rounded-xl border-2 font-bold\n                      flex items-center space-x-1.5\n                      ${r}\n                    `,children:[s.jsx("span",{className:"text-lg",children:a}),s.jsx("span",{className:"text-xl",children:n})]}),s.jsx("span",{className:"text-xs text-gray-500 mt-1",children:"Score"})]})]}),e.notes&&s.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:s.jsxs("p",{className:"text-sm text-gray-600 line-clamp-2",children:["ðŸ’¬ ",e.notes]})})]},e.id)})})]})]})},H=(e,s)=>{if("aroma"===s)switch(e){case"good":return"ðŸŒ¸";case"normal":return"ðŸ˜";case"bad":return"ðŸ¤¢";case"other":return"ðŸ’¬";default:return"â“"}if("visual"===s)switch(e){case"good":return"âœ¨";case"normal":return"ðŸ˜";case"bad":return"ðŸ’©";case"other":return"ðŸ’¬";default:return"â“"}if("availability"===s||"functional"===s)switch(e){case"good":return"âœ…";case"normal":return"âš ï¸";case"bad":return"âŒ";case"other":return"ðŸ’¬";default:return"â“"}return"â“"},G=e=>{switch(e){case"good":return"bg-green-50 text-green-700 border-green-200";case"normal":return"bg-yellow-50 text-yellow-700 border-yellow-200";case"bad":return"bg-red-50 text-red-700 border-red-200";case"other":return"bg-blue-50 text-blue-700 border-blue-200";default:return"bg-gray-50 text-gray-700 border-gray-200"}},K=({isOpen:e,onClose:t,inspection:n})=>{var r,l,m,h;if(!e||!n)return null;const u=n.responses,g=(e=>{if(!e)return 0;if("number"==typeof e.score)return e.score;if(Array.isArray(e.ratings)&&e.ratings.length>0)return S(e.ratings);const s=Object.values(e).filter(e=>"string"==typeof e||"boolean"==typeof e);if(0===s.length)return 0;const t=s.filter(e=>!0===e||"good"===e||"excellent"===e||"baik"===e).length;return Math.round(t/s.length*100)})(u),p=C(g),b=(null==u?void 0:u.ratings)||[],j=null==u?void 0:u.issues,y=null==u?void 0:u.maintenance,f=(null==u?void 0:u.inspection_mode)||"professional",v=A(new Date(n.inspection_date),"EEEE, MMMM d, yyyy");return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 backdrop-blur-sm",onClick:t}),s.jsx("div",{className:"fixed inset-x-4 top-1/2 -translate-y-1/2 max-w-2xl mx-auto z-50 max-h-[90vh] overflow-hidden",children:s.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl overflow-hidden",children:[s.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 p-6 text-white relative",children:[s.jsx("button",{onClick:t,className:"absolute top-4 right-4 p-2 hover:bg-white/20 rounded-xl transition-colors",children:s.jsx(a,{className:"w-5 h-5"})}),s.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[s.jsx("div",{className:"w-14 h-14 bg-white/20 rounded-xl flex items-center justify-center text-3xl",children:"ðŸš½"}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold",children:null==(r=n.location)?void 0:r.name}),s.jsxs("p",{className:"text-blue-100 text-sm",children:[null==(l=n.location)?void 0:l.building," â€¢ ",null==(m=n.location)?void 0:m.floor]})]})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("span",{className:"text-blue-100 text-sm",children:"Inspection Score:"}),s.jsxs("div",{className:"bg-white/90 px-4 py-2 rounded-full",children:[s.jsx("span",{className:"text-2xl font-bold text-blue-600",children:g}),s.jsx("span",{className:"text-sm text-gray-600 ml-1",children:"/ 100"})]})]}),s.jsxs("div",{className:"bg-white/20 px-3 py-1 rounded-full text-sm",children:[p.emoji," ",p.label]})]})]}),s.jsxs("div",{className:"overflow-y-auto max-h-[calc(90vh-200px)] p-6 space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{className:"flex items-center space-x-2 text-gray-600",children:[s.jsx(i,{className:"w-4 h-4"}),s.jsxs("div",{className:"text-sm",children:[s.jsx("p",{className:"font-medium text-gray-900",children:v}),s.jsx("p",{className:"text-xs",children:n.inspection_time})]})]}),s.jsxs("div",{className:"flex items-center space-x-2 text-gray-600",children:[s.jsx(o,{className:"w-4 h-4"}),s.jsxs("div",{className:"text-sm",children:[s.jsx("p",{className:"font-medium text-gray-900",children:null==(h=n.user)?void 0:h.full_name}),s.jsxs("p",{className:"text-xs capitalize",children:[f," mode"]})]})]})]}),s.jsxs("div",{children:[s.jsxs("h3",{className:"font-bold text-gray-900 mb-3 flex items-center space-x-2",children:[s.jsx("span",{children:"ðŸ“‹"}),s.jsx("span",{children:"Component Ratings"})]}),s.jsx("div",{className:"space-y-3",children:b.map((e,t)=>{const n=I.find(s=>s.id===e.component);return n?s.jsx("div",{className:`rounded-xl p-4 border-2 ${G(e.choice)}`,children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[s.jsx("span",{className:"text-xl",children:"genz"===f?n.iconGenZ:n.icon}),s.jsx("span",{className:"font-medium text-gray-900",children:n.label})]}),e.notes&&s.jsxs("p",{className:"text-sm text-gray-600 mt-2 pl-7",children:["ðŸ’¬ ",e.notes]})]}),s.jsxs("div",{className:"flex items-center space-x-1 flex-shrink-0 ml-3",children:[s.jsx("span",{className:"text-2xl",children:H(e.choice,n.category)}),s.jsx("span",{className:"text-sm font-medium capitalize",children:e.choice})]})]})},t):null})})]}),j&&s.jsx("div",{className:"bg-orange-50 border-2 border-orange-200 rounded-xl p-4",children:s.jsxs("div",{className:"flex items-start space-x-2",children:[s.jsx(c,{className:"w-5 h-5 text-orange-600 mt-0.5"}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold text-orange-900 mb-1",children:"Issues Found"}),s.jsx("p",{className:"text-sm text-orange-800",children:j.description})]})]})}),y&&y.required&&s.jsx("div",{className:`\n                border-2 rounded-xl p-4\n                ${"urgent"===y.priority?"bg-red-50 border-red-200":"high"===y.priority?"bg-orange-50 border-orange-200":"medium"===y.priority?"bg-yellow-50 border-yellow-200":"bg-blue-50 border-blue-200"}\n              `,children:s.jsxs("div",{className:"flex items-start space-x-2",children:[s.jsx("span",{className:"text-xl",children:"ðŸ”§"}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold text-gray-900 mb-1",children:"Maintenance Required"}),s.jsxs("p",{className:"text-sm text-gray-700",children:["Priority: ",s.jsx("span",{className:"font-semibold capitalize",children:y.priority})]})]})]})}),n.photo_urls&&n.photo_urls.length>0&&s.jsxs("div",{children:[s.jsxs("h3",{className:"font-bold text-gray-900 mb-3 flex items-center space-x-2",children:[s.jsx(d,{className:"w-5 h-5"}),s.jsxs("span",{children:["Photos (",n.photo_urls.length,")"]})]}),s.jsx("div",{className:"grid grid-cols-3 gap-3",children:n.photo_urls.map((e,t)=>s.jsx("a",{href:e,target:"_blank",rel:"noopener noreferrer",className:"aspect-square rounded-xl overflow-hidden hover:opacity-80 transition-opacity",children:s.jsx("img",{src:e,alt:`Photo ${t+1}`,className:"w-full h-full object-cover"})},t))})]}),n.notes&&s.jsx("div",{className:"bg-gray-50 rounded-xl p-4",children:s.jsxs("div",{className:"flex items-start space-x-2",children:[s.jsx(x,{className:"w-5 h-5 text-gray-600 mt-0.5"}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold text-gray-900 mb-1",children:"General Notes"}),s.jsx("p",{className:"text-sm text-gray-700",children:n.notes})]})]})})]})]})})]})},U=Object.freeze(Object.defineProperty({__proto__:null,ReportsPage:()=>{const{user:t}=N(),[n,a]=r.useState(new Date),[l,i]=r.useState(null),[o,c]=r.useState(null),[d,g]=r.useState(!1),{data:p,isLoading:b}=z(null==t?void 0:t.id,n),{data:j}=(y=null==t?void 0:t.id,e({queryKey:["date-inspections",y,f=l||""],queryFn:async()=>{if(!y||!f)return[];const{data:e,error:s}=await v.from("inspection_records").select("\n          id,\n          inspection_date,\n          inspection_time,\n          overall_status,\n          responses,\n          photo_urls,\n          notes,\n          location:locations!inner(id, name, building, floor),\n          user:users!inspection_records_user_id_fkey(id, full_name)\n        ").eq("user_id",y).eq("inspection_date",f).order("inspection_time",{ascending:!1});if(s)throw s;return(e||[]).map(e=>({id:e.id,inspection_date:e.inspection_date,inspection_time:e.inspection_time,overall_status:e.overall_status,responses:e.responses,location:e.location,user:e.user,photo_urls:e.photo_urls||[],notes:e.notes}))},enabled:!!y&&!!f}));var y,f;const M=(null==p?void 0:p.reduce((e,s)=>e+s.count,0))||0,k=p&&p.length>0?Math.round(p.reduce((e,s)=>e+s.averageScore*s.count,0)/M):0;return b?s.jsx("div",{className:"min-h-screen bg-white flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600 text-sm",children:"Loading reports..."})]})}):s.jsxs("div",{className:"min-h-screen bg-white pb-24",children:[s.jsx(w,{isOpen:d,onClose:()=>g(!1)}),s.jsxs("div",{className:"bg-white p-6 border-b border-gray-100",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("button",{onClick:()=>g(!0),className:"w-10 h-10 bg-white rounded-full flex items-center justify-center shadow-md hover:shadow-lg transition-shadow border border-gray-100",children:s.jsx(m,{className:"w-5 h-5 text-gray-600"})}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Reports"}),s.jsx("p",{className:"text-sm text-gray-500",children:"Inspection history & analytics"})]})]}),s.jsx(h,{className:"w-6 h-6 text-gray-400"})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsxs("div",{className:"bg-white rounded-2xl shadow-[0_8px_30px_rgb(0,0,0,0.08)] border border-gray-50 p-4",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[s.jsx(x,{className:"w-4 h-4 text-blue-600"}),s.jsx("span",{className:"text-xs text-gray-500",children:"This Month"})]}),s.jsx("div",{className:"text-2xl font-bold text-gray-900",children:M}),s.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Inspections"})]}),s.jsxs("div",{className:"bg-white rounded-2xl shadow-[0_8px_30px_rgb(0,0,0,0.08)] border border-gray-50 p-4",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[s.jsx(u,{className:"w-4 h-4 text-green-600"}),s.jsx("span",{className:"text-xs text-gray-500",children:"Average"})]}),s.jsx("div",{className:"text-2xl font-bold text-gray-900",children:k}),s.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Score"})]})]})]}),s.jsxs("div",{className:"p-4 space-y-4",children:[s.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4",children:s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx("div",{className:"text-2xl",children:"ðŸ’¡"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"text-sm font-medium text-blue-900 mb-1",children:"Tap a date to view inspections"}),s.jsxs("p",{className:"text-xs text-blue-700",children:["Colored dots indicate average scores:",s.jsx("span",{className:"font-semibold",children:" Green"})," (excellent),",s.jsx("span",{className:"font-semibold",children:" Yellow"})," (good),",s.jsx("span",{className:"font-semibold",children:" Red"})," (needs work)"]})]})]})}),s.jsx(Y,{currentDate:n,onDateChange:a,dateInspections:p||[],onDateClick:e=>{i(e)}}),(!p||0===p.length)&&s.jsxs("div",{className:"bg-white rounded-xl p-8 text-center",children:[s.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“…"}),s.jsx("h3",{className:"font-bold text-gray-900 mb-2",children:"No inspections yet"}),s.jsx("p",{className:"text-gray-600 text-sm",children:"Start inspecting locations to see them here"})]})]}),s.jsx(L,{isOpen:!!l,onClose:()=>{i(null)},inspections:j||[],selectedDate:l||"",onInspectionClick:e=>{c(e)}}),s.jsx(K,{isOpen:!!o,onClose:()=>{c(null)},inspection:o}),s.jsx(_,{})]})}},Symbol.toStringTag,{value:"Module"})),W=Object.freeze(Object.defineProperty({__proto__:null,AnalyticsPage:()=>{const{user:t}=N(),[n,a]=r.useState("week"),[o,c]=r.useState(!1),[d,x]=r.useState(!1),{data:h,isLoading:S,error:C}=e({queryKey:["analytics",null==t?void 0:t.id,n],queryFn:async()=>{if(!(null==t?void 0:t.id))throw new Error("User not authenticated");const e=new Date;let s,r=A(e,"yyyy-MM-dd");switch(n){case"week":default:s=A(q(e),"yyyy-MM-dd");break;case"month":s=A(D(e),"yyyy-MM-dd");break;case"year":s=A(new Date(e.getFullYear(),0,1),"yyyy-MM-dd")}const{data:a,error:l}=await v.from("inspection_records").select("\n          id,\n          inspection_date,\n          inspection_time,\n          responses,\n          location_id,\n          locations (\n            id,\n            name,\n            building,\n            floor\n          )\n        ").eq("user_id",t.id).gte("inspection_date",s).lte("inspection_date",r).order("inspection_date",{ascending:!0});if(l)throw l;const i=e=>{try{if(!e||"object"!=typeof e)return 0;const s=Object.values(e);if(0===s.length)return 0;const t=s.filter(e=>{if("boolean"==typeof e)return e;if("string"==typeof e){const s=e.toLowerCase().trim();return["good","excellent","baik","bersih","ada","yes","true","ok","lengkap"].includes(s)}return"number"==typeof e&&e>0}).length;return Math.round(t/s.length*100)}catch(s){return 0}},o=new Map;null==a||a.forEach(e=>{try{const s=e.inspection_date,t=i(e.responses);o.has(s)||o.set(s,{count:0,totalScore:0});const n=o.get(s);n.count++,n.totalScore+=t}catch(s){}});const c=Array.from(o.entries()).map(([e,s])=>({date:e,count:s.count,avgScore:s.count>0?Math.round(s.totalScore/s.count):0})),d=new Map;null==a||a.forEach(e=>{try{if(e.inspection_time&&"string"==typeof e.inspection_time){const s=e.inspection_time.split(":");if(s.length>0){const e=s[0],t=parseInt(e);!isNaN(t)&&t>=0&&t<=23&&d.set(t,(d.get(t)||0)+1)}}}catch(s){}});const x=Array.from(d.entries()).map(([e,s])=>({hour:e,count:s})).sort((e,s)=>e.hour-s.hour),m=x.length>0?x.reduce((e,s)=>s.count>e.count?s:e):null,h=new Map;null==a||a.forEach(e=>{try{if(!e.locations)return;const s=e.location_id,t=i(e.responses);h.has(s)||h.set(s,{name:e.locations.name||"Unknown Location",building:e.locations.building||void 0,floor:e.locations.floor||void 0,scores:[],count:0});const n=h.get(s);n.scores.push(t),n.count++}catch(s){}});const u=Array.from(h.entries()).map(([e,s])=>{const t=s.scores.length>0?Math.round(s.scores.reduce((e,s)=>e+s,0)/s.scores.length):0,n=s.scores.length>=2?s.scores[s.scores.length-1]-s.scores[0]:0;return{id:e,name:s.name,building:s.building,floor:s.floor,avgScore:t,count:s.count,trend:n}}).sort((e,s)=>s.avgScore-e.avgScore),g={excellent:0,good:0,fair:0,poor:0};null==a||a.forEach(e=>{try{const s=i(e.responses);s>=85?g.excellent++:s>=70?g.good++:s>=50?g.fair++:g.poor++}catch(s){}});const p=(null==a?void 0:a.length)||0,b=p>0?Math.round(a.reduce((e,s)=>e+i(s.responses),0)/p):0;let j,y;try{switch(n){case"week":default:j=A(O(q(e),7),"yyyy-MM-dd"),y=A(O($(e),7),"yyyy-MM-dd");break;case"month":const s=new Date(e.getFullYear(),e.getMonth()-1,1);j=A(s,"yyyy-MM-dd"),y=A(new Date(s.getFullYear(),s.getMonth()+1,0),"yyyy-MM-dd");break;case"year":j=A(new Date(e.getFullYear()-1,0,1),"yyyy-MM-dd"),y=A(new Date(e.getFullYear()-1,11,31),"yyyy-MM-dd")}const{data:s}=await v.from("inspection_records").select("id, responses").eq("user_id",t.id).gte("inspection_date",j).lte("inspection_date",y),r=(null==s?void 0:s.length)||0,a=r>0?Math.round(s.reduce((e,s)=>e+i(s.responses),0)/r):0;return{totalInspections:p,avgScore:b,scoreChange:b-a,countChange:p-r,dailyTrend:c,hourlyDistribution:x,peakHour:m,locationPerformance:u,scoreRanges:g,topPerformer:u[0]||null,needsAttention:u.filter(e=>e.avgScore<70)}}catch(f){return{totalInspections:p,avgScore:b,scoreChange:0,countChange:0,dailyTrend:c,hourlyDistribution:x,peakHour:m,locationPerformance:u,scoreRanges:g,topPerformer:u[0]||null,needsAttention:u.filter(e=>e.avgScore<70)}}},enabled:!!(null==t?void 0:t.id),retry:2,staleTime:3e5}),I={week:"This Week",month:"This Month",year:"This Year"};return C?s.jsx("div",{className:"min-h-screen bg-white flex items-center justify-center p-4",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx(g,{className:"w-8 h-8 text-red-600"})}),s.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:"Failed to Load Analytics"}),s.jsx("p",{className:"text-gray-600 mb-4",children:C instanceof Error?C.message:"An unexpected error occurred"}),s.jsx("button",{onClick:()=>window.location.reload(),className:"px-6 py-3 bg-blue-600 text-white rounded-xl font-medium hover:bg-blue-700 transition-colors",children:"Retry"})]})}):S?s.jsx("div",{className:"min-h-screen bg-white flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600 text-sm",children:"Loading analytics..."})]})}):s.jsxs("div",{className:"min-h-screen bg-white pb-24",children:[s.jsx(w,{isOpen:d,onClose:()=>x(!1)}),s.jsxs("div",{className:"bg-white p-6 border-b border-gray-100",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("button",{onClick:()=>x(!0),className:"w-10 h-10 bg-white rounded-full flex items-center justify-center shadow-md hover:shadow-lg transition-shadow border border-gray-100",children:s.jsx(m,{className:"w-5 h-5 text-gray-600"})}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Analytics"}),s.jsx("p",{className:"text-sm text-gray-500",children:"Performance insights & trends"})]})]}),s.jsx(p,{className:"w-6 h-6 text-gray-400"})]}),s.jsxs("div",{className:"relative",children:[s.jsxs("button",{onClick:()=>c(!o),className:"w-full bg-white shadow-md border border-gray-100 rounded-xl px-4 py-3 flex items-center justify-between text-gray-900 font-medium hover:shadow-lg transition-shadow",children:[s.jsx("span",{children:I[n]}),s.jsx(b,{className:"w-5 h-5 transition-transform "+(o?"rotate-180":"")})]}),o&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>c(!1)}),s.jsx("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white rounded-xl shadow-xl border border-gray-200 overflow-hidden z-20",children:["week","month","year"].map(e=>s.jsx("button",{onClick:()=>{a(e),c(!1)},className:`\n                      w-full px-4 py-3 text-left hover:bg-gray-50 transition-colors\n                      ${n===e?"bg-blue-50 text-blue-600 font-medium":"text-gray-900"}\n                    `,children:I[e]},e))})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-4",children:[s.jsxs("div",{className:"bg-white/15 backdrop-blur-sm rounded-2xl p-4 border border-white/20",children:[s.jsx("div",{className:"text-white/80 text-xs mb-1",children:"Total Inspections"}),s.jsxs("div",{className:"flex items-end gap-2",children:[s.jsx("span",{className:"text-3xl font-bold text-white",children:(null==h?void 0:h.totalInspections)||0}),h&&0!==h.countChange&&s.jsxs("span",{className:"text-sm flex items-center gap-1 mb-1 "+(h.countChange>0?"text-green-300":"text-red-300"),children:[h.countChange>0?s.jsx(u,{className:"w-3 h-3"}):s.jsx(j,{className:"w-3 h-3"}),Math.abs(h.countChange)]})]})]}),s.jsxs("div",{className:"bg-white/15 backdrop-blur-sm rounded-2xl p-4 border border-white/20",children:[s.jsx("div",{className:"text-white/80 text-xs mb-1",children:"Average Score"}),s.jsxs("div",{className:"flex items-end gap-2",children:[s.jsx("span",{className:"text-3xl font-bold text-white",children:(null==h?void 0:h.avgScore)||0}),h&&0!==h.scoreChange&&s.jsxs("span",{className:"text-sm flex items-center gap-1 mb-1 "+(h.scoreChange>0?"text-green-300":"text-red-300"),children:[h.scoreChange>0?s.jsx(u,{className:"w-3 h-3"}):s.jsx(j,{className:"w-3 h-3"}),Math.abs(h.scoreChange)]})]})]})]})]}),s.jsxs("div",{className:"p-4 space-y-4",children:[s.jsxs(M,{children:[s.jsx(k,{title:"Score Distribution",subtitle:"Quality breakdown",icon:s.jsx(y,{className:"w-5 h-5 text-purple-600"})}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Excellent (85-100)"}),s.jsx("span",{className:"text-sm font-bold text-green-600",children:(null==h?void 0:h.scoreRanges.excellent)||0})]}),s.jsx("div",{className:"h-3 bg-gray-100 rounded-full overflow-hidden",children:s.jsx("div",{className:"h-full bg-gradient-to-r from-green-500 to-green-400 rounded-full transition-all duration-500",style:{width:(null==h?void 0:h.totalInspections)?h.scoreRanges.excellent/h.totalInspections*100+"%":"0%"}})})]}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Good (70-84)"}),s.jsx("span",{className:"text-sm font-bold text-yellow-600",children:(null==h?void 0:h.scoreRanges.good)||0})]}),s.jsx("div",{className:"h-3 bg-gray-100 rounded-full overflow-hidden",children:s.jsx("div",{className:"h-full bg-gradient-to-r from-yellow-500 to-yellow-400 rounded-full transition-all duration-500",style:{width:(null==h?void 0:h.totalInspections)?h.scoreRanges.good/h.totalInspections*100+"%":"0%"}})})]}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Fair (50-69)"}),s.jsx("span",{className:"text-sm font-bold text-orange-600",children:(null==h?void 0:h.scoreRanges.fair)||0})]}),s.jsx("div",{className:"h-3 bg-gray-100 rounded-full overflow-hidden",children:s.jsx("div",{className:"h-full bg-gradient-to-r from-orange-500 to-orange-400 rounded-full transition-all duration-500",style:{width:(null==h?void 0:h.totalInspections)?h.scoreRanges.fair/h.totalInspections*100+"%":"0%"}})})]}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Needs Work (0-49)"}),s.jsx("span",{className:"text-sm font-bold text-red-600",children:(null==h?void 0:h.scoreRanges.poor)||0})]}),s.jsx("div",{className:"h-3 bg-gray-100 rounded-full overflow-hidden",children:s.jsx("div",{className:"h-full bg-gradient-to-r from-red-500 to-red-400 rounded-full transition-all duration-500",style:{width:(null==h?void 0:h.totalInspections)?h.scoreRanges.poor/h.totalInspections*100+"%":"0%"}})})]})]})]}),(null==h?void 0:h.peakHour)&&s.jsxs(M,{children:[s.jsx(k,{title:"Peak Inspection Hour",subtitle:"Most active time",icon:s.jsx(i,{className:"w-5 h-5 text-blue-600"})}),s.jsxs("div",{className:"flex items-center justify-between p-4 bg-blue-50 rounded-xl",children:[s.jsxs("div",{children:[s.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"Busiest at"}),s.jsxs("div",{className:"text-3xl font-bold text-blue-600",children:[h.peakHour.hour.toString().padStart(2,"0"),":00"]})]}),s.jsxs("div",{className:"text-right",children:[s.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"Total checks"}),s.jsx("div",{className:"text-2xl font-bold text-gray-900",children:h.peakHour.count})]})]})]}),s.jsxs(M,{children:[s.jsx(k,{title:"Location Rankings",subtitle:"Performance by location",icon:s.jsx(l,{className:"w-5 h-5 text-purple-600"})}),s.jsxs("div",{className:"space-y-2",children:[null==h?void 0:h.locationPerformance.slice(0,10).map((e,t)=>s.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-xl hover:bg-gray-100 transition-colors",children:[s.jsxs("div",{className:`\n                  w-8 h-8 rounded-lg flex items-center justify-center font-bold text-sm flex-shrink-0\n                  ${0===t?"bg-yellow-100 text-yellow-600":1===t?"bg-gray-100 text-gray-600":2===t?"bg-orange-100 text-orange-600":"bg-gray-50 text-gray-500"}\n                `,children:["#",t+1]}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("div",{className:"font-medium text-gray-900 truncate",children:e.name}),s.jsxs("div",{className:"text-xs text-gray-500",children:[e.count," inspections"]})]}),s.jsxs("div",{className:"text-right",children:[s.jsx("div",{className:"text-lg font-bold text-gray-900",children:e.avgScore}),0!==e.trend&&s.jsxs("div",{className:"text-xs flex items-center gap-0.5 "+(e.trend>0?"text-green-600":"text-red-600"),children:[e.trend>0?"â†‘":"â†“"," ",Math.abs(e.trend)]})]})]},e.id)),!(null==h?void 0:h.locationPerformance.length)&&s.jsx("p",{className:"text-center text-gray-500 py-8",children:"No location data available"})]})]}),(null==h?void 0:h.needsAttention)&&h.needsAttention.length>0&&s.jsxs(M,{children:[s.jsx(k,{title:"Needs Attention",subtitle:"Locations below 70 score",icon:s.jsx(g,{className:"w-5 h-5 text-red-600"})}),s.jsx("div",{className:"space-y-2",children:h.needsAttention.map(e=>s.jsxs("div",{className:"flex items-center gap-3 p-3 bg-red-50 rounded-xl border border-red-100",children:[s.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center flex-shrink-0",children:s.jsx(g,{className:"w-5 h-5 text-red-600"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("div",{className:"font-medium text-gray-900 truncate",children:e.name}),s.jsxs("div",{className:"text-xs text-gray-500",children:[e.building&&`${e.building} â€¢ `,e.floor]})]}),s.jsx("div",{className:"text-xl font-bold text-red-600",children:e.avgScore})]},e.id))})]}),s.jsxs("button",{onClick:()=>alert("Export feature coming soon!"),className:"w-full flex items-center justify-center gap-2 p-4 bg-white border-2 border-gray-200 rounded-2xl font-medium text-gray-900 hover:bg-gray-50 transition-colors active:scale-95",children:[s.jsx(f,{className:"w-5 h-5"}),s.jsx("span",{children:"Export Analytics Report"})]})]}),s.jsx(_,{})]})}},Symbol.toStringTag,{value:"Module"}));export{W as A,U as R};
