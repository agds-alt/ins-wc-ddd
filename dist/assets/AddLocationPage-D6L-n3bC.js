import{f as e,u as a,r as s,b as i,j as r,A as n,O as t,J as o,s as l,M as d,ak as c,aj as u,al as g,am as m,F as x,an as b,n as h}from"./react-vendor-B_wON18L.js";import{u as p,s as f}from"./admin-DxXcpQLf.js";import{S as j,B as y}from"./reports-CYvdUc55.js";import"./vendor-C4HD8sBH.js";import"./supabase-vendor-Ck00pQO2.js";import"./date-vendor-DWqTPjCA.js";import"./inspection-Bd6L4SDO.js";const v=()=>{const v=e(),{user:w,authLoading:N}=p(),_=a(),[z,S]=s.useState(!1),[C,P]=s.useState([]),[A,q]=s.useState([]),[L,F]=s.useState(!1),[O,E]=s.useState({organization_id:"",building_id:"",name:"",code:"",floor:"",area:"",section:"",description:""});s.useEffect(()=>{(async()=>{const{data:e,error:a}=await f.from("organizations").select("*").eq("is_active",!0).order("name");a?h.error("Failed to load organizations"):P(e||[])})()},[]),s.useEffect(()=>{(async()=>{if(!O.organization_id)return void q([]);F(!0);const{data:e,error:a}=await f.from("buildings").select("*").eq("organization_id",O.organization_id).eq("is_active",!0).order("name");a?h.error("Failed to load buildings"):q(e||[]),F(!1)})()},[O.organization_id]);const B=i({mutationFn:async e=>{if(!(null==w?void 0:w.id))throw new Error("User not authenticated");if(!e.organization_id||!e.building_id)throw new Error("Organization and Building are required");const{data:a,error:s}=await f.from("buildings").select("short_code, organizations(short_code)").eq("id",e.building_id).single();if(s||!a)throw new Error("Building not found");const i=`${a.organizations.short_code}-${a.short_code}-${e.code||"LOC"}-${Date.now().toString(36).slice(-4)}`.toUpperCase(),r={name:e.name.trim(),code:e.code.trim()||null,organization_id:e.organization_id,building_id:e.building_id,floor:e.floor.trim()||null,area:e.area||null,section:e.section.trim()||null,description:e.description.trim()||null,qr_code:i,is_active:!0,created_by:w.id},{data:n,error:t}=await f.from("locations").insert(r).select().single();if(t)throw t;return n},onSuccess:()=>{_.invalidateQueries({queryKey:["locations-list"]}),_.invalidateQueries({queryKey:["locations"]}),h.success("Location added successfully!"),v("/locations")},onError:e=>{h.error(e.message||"Failed to add location")}}),T=(e,a)=>{E(s=>"organization_id"===e?{...s,[e]:a,building_id:""}:{...s,[e]:a})};return N?r.jsx("div",{className:"min-h-screen bg-white flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),r.jsx("p",{className:"text-gray-600 text-sm",children:"Loading..."})]})}):w?r.jsxs("div",{className:"min-h-screen bg-white pb-24",children:[r.jsx(j,{isOpen:z,onClose:()=>S(!1)}),r.jsx("div",{className:"bg-white p-6 border-b border-gray-100",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("button",{onClick:()=>v(-1),className:"w-10 h-10 bg-white rounded-full flex items-center justify-center shadow-md hover:shadow-lg transition-shadow border border-gray-100",children:r.jsx(n,{className:"w-5 h-5 text-gray-600"})}),r.jsxs("div",{children:[r.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Add Location"}),r.jsx("p",{className:"text-sm text-gray-500",children:"Create new inspection point"})]})]}),r.jsx("button",{onClick:()=>S(!0),className:"w-10 h-10 bg-white rounded-full flex items-center justify-center shadow-md hover:shadow-lg transition-shadow border border-gray-100",children:r.jsx(t,{className:"w-5 h-5 text-gray-600"})})]})}),r.jsxs("div",{className:"p-6",children:[r.jsxs("form",{onSubmit:async e=>{e.preventDefault(),O.organization_id?O.building_id?O.name.trim()?B.mutate(O):h.error("Location name is required"):h.error("Please select a building"):h.error("Please select an organization")},className:"space-y-5",children:[r.jsxs("div",{children:[r.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-2",children:[r.jsx(o,{className:"w-4 h-4 text-blue-600"}),"Organization *"]}),r.jsxs("select",{value:O.organization_id,onChange:e=>T("organization_id",e.target.value),className:"w-full px-4 py-3 bg-white border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,disabled:B.isPending,children:[r.jsx("option",{value:"",children:"Select Organization"}),C.map(e=>r.jsxs("option",{value:e.id,children:[e.name," (",e.short_code,")"]},e.id))]}),0===C.length&&r.jsx("p",{className:"text-xs text-red-500 mt-1",children:"No organizations found. Please contact admin."})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-2",children:[r.jsx(l,{className:"w-4 h-4 text-blue-600"}),"Building *"]}),r.jsxs("select",{value:O.building_id,onChange:e=>T("building_id",e.target.value),className:"w-full px-4 py-3 bg-white border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:opacity-50 disabled:cursor-not-allowed",required:!0,disabled:!O.organization_id||L||B.isPending,children:[r.jsx("option",{value:"",children:L?"Loading buildings...":O.organization_id?"Select Building":"Select organization first"}),A.map(e=>r.jsxs("option",{value:e.id,children:[e.name," (",e.short_code,")"]},e.id))]}),O.organization_id&&0===A.length&&!L&&r.jsx("p",{className:"text-xs text-orange-500 mt-1",children:"No buildings found for this organization."})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-2",children:[r.jsx(d,{className:"w-4 h-4 text-blue-600"}),"Location Name *"]}),r.jsx("input",{type:"text",value:O.name,onChange:e=>T("name",e.target.value),placeholder:"e.g., Men's Toilet, Women's Restroom",className:"w-full px-4 py-3 bg-white border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,disabled:B.isPending})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-2",children:[r.jsx(c,{className:"w-4 h-4 text-gray-400"}),"Location Code (Optional)"]}),r.jsx("input",{type:"text",value:O.code,onChange:e=>T("code",e.target.value.toUpperCase()),placeholder:"e.g., WC-01, TL-A1",className:"w-full px-4 py-3 bg-white border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:B.isPending}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Will be used for QR code generation"})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[r.jsxs("div",{children:[r.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-2",children:[r.jsx(u,{className:"w-4 h-4 text-gray-400"}),"Floor"]}),r.jsx("input",{type:"text",value:O.floor,onChange:e=>T("floor",e.target.value),placeholder:"e.g., 1F, Ground",className:"w-full px-4 py-3 bg-white border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:B.isPending})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-2",children:[r.jsx(g,{className:"w-4 h-4 text-gray-400"}),"Section"]}),r.jsx("input",{type:"text",value:O.section,onChange:e=>T("section",e.target.value),placeholder:"e.g., Men, Women",className:"w-full px-4 py-3 bg-white border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:B.isPending})]})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-2",children:[r.jsx(m,{className:"w-4 h-4 text-gray-400"}),"Area Type"]}),r.jsxs("select",{value:O.area,onChange:e=>T("area",e.target.value),className:"w-full px-4 py-3 bg-white border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:B.isPending,children:[r.jsx("option",{value:"",children:"Select Area Type (Optional)"}),r.jsx("option",{value:"Public Area",children:"Public Area"}),r.jsx("option",{value:"Staff Area",children:"Staff Area"}),r.jsx("option",{value:"VIP Area",children:"VIP Area"}),r.jsx("option",{value:"Service Area",children:"Service Area"}),r.jsx("option",{value:"Emergency Area",children:"Emergency Area"})]})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-2",children:[r.jsx(x,{className:"w-4 h-4 text-gray-400"}),"Description (Optional)"]}),r.jsx("textarea",{value:O.description,onChange:e=>T("description",e.target.value),placeholder:"Additional notes or special instructions...",className:"w-full px-4 py-3 bg-white border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",rows:3,disabled:B.isPending})]}),r.jsxs("div",{className:"pt-4 space-y-3",children:[r.jsx("button",{type:"submit",disabled:B.isPending,className:"w-full bg-blue-600 text-white py-4 rounded-2xl font-bold shadow-lg hover:bg-blue-700 active:scale-[0.98] transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:B.isPending?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),r.jsx("span",{children:"Saving..."})]}):r.jsxs(r.Fragment,{children:[r.jsx(b,{className:"w-5 h-5"}),r.jsx("span",{children:"Save Location"})]})}),r.jsx("button",{type:"button",onClick:()=>v(-1),disabled:B.isPending,className:"w-full bg-white border-2 border-gray-200 text-gray-700 py-4 rounded-2xl font-medium hover:bg-gray-50 active:scale-[0.98] transition-all disabled:opacity-50",children:"Cancel"})]})]}),r.jsxs("div",{className:"mt-6 bg-blue-50 border border-blue-100 rounded-xl p-4",children:[r.jsx("p",{className:"text-sm text-blue-900 font-medium mb-2",children:"ðŸ’¡ Tips:"}),r.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[r.jsx("li",{children:"â€¢ Select organization first, then building"}),r.jsx("li",{children:"â€¢ QR code will be auto-generated from codes"}),r.jsx("li",{children:"â€¢ Use clear, descriptive location names"}),r.jsx("li",{children:"â€¢ Location will be active by default"})]})]})]}),r.jsx(y,{})]}):(v("/login",{replace:!0}),null)};export{v as AddLocationPage};
