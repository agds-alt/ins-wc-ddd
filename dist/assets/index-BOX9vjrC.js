import{r as e,u as t,j as s,C as r,M as a,L as n,E as l,a as i,b as o,c,d,t as x,e as u,f as m,H as h,g,Q as p,h as b,U as f,i as y,S as j,k as v,l as N,D as w,m as _,n as k,X as S,o as C,T as P,p as M,q as I,s as O,v as E,w as q,A as L,x as D,y as A,z as T,F,B as R,G as $,I as z,J as U,K as G,P as Z,N as K,O as B,R as H,V as Q,W,Y as V,Z as Y,_ as J,$ as X,a0 as ee,a1 as te,a2 as se,a3 as re,a4 as ae,a5 as ne,a6 as le,a7 as ie,a8 as oe,a9 as ce,aa as de,ab as xe,ac as ue,ad as me}from"./vendor-react-TSfPi21F.js";import{v as he,x as ge,y as pe,H as be,z as fe}from"./vendor-other-DlCEsr_p.js";import{c as ye}from"./vendor-supabase-NYp0RaRF.js";import{f as je,s as ve,e as Ne,a as we,i as _e,b as ke,c as Se,d as Ce,g as Pe,h as Me}from"./vendor-date-DfinWgb-.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var Ie=(e,t,s)=>new Promise((r,a)=>{var n=e=>{try{i(s.next(e))}catch(t){a(t)}},l=e=>{try{i(s.throw(e))}catch(t){a(t)}},i=e=>e.done?r(e.value):Promise.resolve(e.value).then(n,l);i((s=s.apply(e,t)).next())});const Oe="https://zznhsfsvankfewasstel.supabase.co";class Ee extends Error{constructor(e){super(e),this.name="SupabaseConfigError"}}class qe extends Error{constructor(e){super(e),this.name="SupabaseConnectionError"}}const Le=(()=>{try{return(()=>{const e=[];if(e.length>0)throw new Ee(`Missing required environment variables: ${e.join(", ")}`);try{new URL(Oe)}catch(t){throw new Ee("Invalid VITE_SUPABASE_URL format")}})(),ye(Oe,"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp6bmhzZnN2YW5rZmV3YXNzdGVsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA2MzY5MTQsImV4cCI6MjA3NjIxMjkxNH0.U2XCOfWSuZQpTzzgwMhkSAL0CJz1bqtHIkziLYpwmZ0",{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"pkce",storage:localStorage},realtime:{params:{eventsPerSecond:10}},global:{headers:{"X-Client-Info":"wc-check-app","X-Client-Version":"1.0.0"}},db:{schema:"public"}})}catch(e){throw e}})();let De=!1,Ae=!1;Ie(void 0,null,function*(){try{const{data:e,error:t}=yield((e,...s)=>Ie(void 0,[e,...s],function*(e,s=3,r=1e3){let a;for(let n=1;n<=s;n++)try{return yield e()}catch(t){if(a=t,n===s)break;const l=r*Math.pow(2,n-1);yield new Promise(e=>setTimeout(e,l))}throw a}))(()=>Ie(void 0,null,function*(){var e,t,s,r;const a=yield Le.auth.getSession();if((null==(t=null==(e=a.error)?void 0:e.message)?void 0:t.includes("fetch"))||(null==(r=null==(s=a.error)?void 0:s.message)?void 0:r.includes("network")))throw new qe(`Network error: ${a.error.message}`);return a}));return!t}catch(e){return!1}}).then(e=>{De=!0,Ae=e}),new Promise(e=>{const t=()=>{De?e(Ae):setTimeout(t,100)};t()});const Te={save(e){var t;try{if(!e)return;const s={access_token:e.access_token,refresh_token:e.refresh_token,expires_at:e.expires_at,expires_in:e.expires_in,token_type:e.token_type,user:e.user};localStorage.setItem("supabase.auth.token",JSON.stringify(s)),localStorage.setItem("sb-auth-token",e.access_token),localStorage.setItem("sb-refresh-token",e.refresh_token),localStorage.setItem("sb-user-data",JSON.stringify(e.user)),localStorage.setItem("sb-expires-at",(null==(t=e.expires_at)?void 0:t.toString())||"")}catch(s){}},isValid(){try{const e=localStorage.getItem("supabase.auth.token");if(!e)return!1;const t=JSON.parse(e);return!(!t||"object"!=typeof t)&&!!t.access_token}catch(e){return!1}},clear(){try{const e=Object.keys(localStorage);e.filter(e=>e.startsWith("supabase.auth")||e.startsWith("sb-")).forEach(e=>{localStorage.removeItem(e)}),localStorage.removeItem("user"),localStorage.removeItem("session"),localStorage.removeItem("token"),sessionStorage.clear()}catch(e){try{localStorage.clear()}catch(t){}}},validateOnStartup(){(!this.isValid()&&this.hasStoredToken()||this.hasStoredToken()&&this.isTokenExpired())&&this.clear()},hasStoredToken(){try{const e=localStorage.getItem("supabase.auth.token");return null!==e&&"undefined"!==e&&""!==e}catch(e){return!1}},getTokenExpiry(){try{const e=localStorage.getItem("supabase.auth.token");if(!e)return null;const t=JSON.parse(e);return t.expires_at?new Date(1e3*t.expires_at):null}catch(e){return null}},isTokenExpired(){const e=this.getTokenExpiry();if(!e)return!0;const t=Date.now();return e.getTime()<t+6e4},getTimeUntilExpiry(){const e=this.getTokenExpiry();if(!e)return 0;const t=Date.now(),s=e.getTime(),r=Math.floor((s-t)/1e3);return Math.max(0,r)},getUserId(){var e;try{const t=localStorage.getItem("supabase.auth.token");if(!t)return null;return(null==(e=JSON.parse(t).user)?void 0:e.id)||null}catch(t){return null}},debug(){Object.keys(localStorage).filter(e=>e.startsWith("supabase")||e.startsWith("sb-"))},emergencyReset(){this.clear(),window.location.href="/login"}};"undefined"!=typeof window&&(window.authStorage=Te);var Fe=(e,t,s)=>new Promise((r,a)=>{var n=e=>{try{i(s.next(e))}catch(t){a(t)}},l=e=>{try{i(s.throw(e))}catch(t){a(t)}},i=e=>e.done?r(e.value):Promise.resolve(e.value).then(n,l);i((s=s.apply(e,t)).next())});function Re(){const[t,s]=e.useState(null),[r,a]=e.useState(null),[n,l]=e.useState(!0),[i,o]=e.useState(null),c=e.useCallback(e=>Fe(this,null,function*(){try{if(!e)return null;const{data:t,error:s}=yield Le.from("users").select("\n          id,\n          email,\n          full_name,\n          phone,\n          profile_photo_url,\n          occupation_id,\n          is_active,\n          last_login_at,\n          created_at,\n          updated_at\n        ").eq("id",e).eq("is_active",!0).single();return s?"PGRST116"===s.code?yield d(e):(o(`Failed to load user profile: ${s.message}`),null):t}catch(t){return o("Unexpected error loading user profile"),null}}),[]),d=e=>Fe(this,null,function*(){var t,s;try{const{data:{user:r}}=yield Le.auth.getUser();if(!r)return null;const a={id:e,email:r.email,full_name:(null==(t=r.user_metadata)?void 0:t.full_name)||(null==(s=r.user_metadata)?void 0:s.name)||"User",is_active:!0,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()},{data:n,error:l}=yield Le.from("users").insert(a).select().single();return l?null:n}catch(r){return null}}),x=e.useCallback(e=>Fe(this,null,function*(){try{const{error:t}=yield Le.from("users").update({last_login_at:(new Date).toISOString(),updated_at:(new Date).toISOString()}).eq("id",e)}catch(t){}}),[]),u=e.useCallback(()=>Fe(this,null,function*(){if(null==t?void 0:t.id){l(!0);try{const e=yield c(t.id);a(e),o(null)}catch(e){o("Failed to refresh user profile")}finally{l(!1)}}}),[null==t?void 0:t.id,c]),m=e.useCallback(()=>Fe(this,null,function*(){l(!0),o(null);try{const e=setTimeout(()=>{l(!1)},1e4);if(!Te.isValid()&&Te.hasStoredToken())return Te.clear(),s(null),a(null),clearTimeout(e),void l(!1);const{data:{session:t},error:r}=yield Le.auth.getSession();if(r)return Te.clear(),o(`Session error: ${r.message}`),clearTimeout(e),void l(!1);if(null==t?void 0:t.user){Te.save(t);const e={id:t.user.id,email:t.user.email,user_metadata:t.user.user_metadata,app_metadata:t.user.app_metadata,created_at:t.user.created_at,updated_at:t.user.updated_at};s(e);const r=yield c(t.user.id);a(r),r&&(yield x(t.user.id))}else Te.clear(),s(null),a(null);clearTimeout(e),l(!1)}catch(e){Te.clear(),s(null),a(null),o("Failed to initialize authentication"),l(!1)}}),[c,x]),h=e.useCallback((e,t)=>Fe(this,null,function*(){try{switch(e){case"SIGNED_IN":case"TOKEN_REFRESHED":case"USER_UPDATED":if(null==t?void 0:t.user){Te.save(t);const r={id:t.user.id,email:t.user.email,user_metadata:t.user.user_metadata,app_metadata:t.user.app_metadata,created_at:t.user.created_at,updated_at:t.user.updated_at};s(r);const n=yield c(t.user.id);a(n),n&&"SIGNED_IN"===e&&(yield x(t.user.id)),o(null)}break;case"SIGNED_OUT":case"USER_DELETED":Te.clear(),s(null),a(null),o(null)}}catch(r){o(`Auth error: ${r instanceof Error?r.message:"Unknown error"}`)}finally{l(!1)}}),[c,x]);e.useEffect(()=>{m();const{data:{subscription:e}}=Le.auth.onAuthStateChange(h);return()=>{e.unsubscribe()}},[m,h]);const g=e.useCallback(()=>Fe(this,null,function*(){l(!0);try{const{error:e}=yield Le.auth.signOut();if(e)return void o(`Sign out failed: ${e.message}`);Te.clear(),s(null),a(null),o(null)}catch(e){o("Unexpected error during sign out")}finally{l(!1)}}),[]);return{user:t,profile:r,loading:n,error:i,isAuthenticated:!!t&&!!(null==r?void 0:r.is_active),signOut:g,refreshProfile:u}}var $e=(e,t,s)=>new Promise((r,a)=>{var n=e=>{try{i(s.next(e))}catch(t){a(t)}},l=e=>{try{i(s.throw(e))}catch(t){a(t)}},i=e=>e.done?r(e.value):Promise.resolve(e.value).then(n,l);i((s=s.apply(e,t)).next())});function ze(){const d=t(),[x,u]=e.useState(""),[m,h]=e.useState(""),[g,p]=e.useState(!1),[b,f]=e.useState(!1),[y,j]=e.useState(null),[v,N]=e.useState(null);return s.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-blue-50 flex items-center justify-center p-4",children:s.jsxs("div",{className:"w-full max-w-md",children:[s.jsxs("div",{className:"text-center mb-8",children:[s.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-blue-600 rounded-2xl shadow-lg mb-4",children:s.jsx("span",{className:"text-3xl",children:"ðŸš½"})}),s.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Smart Toilet Monitor"}),s.jsx("p",{className:"text-gray-600",children:"Sign in to manage your facilities"})]}),s.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8 border border-gray-100",children:[y&&s.jsxs("div",{className:"mb-6 bg-red-50 border border-red-200 rounded-lg p-4 flex items-start gap-3",children:[s.jsx(r,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"text-sm font-medium text-red-800",children:"Error"}),s.jsx("p",{className:"text-sm text-red-700 mt-1",children:y})]})]}),v&&s.jsxs("div",{className:"mb-6 bg-green-50 border border-green-200 rounded-lg p-4 flex items-start gap-3",children:[s.jsx("div",{className:"w-5 h-5 bg-green-600 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",children:s.jsx("span",{className:"text-white text-xs",children:"âœ“"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"text-sm font-medium text-green-800",children:"Success"}),s.jsx("p",{className:"text-sm text-green-700 mt-1",children:v})]})]}),s.jsxs("form",{onSubmit:e=>$e(this,null,function*(){if(e.preventDefault(),!b)if(j(null),N(null),x&&m){f(!0);try{Te.clear();const{data:e,error:t}=yield Le.auth.signInWithPassword({email:x.trim(),password:m});if(t)throw t;(null==e?void 0:e.user)&&(N("Login successful! Redirecting..."),setTimeout(()=>{d("/dashboard")},500))}catch(t){t.message.includes("Invalid login credentials")?j("Invalid email or password. Please try again."):t.message.includes("Email not confirmed")?j("Please verify your email address before logging in."):j(t.message||"Failed to login. Please try again.")}finally{f(!1)}}else j("Email and password are required")}),className:"space-y-5",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address"}),s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:s.jsx(a,{className:"h-5 w-5 text-gray-400"})}),s.jsx("input",{type:"email",value:x,onChange:e=>u(e.target.value),className:"block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",placeholder:"your.email@example.com",disabled:b,autoComplete:"email",required:!0})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Password"}),s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:s.jsx(n,{className:"h-5 w-5 text-gray-400"})}),s.jsx("input",{type:g?"text":"password",value:m,onChange:e=>h(e.target.value),className:"block w-full pl-10 pr-12 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",placeholder:"Enter your password",disabled:b,autoComplete:"current-password",required:!0}),s.jsx("button",{type:"button",onClick:()=>p(!g),className:"absolute inset-y-0 right-0 pr-3 flex items-center hover:text-blue-600 transition-colors",disabled:b,tabIndex:-1,children:g?s.jsx(l,{className:"h-5 w-5 text-gray-400"}):s.jsx(i,{className:"h-5 w-5 text-gray-400"})})]})]}),s.jsx("div",{className:"flex items-center justify-end",children:s.jsx("button",{type:"button",onClick:()=>$e(this,null,function*(){if(x){f(!0),j(null);try{const{error:e}=yield Le.auth.resetPasswordForEmail(x,{redirectTo:`${window.location.origin}/reset-password`});if(e)throw e;N("Password reset link sent! Check your email.")}catch(e){j(e.message||"Failed to send reset email")}finally{f(!1)}}else j("Please enter your email address first")}),className:"text-sm font-medium text-blue-600 hover:text-blue-700 transition-colors",disabled:b,children:"Forgot Password?"})}),s.jsx("button",{type:"submit",disabled:b,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-4 rounded-lg shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 active:translate-y-0 transition-all duration-150 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none flex items-center justify-center gap-2",style:{boxShadow:"0 4px 14px 0 rgba(37, 99, 235, 0.39)"},children:b?s.jsxs(s.Fragment,{children:[s.jsx(o,{className:"w-5 h-5 animate-spin"}),s.jsx("span",{children:"Signing in..."})]}):s.jsxs(s.Fragment,{children:[s.jsx(n,{className:"w-5 h-5"}),s.jsx("span",{children:"Sign In"})]})})]}),s.jsxs("div",{className:"relative my-6",children:[s.jsx("div",{className:"absolute inset-0 flex items-center",children:s.jsx("div",{className:"w-full border-t border-gray-300"})}),s.jsx("div",{className:"relative flex justify-center text-sm",children:s.jsx("span",{className:"px-4 bg-white text-gray-500",children:"Don't have an account?"})})]}),s.jsx(c,{to:"/register",className:"w-full bg-white hover:bg-gray-50 text-blue-600 font-semibold py-3 px-4 rounded-lg border-2 border-blue-600 shadow-md hover:shadow-lg transform hover:-translate-y-0.5 transition-all duration-150 flex items-center justify-center gap-2",children:s.jsx("span",{children:"Create New Account"})})]}),s.jsxs("div",{className:"mt-8 text-center text-sm text-gray-600",children:[s.jsx("p",{children:"Â© 2025 Smart Toilet Monitor. All rights reserved."}),s.jsxs("p",{className:"mt-2",children:[s.jsx("a",{href:"#",className:"text-blue-600 hover:text-blue-700",children:"Privacy Policy"})," Â· ",s.jsx("a",{href:"#",className:"text-blue-600 hover:text-blue-700",children:"Terms of Service"})]})]})]})})}var Ue=Object.defineProperty,Ge=Object.defineProperties,Ze=Object.getOwnPropertyDescriptors,Ke=Object.getOwnPropertySymbols,Be=Object.prototype.hasOwnProperty,He=Object.prototype.propertyIsEnumerable,Qe=(e,t,s)=>t in e?Ue(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,We=(e,t)=>{for(var s in t||(t={}))Be.call(t,s)&&Qe(e,s,t[s]);if(Ke)for(var s of Ke(t))He.call(t,s)&&Qe(e,s,t[s]);return e},Ve=(e,t)=>Ge(e,Ze(t)),Ye=(e,t,s)=>new Promise((r,a)=>{var n=e=>{try{i(s.next(e))}catch(t){a(t)}},l=e=>{try{i(s.throw(e))}catch(t){a(t)}},i=e=>e.done?r(e.value):Promise.resolve(e.value).then(n,l);i((s=s.apply(e,t)).next())});const Je=he({full_name:ge().min(2,"Full name must be at least 2 characters"),email:ge().email("Invalid email address"),password:ge().min(6,"Password must be at least 6 characters"),confirmPassword:ge(),occupation_id:ge().optional()}).refine(e=>e.password===e.confirmPassword,{message:"Passwords don't match",path:["confirmPassword"]}),Xe=()=>{const[r,a]=e.useState(!1),[n,l]=e.useState([]),[i,o]=e.useState(!0),m=t(),{register:h,handleSubmit:g,formState:{errors:p}}=d({resolver:x(Je)});e.useEffect(()=>{Ye(void 0,null,function*(){try{const{data:e,error:t}=yield Le.from("user_occupations").select("*").eq("is_active",!0).order("display_name");if(t)throw t;l((e||[]).map(e=>Ve(We({},e),{icon:e.icon||"ðŸ‘¤",color:e.color||"#3B82F6",description:e.description||""})))}catch(e){l([])}finally{o(!1)}})},[]);return s.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4 safe-area",children:s.jsxs("div",{className:"max-w-md w-full space-y-8",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"mx-auto h-16 w-16 bg-blue-600 rounded-2xl flex items-center justify-center mb-4",children:s.jsx("span",{className:"text-white text-2xl font-bold",children:"ðŸš½"})}),s.jsx("h2",{className:"text-3xl font-bold text-gray-900",children:"Create Account"}),s.jsx("p",{className:"mt-2 text-gray-600",children:"Sign up to start inspections"})]}),s.jsxs("form",{onSubmit:g(e=>Ye(void 0,null,function*(){a(!0);try{const{data:t,error:s}=yield Le.auth.signUp({email:e.email,password:e.password,options:{data:{full_name:e.full_name}}});if(s)throw s;if(t.user){const{error:s}=yield Le.from("users").insert({id:t.user.id,email:e.email,full_name:e.full_name,password_hash:"supabase_auth",occupation_id:e.occupation_id||null,is_active:!0,phone:null,profile_photo_url:null,last_login_at:null});if(s)throw new Error(`Failed to create profile: ${s.message}`)}u.success("Registration successful!"),m("/login")}catch(t){let e=t.message;t.message.includes("password_hash")?e="Database configuration error. Please contact administrator.":t.message.includes("users_pkey")&&(e="User already exists with this email."),u.error(e)}finally{a(!1)}})),className:"mt-8 space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:"full_name",className:"block text-sm font-medium text-gray-700",children:"Full Name"}),s.jsx("input",Ve(We({},h("full_name")),{type:"text",className:"mt-1 block w-full px-4 py-3 bg-white border border-gray-300 rounded-2xl shadow-sm focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter your full name"})),p.full_name&&s.jsx("p",{className:"mt-1 text-sm text-red-600",children:p.full_name.message})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email"}),s.jsx("input",Ve(We({},h("email")),{type:"email",className:"mt-1 block w-full px-4 py-3 bg-white border border-gray-300 rounded-2xl shadow-sm focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter your email"})),p.email&&s.jsx("p",{className:"mt-1 text-sm text-red-600",children:p.email.message})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"occupation_id",className:"block text-sm font-medium text-gray-700",children:"Occupation (Optional)"}),i?s.jsx("div",{className:"mt-1 block w-full px-4 py-3 bg-gray-100 border border-gray-300 rounded-2xl",children:s.jsx("span",{className:"text-gray-500",children:"Loading..."})}):s.jsxs("select",Ve(We({},h("occupation_id")),{className:"mt-1 block w-full px-4 py-3 bg-white border border-gray-300 rounded-2xl shadow-sm focus:ring-blue-500 focus:border-blue-500",children:[s.jsx("option",{value:"",children:"Select your occupation"}),n.map(e=>s.jsxs("option",{value:e.id,children:[e.icon," ",e.display_name]},e.id))]}))]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"Password"}),s.jsx("input",Ve(We({},h("password")),{type:"password",className:"mt-1 block w-full px-4 py-3 bg-white border border-gray-300 rounded-2xl shadow-sm focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter your password"})),p.password&&s.jsx("p",{className:"mt-1 text-sm text-red-600",children:p.password.message})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700",children:"Confirm Password"}),s.jsx("input",Ve(We({},h("confirmPassword")),{type:"password",className:"mt-1 block w-full px-4 py-3 bg-white border border-gray-300 rounded-2xl shadow-sm focus:ring-blue-500 focus:border-blue-500",placeholder:"Confirm your password"})),p.confirmPassword&&s.jsx("p",{className:"mt-1 text-sm text-red-600",children:p.confirmPassword.message})]}),s.jsx("button",{type:"submit",disabled:r,className:"w-full flex justify-center py-3 px-4 border border-transparent rounded-2xl shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:r?"Creating Account...":"Create Account"})]}),s.jsx("div",{className:"text-center",children:s.jsxs("p",{className:"text-gray-600",children:["Already have an account?"," ",s.jsx(c,{to:"/login",className:"text-blue-600 hover:text-blue-700 font-medium",children:"Sign in"})]})})]})})},et=[{id:"home",icon:h,label:"Home",path:"/"},{id:"history",icon:g,label:"History",path:"/history"},{id:"scan",icon:p,label:"Scan",path:"/scan",isCenter:!0},{id:"analytics",icon:b,label:"Analytics",path:"/analytics"},{id:"profile",icon:f,label:"Profile",path:"/profile"}],tt=()=>{const e=t(),r=m();return s.jsx("nav",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 z-50 safe-area-bottom",children:s.jsx("div",{className:"flex items-center justify-around relative px-2 pt-2 pb-2",children:et.map(t=>{const a=t.icon,n=r.pathname===t.path||"/"!==t.path&&r.pathname.startsWith(t.path);return t.isCenter?s.jsx("div",{className:"flex-1 flex justify-center",children:s.jsx("button",{onClick:()=>e(t.path),className:"\n                    w-14 h-14 \n                    bg-gradient-to-br from-blue-600 to-blue-400\n                    rounded-full \n                    flex items-center justify-center \n                    text-white \n                    shadow-lg shadow-blue-600/30\n                    -mt-6\n                    transition-all duration-200\n                    active:scale-90\n                    hover:shadow-xl hover:shadow-blue-600/40\n                  ","aria-label":t.label,children:s.jsx(a,{className:"w-7 h-7",strokeWidth:2.5})})},t.id):s.jsxs("button",{onClick:()=>e(t.path),className:pe("flex-1 flex flex-col items-center justify-center gap-1 py-2 px-2 rounded-xl transition-all duration-200",n?"text-blue-600":"text-gray-500 hover:text-gray-700 active:scale-95"),"aria-label":t.label,children:[s.jsxs("div",{className:pe("relative",n&&"scale-110"),children:[s.jsx(a,{className:"w-6 h-6",strokeWidth:n?2.5:2}),n&&s.jsx("div",{className:"absolute -bottom-1 left-1/2 transform -translate-x-1/2 w-1 h-1 bg-blue-600 rounded-full"})]}),s.jsx("span",{className:pe("text-[11px] font-medium",n?"text-blue-600":"text-gray-600"),children:t.label})]},t.id)})})})};var st=(e,t,s)=>new Promise((r,a)=>{var n=e=>{try{i(s.next(e))}catch(t){a(t)}},l=e=>{try{i(s.throw(e))}catch(t){a(t)}},i=e=>e.done?r(e.value):Promise.resolve(e.value).then(n,l);i((s=s.apply(e,t)).next())});const rt=()=>{var e;const{user:r,profile:a}=Re(),n=t(),{data:l,isLoading:i}=y({queryKey:["user-stats",null==r?void 0:r.id],queryFn:()=>st(void 0,null,function*(){const{data:e,error:t}=yield Le.from("inspection_records").select("id, overall_status, inspection_date").eq("user_id",null==r?void 0:r.id).order("inspection_date",{ascending:!1});if(t)throw t;const s=e.length,a=(new Date).toISOString().split("T")[0];return{total:s,todayCount:e.filter(e=>e.inspection_date===a).length,completed:e.filter(e=>"completed"===e.overall_status).length,recent:e.slice(0,3)}}),enabled:!!(null==r?void 0:r.id)}),{data:o}=y({queryKey:["locations"],queryFn:()=>st(void 0,null,function*(){const{data:e,error:t}=yield Le.from("locations").select("id, name, building, floor").eq("is_active",!0).order("created_at",{ascending:!1}).limit(5);if(t)throw t;return e})}),c=[{title:"Scan QR Code",description:"Scan lokasi toilet",icon:p,path:"/scan",color:"blue",primary:!0},{title:"Locations",description:"Kelola lokasi",icon:v,path:"/locations",color:"purple"},{title:"Reports",description:"Lihat laporan",icon:g,path:"/reports",color:"green"},{title:"Profile",description:"Pengaturan akun",icon:f,path:"/profile",color:"orange"}],d={blue:"bg-blue-500 hover:bg-blue-600",purple:"bg-purple-500 hover:bg-purple-600",green:"bg-green-500 hover:bg-green-600",orange:"bg-orange-500 hover:bg-orange-600"};return s.jsxs("div",{className:"min-h-screen bg-gray-50 pb-24",children:[s.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 text-white p-6 pt-8",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("div",{children:[s.jsxs("h1",{className:"text-2xl font-bold",children:["Hi, ",(null==(e=null==a?void 0:a.full_name)?void 0:e.split(" ")[0])||"User","! ðŸ‘‹"]}),s.jsx("p",{className:"text-blue-100 text-sm mt-1",children:"Ready for inspection today?"})]}),s.jsx("button",{onClick:()=>n("/profile"),className:"w-10 h-10 bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center",children:s.jsx(j,{className:"w-5 h-5"})})]}),i?s.jsx("div",{className:"grid grid-cols-3 gap-3",children:[1,2,3].map(e=>s.jsx("div",{className:"bg-white/10 backdrop-blur-sm rounded-2xl p-4 h-20 animate-pulse"},e))}):s.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[s.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-2xl p-4",children:[s.jsx("div",{className:"text-3xl font-bold",children:(null==l?void 0:l.total)||0}),s.jsx("div",{className:"text-xs text-blue-100 mt-1",children:"Total"})]}),s.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-2xl p-4",children:[s.jsx("div",{className:"text-3xl font-bold",children:(null==l?void 0:l.todayCount)||0}),s.jsx("div",{className:"text-xs text-blue-100 mt-1",children:"Today"})]}),s.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-2xl p-4",children:[s.jsx("div",{className:"text-3xl font-bold",children:(null==l?void 0:l.completed)||0}),s.jsx("div",{className:"text-xs text-blue-100 mt-1",children:"Done"})]})]})]}),s.jsxs("main",{className:"p-6 space-y-6",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Quick Actions"}),s.jsx("div",{className:"grid grid-cols-2 gap-3",children:c.map(e=>{const t=e.icon;return s.jsx("button",{onClick:()=>n(e.path),className:`\n                    ${e.primary?"col-span-2":""}\n                    ${e.primary?d[e.color]:"bg-white"}\n                    ${e.primary?"text-white":"text-gray-900"}\n                    ${e.primary?"p-6":"p-4"}\n                    rounded-2xl shadow-sm\n                    transition-all duration-200\n                    hover:shadow-md\n                    active:scale-95\n                  `,children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:`\n                      ${e.primary?"w-14 h-14 bg-white/20":"w-12 h-12 bg-gray-100"}\n                      rounded-xl flex items-center justify-center flex-shrink-0\n                    `,children:s.jsx(t,{className:"w-6 h-6 "+(e.primary?"":"text-gray-700")})}),s.jsxs("div",{className:"text-left",children:[s.jsx("div",{className:"font-semibold",children:e.title}),s.jsx("div",{className:"text-xs mt-0.5 "+(e.primary?"text-white/80":"text-gray-500"),children:e.description})]})]})},e.path)})})]}),o&&o.length>0&&s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Recent Locations"}),s.jsx("button",{onClick:()=>n("/locations"),className:"text-sm text-blue-600 font-medium",children:"View All"})]}),s.jsx("div",{className:"space-y-2",children:o.map(e=>s.jsxs("button",{onClick:()=>n(`/inspect/${e.id}`),className:"w-full flex items-center justify-between p-4 bg-white rounded-xl hover:bg-gray-50 transition-colors",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-xl flex items-center justify-center",children:s.jsx(v,{className:"w-5 h-5 text-purple-600"})}),s.jsxs("div",{className:"text-left",children:[s.jsx("div",{className:"font-medium text-gray-900",children:e.name}),s.jsxs("div",{className:"text-sm text-gray-500",children:[e.building," â€¢ ",e.floor]})]})]}),s.jsx(N,{className:"w-5 h-5 text-gray-400"})]},e.id))})]}),(null==l?void 0:l.recent)&&l.recent.length>0&&s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Recent Inspections"}),s.jsx("button",{onClick:()=>n("/reports"),className:"text-sm text-blue-600 font-medium",children:"View All"})]}),s.jsx("div",{className:"space-y-2",children:l.recent.map(e=>s.jsxs("div",{className:"flex items-center gap-3 p-4 bg-white rounded-xl",children:[s.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center",children:s.jsx(w,{className:"w-5 h-5 text-blue-600"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"font-medium text-gray-900",children:new Date(e.inspection_date).toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric"})}),s.jsx("div",{className:"text-sm text-gray-500",children:"completed"===e.overall_status?"Completed":"Pending"})]}),"completed"===e.overall_status?s.jsx(_,{className:"w-5 h-5 text-green-500"}):s.jsx(k,{className:"w-5 h-5 text-orange-500"})]},e.id))})]}),(!l||0===l.total)&&!i&&s.jsxs("div",{className:"text-center py-12",children:[s.jsx("div",{className:"w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx(p,{className:"w-10 h-10 text-gray-400"})}),s.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Inspections Yet"}),s.jsx("p",{className:"text-gray-500 mb-6",children:"Start your first inspection by scanning a QR code"}),s.jsx("button",{onClick:()=>n("/scan"),className:"px-6 py-3 bg-blue-600 text-white rounded-xl font-medium hover:bg-blue-700 transition-colors",children:"Scan QR Code"})]})]}),s.jsx(tt,{})]})};const at=({isOpen:t,onClose:r,onScan:a})=>{const n=e.useRef(null),[l,i]=e.useState(!1),[o,c]=e.useState(null),d=e=>/^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e);e.useEffect(()=>{if(!t)return;var e,s,r;return e=void 0,s=null,r=function*(){try{i(!0),c(null),n.current=new be("qr-scanner-container",{fps:10,qrbox:{width:250,height:250},aspectRatio:1,supportedScanTypes:[]},!1),yield n.current.render(e=>{const t=(e=>{var t,s;try{if(e.includes("/locations/")){const r=null==(s=null==(t=e.split("/locations/")[1])?void 0:t.split("?")[0])?void 0:s.split("#")[0];if(r&&d(r))return r}if(d(e))return e;const r=e.match(/[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}/i);return r?r[0]:null}catch(r){return null}})(e);t?("vibrate"in navigator&&navigator.vibrate(200),a(t),x()):"vibrate"in navigator&&navigator.vibrate([100,50,100])},e=>{})}catch(e){c(e.message||"Failed to initialize camera"),i(!1)}},new Promise((t,a)=>{var n=e=>{try{i(r.next(e))}catch(t){a(t)}},l=e=>{try{i(r.throw(e))}catch(t){a(t)}},i=e=>e.done?t(e.value):Promise.resolve(e.value).then(n,l);i((r=r.apply(e,s)).next())}),()=>{x()}},[t,a]);const x=()=>{n.current&&(n.current.clear().catch(console.error),n.current=null),i(!1)},u=()=>{x(),r()};return t?s.jsxs("div",{className:"fixed inset-0 bg-black z-50 safe-area-top",children:[s.jsx("div",{id:"qr-scanner-container",className:"w-full h-full relative"}),s.jsx("div",{className:"absolute top-4 right-4 z-10",children:s.jsx("button",{onClick:u,className:"bg-white/90 backdrop-blur-sm rounded-full p-3 shadow-lg active:scale-95 transition-transform",children:s.jsx(S,{className:"w-6 h-6 text-gray-700"})})}),s.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[s.jsx("div",{className:"absolute top-0 left-0 right-0 h-20 bg-gradient-to-b from-black/50 to-transparent"}),s.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2",children:s.jsxs("div",{className:"w-64 h-64 border-2 border-white rounded-xl relative",children:[s.jsx("div",{className:"absolute -top-1 -left-1 w-6 h-6 border-t-2 border-l-2 border-white rounded-tl"}),s.jsx("div",{className:"absolute -top-1 -right-1 w-6 h-6 border-t-2 border-r-2 border-white rounded-tr"}),s.jsx("div",{className:"absolute -bottom-1 -left-1 w-6 h-6 border-b-2 border-l-2 border-white rounded-bl"}),s.jsx("div",{className:"absolute -bottom-1 -right-1 w-6 h-6 border-b-2 border-r-2 border-white rounded-br"}),s.jsx("div",{className:"absolute -bottom-8 left-0 right-0 text-center",children:s.jsx("span",{className:"text-xs text-white/80 bg-black/40 px-3 py-1 rounded-full",children:"URL or UUID Format"})})]})}),s.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-32 bg-gradient-to-t from-black/50 to-transparent flex items-end justify-center pb-8",children:s.jsxs("div",{className:"text-center",children:[s.jsx("p",{className:"text-white text-lg font-medium mb-1",children:"Scan QR Code"}),s.jsx("p",{className:"text-gray-300 text-sm",children:"Point camera at location QR"})]})})]}),l&&!o&&s.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-white mx-auto mb-4"}),s.jsx("p",{className:"text-white text-lg",children:"Initializing camera..."})]})}),o&&s.jsx("div",{className:"absolute inset-0 bg-black flex items-center justify-center p-6",children:s.jsxs("div",{className:"text-center",children:[s.jsx(C,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),s.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Camera Error"}),s.jsx("p",{className:"text-gray-300 mb-4",children:o}),s.jsx("button",{onClick:u,className:"bg-white text-gray-900 px-6 py-3 rounded-xl font-medium",children:"Close"})]})})]}):null};var nt=Object.defineProperty,lt=Object.defineProperties,it=Object.getOwnPropertyDescriptors,ot=Object.getOwnPropertySymbols,ct=Object.prototype.hasOwnProperty,dt=Object.prototype.propertyIsEnumerable,xt=(e,t,s)=>t in e?nt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;const ut=e=>{var t=e,{children:r,variant:a="default",hoverable:n=!0,padding:l="md",className:i}=t,o=((e,t)=>{var s={};for(var r in e)ct.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(null!=e&&ot)for(var r of ot(e))t.indexOf(r)<0&&dt.call(e,r)&&(s[r]=e[r]);return s})(t,["children","variant","hoverable","padding","className"]);const c=n?"hover:shadow-md hover:-translate-y-0.5 active:scale-[0.99]":"";return s.jsx("div",(d=((e,t)=>{for(var s in t||(t={}))ct.call(t,s)&&xt(e,s,t[s]);if(ot)for(var s of ot(t))dt.call(t,s)&&xt(e,s,t[s]);return e})({className:pe("bg-white rounded-2xl transition-all",{default:"shadow-sm border border-gray-100",flat:"border border-gray-200",bordered:"border-2 border-gray-200",glass:"glass"}[a],{none:"",sm:"p-3",md:"p-4",lg:"p-6"}[l],c,i)},o),lt(d,it({children:r}))));var d},mt=({title:e,subtitle:t,action:r,icon:a})=>s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[a&&s.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center text-xl",children:a}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-gray-900",children:e}),t&&s.jsx("p",{className:"text-sm text-gray-500",children:t})]})]}),r&&s.jsx("div",{children:r})]});var ht=Object.defineProperty,gt=Object.defineProperties,pt=Object.getOwnPropertyDescriptors,bt=Object.getOwnPropertySymbols,ft=Object.prototype.hasOwnProperty,yt=Object.prototype.propertyIsEnumerable,jt=(e,t,s)=>t in e?ht(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;const vt=e=>{var t=e,{variant:r="primary",size:a="md",children:n,loading:l=!1,className:i,disabled:o}=t,c=((e,t)=>{var s={};for(var r in e)ft.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(null!=e&&bt)for(var r of bt(e))t.indexOf(r)<0&&yt.call(e,r)&&(s[r]=e[r]);return s})(t,["variant","size","children","loading","className","disabled"]);return s.jsx("button",(d=((e,t)=>{for(var s in t||(t={}))ft.call(t,s)&&jt(e,s,t[s]);if(bt)for(var s of bt(t))yt.call(t,s)&&jt(e,s,t[s]);return e})({className:pe("font-medium rounded-2xl transition-all active:scale-95 focus:outline-none focus:ring-2 focus:ring-offset-2",{primary:"bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500 shadow-lg",secondary:"bg-gray-600 text-white hover:bg-gray-700 focus:ring-gray-500",outline:"border border-gray-300 text-gray-700 hover:bg-gray-50 focus:ring-blue-500 bg-white"}[r],{sm:"px-3 py-2 text-sm",md:"px-4 py-3 text-sm",lg:"px-6 py-4 text-base"}[a],(o||l)&&"opacity-50 cursor-not-allowed",i),disabled:o||l},c),gt(d,pt({children:l?s.jsxs("div",{className:"flex items-center justify-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Loading..."]}):n}))));var d};var Nt=(e,t,s)=>new Promise((r,a)=>{var n=e=>{try{i(s.next(e))}catch(t){a(t)}},l=e=>{try{i(s.throw(e))}catch(t){a(t)}},i=e=>e.done?r(e.value):Promise.resolve(e.value).then(n,l);i((s=s.apply(e,t)).next())});const wt=()=>{var a;const n=t(),{user:l}=Re(),[i,o]=e.useState(!1),{data:c,isLoading:d}=y({queryKey:["recent-inspections",null==l?void 0:l.id],queryFn:()=>Nt(void 0,null,function*(){if(!(null==l?void 0:l.id))throw new Error("User not authenticated");const{data:e,error:t}=yield Le.from("inspection_records").select("\n          id,\n          inspection_date,\n          inspection_time,\n          overall_status,\n          locations!inner (\n            id,\n            name,\n            building,\n            floor,\n            code\n          )\n        ").eq("user_id",l.id).order("inspection_date",{ascending:!1}).order("inspection_time",{ascending:!1}).limit(5);if(t)throw t;return e}),enabled:!!(null==l?void 0:l.id)}),{data:x}=y({queryKey:["user-stats",null==l?void 0:l.id],queryFn:()=>Nt(void 0,null,function*(){if(!(null==l?void 0:l.id))throw new Error("User not authenticated");const{data:e,error:t}=yield Le.from("inspection_records").select("id, overall_status, inspection_date").eq("user_id",l.id);if(t)throw t;return{total:e.length,completed:e.filter(e=>"completed"===e.overall_status).length,today:e.filter(e=>{const t=new Date(e.inspection_date||""),s=new Date;return t.toDateString()===s.toDateString()}).length}}),enabled:!!(null==l?void 0:l.id)});return s.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[s.jsxs("div",{className:"bg-gradient-to-br from-blue-600 to-blue-400 p-6 rounded-b-3xl shadow-lg",children:[s.jsxs("div",{className:"flex items-center justify-between text-white mb-6",children:[s.jsxs("div",{children:[s.jsxs("h1",{className:"text-2xl font-bold",children:["Hi, ",null==(a=null==l?void 0:l.email)?void 0:a.split("@")[0],"! ðŸ‘‹"]}),s.jsx("p",{className:"text-blue-100 mt-1",children:"Ready for inspection?"})]}),s.jsx("button",{onClick:()=>n("/locations"),className:"w-12 h-12 bg-white/20 backdrop-blur rounded-xl flex items-center justify-center hover:bg-white/30 transition-colors",title:"Manage Locations",children:s.jsx(v,{className:"w-6 h-6"})})]}),s.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[s.jsxs("div",{className:"bg-white/20 backdrop-blur rounded-xl p-3 text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-white",children:(null==x?void 0:x.total)||0}),s.jsx("div",{className:"text-xs text-blue-100 mt-1",children:"Total"})]}),s.jsxs("div",{className:"bg-white/20 backdrop-blur rounded-xl p-3 text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-white",children:(null==x?void 0:x.today)||0}),s.jsx("div",{className:"text-xs text-blue-100 mt-1",children:"Today"})]}),s.jsxs("div",{className:"bg-white/20 backdrop-blur rounded-xl p-3 text-center",children:[s.jsxs("div",{className:"text-2xl font-bold text-white",children:[x&&Math.round(x.completed/x.total*100)||0,"%"]}),s.jsx("div",{className:"text-xs text-blue-100 mt-1",children:"Success"})]})]})]}),s.jsxs("div",{className:"p-4 space-y-4 -mt-6",children:[s.jsx(ut,{className:"bg-gradient-to-r from-blue-600 to-blue-500 text-white shadow-xl",children:s.jsxs("button",{onClick:()=>o(!0),className:"w-full py-6 flex flex-col items-center space-y-3 active:scale-95 transition-transform",children:[s.jsx("div",{className:"w-16 h-16 bg-white/20 backdrop-blur rounded-2xl flex items-center justify-center",children:s.jsx(p,{className:"w-8 h-8"})}),s.jsxs("div",{className:"text-center",children:[s.jsx("h2",{className:"text-xl font-bold",children:"Scan QR Code"}),s.jsx("p",{className:"text-blue-100 text-sm mt-1",children:"Point camera at toilet location QR"})]})]})}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsxs(vt,{variant:"outline",onClick:()=>n("/locations"),className:"h-24 flex flex-col items-center justify-center space-y-2",children:[s.jsx(v,{className:"w-6 h-6 text-blue-600"}),s.jsx("span",{className:"text-sm font-medium",children:"Locations"})]}),s.jsxs(vt,{variant:"outline",onClick:()=>n("/dashboard"),className:"h-24 flex flex-col items-center justify-center space-y-2",children:[s.jsx(P,{className:"w-6 h-6 text-green-600"}),s.jsx("span",{className:"text-sm font-medium",children:"Dashboard"})]})]}),s.jsxs(ut,{children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("h3",{className:"font-semibold text-gray-900 flex items-center space-x-2",children:[s.jsx(M,{className:"w-5 h-5 text-gray-600"}),s.jsx("span",{children:"Recent Inspections"})]}),s.jsx("button",{onClick:()=>n("/dashboard"),className:"text-sm text-blue-600 hover:underline",children:"View All"})]}),s.jsx("div",{className:"space-y-3",children:d?s.jsx("div",{className:"text-center py-8 text-gray-500",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"})}):0===(null==c?void 0:c.length)?s.jsxs("div",{className:"text-center py-8 text-gray-500",children:[s.jsx(k,{className:"w-12 h-12 mx-auto mb-2 text-gray-300"}),s.jsx("p",{children:"No inspections yet"}),s.jsx("p",{className:"text-sm mt-1",children:"Scan a QR code to start"})]}):null==c?void 0:c.map(e=>{var t;return s.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-xl hover:bg-gray-100 transition-colors cursor-pointer",onClick:()=>n(`/inspect/${e.locations.id}`),children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center "+("completed"===e.overall_status?"bg-green-100 text-green-600":"bg-yellow-100 text-yellow-600"),children:"completed"===e.overall_status?s.jsx(_,{className:"w-5 h-5"}):s.jsx(r,{className:"w-5 h-5"})}),s.jsxs("div",{children:[s.jsx("div",{className:"font-medium text-gray-900",children:e.locations.name}),s.jsxs("div",{className:"text-sm text-gray-500",children:[e.locations.building," â€¢ ",e.locations.floor]})]})]}),s.jsxs("div",{className:"text-right",children:[s.jsx("div",{className:"text-sm font-medium text-gray-900",children:je(new Date(e.inspection_date),"dd MMM")}),s.jsx("div",{className:"text-xs text-gray-500",children:null==(t=e.inspection_time)?void 0:t.substring(0,5)})]})]},e.id)})})]})]}),s.jsx(at,{isOpen:i,onClose:()=>o(!1),onScan:e=>Nt(void 0,null,function*(){try{if(!/^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e))return void I.error("Invalid location ID format");const{data:t,error:s}=yield Le.from("locations").select("id, name, is_active, building, floor").eq("id",e).single();if(s||!t)return void I.error("Location not found. Please contact admin.");if(!t.is_active)return void I.error("This location is currently inactive");I.success(`Opening ${t.name}...`),o(!1),n(`/inspect/${t.id}`)}catch(t){I.error("Failed to process QR code")}})})]})},_t=({config:t,value:r,onChange:a,onPhotoAdd:n,hasPhoto:l,genZMode:i=!1,notes:o,onNotesChange:c})=>{const[d,x]=e.useState(!1),u=i?t.ratingLabels.genZ:t.ratingLabels.professional,m=i?t.iconGenZ:t.icon,h=i?t.labelGenZ:t.label;return s.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm border border-gray-100",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:`\n            w-12 h-12 rounded-xl flex items-center justify-center text-2xl\n            ${i?"bg-gradient-to-br from-purple-100 to-pink-100":"bg-blue-50"}\n          `,children:m}),s.jsxs("div",{children:[s.jsxs("h3",{className:"font-semibold "+(i?"text-purple-900":"text-gray-900"),children:[h,t.required&&s.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),!t.required&&s.jsx("span",{className:"text-xs text-gray-500",children:"Optional"})]})]}),t.allowPhoto&&s.jsx("button",{type:"button",onClick:n,className:`\n              p-2 rounded-xl transition-all\n              ${l?"bg-green-100 text-green-600":i?"bg-purple-100 text-purple-600 hover:bg-purple-200":"bg-gray-100 text-gray-600 hover:bg-gray-200"}\n            `,children:s.jsx(O,{className:"w-5 h-5"})})]}),s.jsx("div",{className:"space-y-2",children:[1,2,3,4,5].map(e=>{const t=r===e,n=kt(e,i);return s.jsxs("button",{type:"button",onClick:()=>a(e),className:`\n                w-full p-3 rounded-xl text-left transition-all\n                border-2 flex items-center justify-between\n                ${t?`${n.bg} ${n.border} ${n.text} shadow-md scale-[1.02]`:"bg-white border-gray-200 text-gray-700 hover:border-gray-300 hover:bg-gray-50"}\n              `,children:[s.jsx("span",{className:"font-medium",children:u[e]}),s.jsx("div",{className:`\n                w-8 h-8 rounded-full flex items-center justify-center text-lg\n                ${t?"bg-white/30":"bg-gray-100"}\n              `,children:St(e)})]},e)})}),r&&s.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-100",children:[s.jsx("button",{type:"button",onClick:()=>x(!d),className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:d?"âˆ’ Hide notes":"+ Add notes"}),d&&s.jsx("textarea",{value:o||"",onChange:e=>null==c?void 0:c(e.target.value),placeholder:i?"Catatan tambahan (optional)...":"Additional notes (optional)...",className:"w-full mt-2 px-3 py-2 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",rows:2})]})]})},kt=(e,t)=>{if(t)switch(e){case 5:return{bg:"bg-gradient-to-br from-green-50 to-emerald-50",border:"border-green-400",text:"text-green-900"};case 4:return{bg:"bg-gradient-to-br from-blue-50 to-cyan-50",border:"border-blue-400",text:"text-blue-900"};case 3:return{bg:"bg-gradient-to-br from-yellow-50 to-amber-50",border:"border-yellow-400",text:"text-yellow-900"};case 2:return{bg:"bg-gradient-to-br from-orange-50 to-red-50",border:"border-orange-400",text:"text-orange-900"};case 1:return{bg:"bg-gradient-to-br from-red-50 to-pink-50",border:"border-red-400",text:"text-red-900"}}else switch(e){case 5:return{bg:"bg-green-50",border:"border-green-500",text:"text-green-900"};case 4:return{bg:"bg-blue-50",border:"border-blue-500",text:"text-blue-900"};case 3:return{bg:"bg-yellow-50",border:"border-yellow-500",text:"text-yellow-900"};case 2:return{bg:"bg-orange-50",border:"border-orange-500",text:"text-orange-900"};case 1:return{bg:"bg-red-50",border:"border-red-500",text:"text-red-900"}}},St=e=>{switch(e){case 5:return"ðŸŒŸ";case 4:return"ðŸ˜Š";case 3:return"ðŸ˜";case 2:return"ðŸ˜Ÿ";case 1:return"ðŸ˜¨"}};var Ct=Object.defineProperty,Pt=Object.defineProperties,Mt=Object.getOwnPropertyDescriptors,It=Object.getOwnPropertySymbols,Ot=Object.prototype.hasOwnProperty,Et=Object.prototype.propertyIsEnumerable,qt=(e,t,s)=>t in e?Ct(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,Lt=(e,t)=>{for(var s in t||(t={}))Ot.call(t,s)&&qt(e,s,t[s]);if(It)for(var s of It(t))Et.call(t,s)&&qt(e,s,t[s]);return e},Dt=(e,t)=>Pt(e,Mt(t)),At=(e,t,s)=>new Promise((r,a)=>{var n=e=>{try{i(s.next(e))}catch(t){a(t)}},l=e=>{try{i(s.throw(e))}catch(t){a(t)}},i=e=>e.done?r(e.value):Promise.resolve(e.value).then(n,l);i((s=s.apply(e,t)).next())});const Tt=({photos:t,onPhotosChange:r,maxPhotos:a=3,genZMode:n=!1})=>{const l=e.useRef(null),[i,c]=e.useState(!1),d=t.length<a;return s.jsxs("div",{className:"space-y-3",children:[t.length>0&&s.jsx("div",{className:"grid grid-cols-2 gap-3",children:t.map((e,a)=>s.jsxs("div",{className:"relative group",children:[s.jsx("img",{src:e.preview,alt:`Photo ${a+1}`,className:"w-full h-32 object-cover rounded-xl border-2 border-gray-200"}),s.jsxs("div",{className:"absolute bottom-2 left-2 right-2 flex items-center justify-between",children:[e.location&&s.jsxs("div",{className:"bg-black/70 backdrop-blur-sm text-white text-xs px-2 py-1 rounded-lg flex items-center space-x-1",children:[s.jsx(v,{className:"w-3 h-3"}),s.jsx("span",{children:"GPS"})]}),s.jsxs("div",{className:"bg-black/70 backdrop-blur-sm text-white text-xs px-2 py-1 rounded-lg flex items-center space-x-1",children:[s.jsx(k,{className:"w-3 h-3"}),s.jsx("span",{children:je(new Date(e.timestamp),"HH:mm")})]})]}),s.jsx("button",{type:"button",onClick:()=>(e=>{const s=t.filter((t,s)=>s!==e);r(s)})(a),className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity shadow-lg",children:s.jsx(S,{className:"w-4 h-4"})})]},a))}),d&&s.jsx("button",{type:"button",onClick:()=>{var e;return null==(e=l.current)?void 0:e.click()},disabled:i,className:`\n            w-full h-24 border-2 border-dashed rounded-xl \n            flex flex-col items-center justify-center\n            transition-all\n            ${i?"bg-gray-100 border-gray-300 cursor-not-allowed":n?"border-purple-300 hover:border-purple-500 hover:bg-purple-50":"border-gray-300 hover:border-blue-500 hover:bg-blue-50"}\n          `,children:i?s.jsxs(s.Fragment,{children:[s.jsx(o,{className:"w-8 h-8 text-gray-400 animate-spin mb-2"}),s.jsx("span",{className:"text-sm text-gray-500",children:"Processing..."})]}):s.jsxs(s.Fragment,{children:[s.jsx(O,{className:"w-8 h-8 mb-2 "+(n?"text-purple-500":"text-gray-400")}),s.jsx("span",{className:"text-sm font-medium "+(n?"text-purple-600":"text-gray-600"),children:n?"ðŸ“¸ Foto yuk!":"Take Photo"}),s.jsxs("span",{className:"text-xs text-gray-400 mt-1",children:[t.length,"/",a," photos"]})]})}),s.jsx("input",{ref:l,type:"file",accept:"image/*",capture:"environment",onChange:e=>At(void 0,null,function*(){var s;const a=null==(s=e.target.files)?void 0:s[0];if(a){c(!0);try{const e=yield Ft(),s=e?yield Rt(e.lat,e.lng):void 0,n={file:a,preview:yield $t(a,{timestamp:(new Date).toISOString(),location:e?Dt(Lt({},e),{address:s}):void 0}),timestamp:(new Date).toISOString(),location:e?Dt(Lt({},e),{address:s}):void 0};r([...t,n])}catch(n){const e=URL.createObjectURL(a);r([...t,{file:a,preview:e,timestamp:(new Date).toISOString()}])}finally{c(!1),l.current&&(l.current.value="")}}}),className:"hidden"})]})},Ft=()=>new Promise(e=>{"geolocation"in navigator?navigator.geolocation.getCurrentPosition(t=>{e({lat:t.coords.latitude,lng:t.coords.longitude})},()=>e(null),{timeout:5e3}):e(null)}),Rt=(e,t)=>At(void 0,null,function*(){try{const s=yield fetch(`https://nominatim.openstreetmap.org/reverse?lat=${e}&lon=${t}&format=json`);return(yield s.json()).display_name}catch(s){return}}),$t=(e,t)=>At(void 0,null,function*(){return new Promise(s=>{const r=new Image,a=new FileReader;a.onload=e=>{var t;r.src=null==(t=e.target)?void 0:t.result},r.onload=()=>{const a=document.createElement("canvas");a.width=r.width,a.height=r.height;const n=a.getContext("2d");if(!n)return void s(URL.createObjectURL(e));n.drawImage(r,0,0);n.fillStyle="rgba(0, 0, 0, 0.6)",n.fillRect(0,a.height-60,a.width,60),n.fillStyle="white",n.font="bold 16px Arial";const l=je(new Date(t.timestamp),"dd/MM/yyyy HH:mm:ss");n.fillText(l,10,a.height-35),t.location&&(n.font="14px Arial",n.fillText(`ðŸ“ ${t.location.lat.toFixed(5)}, ${t.location.lng.toFixed(5)}`,10,a.height-10)),s(a.toDataURL("image/jpeg",.9))},a.readAsDataURL(e)})});const zt=e=>{return t=void 0,s=null,r=function*(){var t;const s=new FormData;s.append("file",e),s.append("upload_preset","toilet-checks"),s.append("cloud_name","dcg56qkae"),s.append("folder","toilet-inspections");try{const e=yield fetch("https://api.cloudinary.com/v1_1/dcg56qkae/image/upload",{method:"POST",body:s}),r=yield e.json();if(!e.ok)throw new Error((null==(t=r.error)?void 0:t.message)||"Upload failed");return r.secure_url}catch(r){throw new Error("Failed to upload photo")}},new Promise((e,a)=>{var n=e=>{try{i(r.next(e))}catch(t){a(t)}},l=e=>{try{i(r.throw(e))}catch(t){a(t)}},i=t=>t.done?e(t.value):Promise.resolve(t.value).then(n,l);i((r=r.apply(t,s)).next())});var t,s,r};var Ut=(e,t,s)=>new Promise((r,a)=>{var n=e=>{try{i(s.next(e))}catch(t){a(t)}},l=e=>{try{i(s.throw(e))}catch(t){a(t)}},i=e=>e.done?r(e.value):Promise.resolve(e.value).then(n,l);i((s=s.apply(e,t)).next())});const Gt=[{id:"aroma",label:"Aroma/Odor Level",labelGenZ:"Bau-bauan",weight:.15,icon:"Ã°Å¸â€˜Æ’",iconGenZ:"Ã°Å¸ËœÂ·",required:!0,allowPhoto:!1,ratingLabels:{professional:{1:"Very Poor - Strong unpleasant odor",2:"Poor - Noticeable odor",3:"Fair - Slight odor",4:"Good - Fresh",5:"Excellent - Very fresh"},genZ:{1:"Ã°Å¸Â¤Â¢ Bau banget!",2:"Ã°Å¸ËœÂ· Agak bau",3:"Ã°Å¸ËœÂ Lumayan",4:"Ã°Å¸ËœÅ  Seger",5:"Ã°Å¸Å’Â¸ Wangi poll!"}}},{id:"floor_cleanliness",label:"Floor Cleanliness",labelGenZ:"Kebersihan Lantai",weight:.12,icon:"Ã°Å¸Â§Â¹",iconGenZ:"Ã¢Å“Â¨",required:!0,allowPhoto:!0,ratingLabels:{professional:{1:"Very dirty - Major cleaning needed",2:"Dirty - Visible stains/debris",3:"Moderately clean",4:"Clean - Minor spots only",5:"Spotless"},genZ:{1:"Ã°Å¸Â¤Â® Kotor parah",2:"Ã°Å¸ËœÂ£ Kotor",3:"Ã°Å¸ËœÂ Lumayan bersih",4:"Ã°Å¸ËœÅ  Bersih",5:"Ã¢Å“Â¨ Kinclong!"}}},{id:"wall_condition",label:"Wall & Tile Condition",labelGenZ:"Kondisi Dinding",weight:.08,icon:"Ã°Å¸Â§Â±",iconGenZ:"Ã°Å¸Å½Â¨",required:!0,allowPhoto:!0,ratingLabels:{professional:{1:"Very poor - Damaged/moldy",2:"Poor - Visible stains",3:"Fair - Some marks",4:"Good - Clean",5:"Excellent - Pristine"},genZ:{1:"Ã°Å¸ËœÂ¨ Rusak/jamur",2:"Ã°Å¸ËœÅ¸ Bernoda",3:"Ã°Å¸ËœÂ Ada noda dikit",4:"Ã°Å¸ËœÅ  Bersih",5:"Ã°Å¸Å’Å¸ Mulus!"}}},{id:"sink_condition",label:"Sink & Faucet Condition",labelGenZ:"Kondisi Wastafel",weight:.1,icon:"Ã°Å¸Å¡Â°",iconGenZ:"Ã°Å¸â€™Â§",required:!0,allowPhoto:!0,ratingLabels:{professional:{1:"Not functional",2:"Poor - Clogged/leaking",3:"Fair - Minor issues",4:"Good - Functioning well",5:"Excellent - Perfect condition"},genZ:{1:"Ã¢ÂÅ’ Rusak",2:"Ã°Å¸ËœÂ« Mampet/bocor",3:"Ã°Å¸ËœÂ Agak bermasalah",4:"Ã°Å¸ËœÅ  Lancar",5:"Ã°Å¸â€™Â¯ Perfect!"}}},{id:"mirror_condition",label:"Mirror Cleanliness",labelGenZ:"Kebersihan Cermin",weight:.06,icon:"Ã°Å¸ÂªÅ¾",iconGenZ:"Ã¢Å“Â¨",required:!0,allowPhoto:!1,ratingLabels:{professional:{1:"Very dirty/damaged",2:"Dirty - Heavy stains",3:"Fair - Some spots",4:"Clean - Minor marks",5:"Spotless"},genZ:{1:"Ã°Å¸ËœÂµ Kotor/rusak",2:"Ã°Å¸ËœÂ£ Banyak noda",3:"Ã°Å¸ËœÂ Ada noda dikit",4:"Ã°Å¸ËœÅ  Bersih",5:"Ã¢Å“Â¨ Bening!"}}},{id:"toilet_condition",label:"Toilet Bowl Condition",labelGenZ:"Kondisi Kloset",weight:.15,icon:"Ã°Å¸Å¡Â½",iconGenZ:"Ã°Å¸Å¡Â½",required:!0,allowPhoto:!0,ratingLabels:{professional:{1:"Very dirty - Unsanitary",2:"Dirty - Visible stains",3:"Fair - Needs cleaning",4:"Clean",5:"Spotless - Sanitized"},genZ:{1:"Ã°Å¸Â¤Â¢ Jorok banget",2:"Ã°Å¸ËœÂ« Kotor",3:"Ã°Å¸ËœÂ Perlu dibersihkan",4:"Ã°Å¸ËœÅ  Bersih",5:"Ã°Å¸Å’Å¸ Bersih banget!"}}},{id:"urinal_condition",label:"Urinal Condition (if applicable)",labelGenZ:"Kondisi Urinoir",weight:.08,icon:"Ã°Å¸Å¡Â¿",iconGenZ:"Ã°Å¸Å¡Â¿",required:!1,allowPhoto:!0,ratingLabels:{professional:{1:"Very poor - Not functional",2:"Poor - Clogged/dirty",3:"Fair - Needs attention",4:"Good - Clean & functional",5:"Excellent - Pristine"},genZ:{1:"Ã¢ÂÅ’ Rusak",2:"Ã°Å¸ËœÂ« Mampet/kotor",3:"Ã°Å¸ËœÂ Perlu perhatian",4:"Ã°Å¸ËœÅ  Bersih & lancar",5:"Ã°Å¸â€™Â¯ Perfect!"}}},{id:"soap_availability",label:"Hand Soap Availability",labelGenZ:"Sabun Cuci Tangan",weight:.08,icon:"Ã°Å¸Â§Â´",iconGenZ:"Ã°Å¸Â§Â¼",required:!0,allowPhoto:!1,ratingLabels:{professional:{1:"Empty - No soap",2:"Almost empty",3:"Half full",4:"Good supply",5:"Full - Well stocked"},genZ:{1:"Ã¢ÂÅ’ Habis",2:"Ã°Å¸ËœÅ¸ Tinggal dikit",3:"Ã°Å¸ËœÂ Setengah",4:"Ã°Å¸ËœÅ  Cukup",5:"Ã¢Å“â€¦ Full!"}}},{id:"tissue_availability",label:"Toilet Tissue Availability",labelGenZ:"Tisu/Tissue",weight:.08,icon:"Ã°Å¸Â§Â»",iconGenZ:"Ã°Å¸Â§Â»",required:!0,allowPhoto:!1,ratingLabels:{professional:{1:"Empty - No tissue",2:"Almost empty",3:"Half roll",4:"Good supply",5:"Full - Well stocked"},genZ:{1:"Ã¢ÂÅ’ Habis",2:"Ã°Å¸ËœÅ¸ Mau habis",3:"Ã°Å¸ËœÂ Setengah",4:"Ã°Å¸ËœÅ  Cukup",5:"Ã¢Å“â€¦ Full!"}}},{id:"air_freshener",label:"Air Freshener Status",labelGenZ:"Pengharum Ruangan",weight:.05,icon:"Ã°Å¸Å’Â¬Ã¯Â¸Â",iconGenZ:"Ã°Å¸Å’Â¸",required:!0,allowPhoto:!1,ratingLabels:{professional:{1:"Not working/missing",2:"Empty/weak",3:"Partially effective",4:"Working well",5:"Excellent - Strong & pleasant"},genZ:{1:"Ã¢ÂÅ’ Rusak/gak ada",2:"Ã°Å¸ËœÅ¸ Habis/lemah",3:"Ã°Å¸ËœÂ Lumayan",4:"Ã°Å¸ËœÅ  Bagus",5:"Ã°Å¸Å’Â¸ Wangi poll!"}}},{id:"trash_bin_condition",label:"Trash Bin Condition",labelGenZ:"Kondisi Tempat Sampah",weight:.05,icon:"Ã°Å¸â€”â€˜Ã¯Â¸Â",iconGenZ:"Ã°Å¸â€”â€˜Ã¯Â¸Â",required:!0,allowPhoto:!0,ratingLabels:{professional:{1:"Overflowing - Critical",2:"Nearly full",3:"Half full",4:"Quarter full",5:"Empty - Clean"},genZ:{1:"Ã°Å¸Â¤Â® Penuh meluber",2:"Ã°Å¸ËœÂ« Hampir penuh",3:"Ã°Å¸ËœÂ Setengah",4:"Ã°Å¸ËœÅ  Masih kosong",5:"Ã¢Å“â€¦ Kosong & bersih!"}}}],Zt=e=>{let t=0,s=0;return e.forEach(e=>{const r=Gt.find(t=>t.id===e.component);if(r){const a=(e.rating-1)/4*100;t+=a*r.weight,s+=r.weight}}),s>0?Math.round(t/s):0};var Kt=Object.defineProperty,Bt=Object.defineProperties,Ht=Object.getOwnPropertyDescriptors,Qt=Object.getOwnPropertySymbols,Wt=Object.prototype.hasOwnProperty,Vt=Object.prototype.propertyIsEnumerable,Yt=(e,t,s)=>t in e?Kt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,Jt=(e,t)=>{for(var s in t||(t={}))Wt.call(t,s)&&Yt(e,s,t[s]);if(Qt)for(var s of Qt(t))Vt.call(t,s)&&Yt(e,s,t[s]);return e},Xt=(e,t)=>Bt(e,Ht(t));const es=({locationId:a,genZMode:n=!1,onToggleMode:l})=>{const i=t(),{user:o,profile:c}=Re(),{getLocation:d,submitInspection:x}=(e=>{const t=E(),s=y({queryKey:["inspection",e],queryFn:()=>Ut(void 0,null,function*(){return null}),enabled:!1}),r=y({queryKey:["default-template"],queryFn:()=>Ut(void 0,null,function*(){const{data:e,error:t}=yield Le.from("inspection_templates").select("*").eq("is_default",!0).eq("is_active",!0).single();return t?{id:"comprehensive-template",name:"Comprehensive Inspection",description:"Default comprehensive inspection template",fields:{components:[],requiredPhotos:0,maxPhotos:10,allowNotes:!0},estimated_time:300,is_active:!0,is_default:!0,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()}:e}),retry:1}),a=q({mutationFn:e=>Ut(void 0,null,function*(){var t;const{location_id:s,user_id:a,responses:n,photos:l,notes:i,duration_seconds:o}=e;if(!s||!a)throw new Error("Location ID and User ID are required");const c=[];if(l&&l.length>0)try{const e=l.map(e=>zt(e)),t=yield Promise.all(e);c.push(...t.filter(e=>null!==e))}catch(j){}let d="comprehensive-template";try{const e=yield r.refetch();(null==(t=e.data)?void 0:t.id)&&(d=e.data.id)}catch(j){}const x=new Date,u=x.toISOString().split("T")[0],m=x.toTimeString().split(" ")[0],h=x.toISOString(),g=n.score||0;let p="satisfactory";p=g>=90?"excellent":g>=75?"good":g>=60?"fair":g>=40?"poor":"very_poor";const b={location_id:s,user_id:a,template_id:d,inspection_date:u,inspection_time:m,overall_status:p,responses:n,photo_urls:c.length>0?c:null,notes:(null==i?void 0:i.trim())||null,submitted_at:h,duration_seconds:o||null,verification_notes:null,verified_at:null,verified_by:null},{data:f,error:y}=yield Le.from("inspection_records").insert(b).select("\n          *,\n          locations:location_id (\n            name,\n            building,\n            floor,\n            area\n          )\n        ").single();if(y)throw new Error(`Failed to submit inspection: ${y.message}`);return f}),onSuccess:()=>{t.invalidateQueries({queryKey:["inspections"]}),t.invalidateQueries({queryKey:["location-inspections"]})},onError:e=>{}});return{getInspection:s,getDefaultTemplate:r,getLocation:e=>y({queryKey:["location",e],queryFn:()=>Ut(void 0,null,function*(){if(!e)throw new Error("Location ID is required");const{data:t,error:s}=yield Le.from("locations_with_details").select("*").eq("id",e).single();if(s)throw new Error(`Failed to fetch location: ${s.message}`);return t}),enabled:!!e}),submitInspection:a,getLocationInspections:e=>y({queryKey:["location-inspections",e],queryFn:()=>Ut(void 0,null,function*(){if(!e)return[];const{data:t,error:s}=yield Le.from("inspection_records").select("\n          *,\n          users:user_id (\n            full_name,\n            email\n          )\n        ").eq("location_id",e).order("submitted_at",{ascending:!1});if(s)throw new Error(`Failed to fetch inspections: ${s.message}`);return t}),enabled:!!e})}})(),[m,h]=e.useState(new Map),[g,p]=e.useState(new Map),[b,f]=e.useState(""),[j,v]=e.useState(!1),[N,w]=e.useState(""),[k,S]=e.useState(!1),[C,P]=e.useState("low"),[M,I]=e.useState(!1),[O]=e.useState(new Date),[A,T]=e.useState(0),[F,R]=e.useState(Gt[0].id),{data:$,isLoading:z,error:U}=d(a);e.useEffect(()=>{const e=Array.from(m.values());if(e.length>0){const t=Zt(e);T(t)}else T(0)},[m]);if(z)return s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});if(U||!$)return s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:s.jsxs("div",{className:"text-center",children:[s.jsx(r,{className:"w-12 h-12 text-red-500 mx-auto mb-2"}),s.jsx("p",{className:"text-gray-700",children:n?"Lokasi gak ketemu ðŸ˜¢":"Location not found"}),s.jsx("button",{onClick:()=>i("/scan"),className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-colors",children:n?"Kembali ke Scan":"Back to Scan"})]})});const G=$,Z=(K=A)>=90?{label:"Excellent",labelGenZ:"Perfect! Ã°Å¸Å½â€°",color:"green",emoji:"Ã°Å¸Å’Å¸"}:K>=75?{label:"Good",labelGenZ:"Bagus! Ã°Å¸â€˜Â",color:"blue",emoji:"Ã°Å¸ËœÅ "}:K>=60?{label:"Fair",labelGenZ:"Lumayan",color:"yellow",emoji:"Ã°Å¸ËœÂ"}:K>=40?{label:"Poor",labelGenZ:"Kurang nih",color:"orange",emoji:"Ã°Å¸ËœÅ¸"}:{label:"Very Poor",labelGenZ:"Harus diperbaiki!",color:"red",emoji:"Ã°Å¸ËœÂ¨"};var K;const B=m.size,H=Gt.filter(e=>e.required).length,Q=B/Gt.length*100,W=Array.from(g.values()).flat().length;return s.jsxs("div",{className:"min-h-screen pb-32 "+(n?"bg-gradient-to-br from-purple-50 via-pink-50 to-blue-50":"bg-gray-50"),children:[s.jsx("div",{className:`\n        sticky top-0 z-20 \n        ${n?"bg-gradient-to-r from-purple-600 to-pink-600":"bg-white border-b border-gray-200"}\n        shadow-sm\n      `,children:s.jsxs("div",{className:"p-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsx("button",{onClick:()=>i(-1),className:"p-2 rounded-xl "+(n?"bg-white/20 text-white":"bg-gray-100 text-gray-700"),children:s.jsx(L,{className:"w-5 h-5"})}),l&&s.jsx("button",{onClick:l,className:`\n                  px-4 py-2 rounded-xl text-sm font-medium transition-all\n                  ${n?"bg-white/20 text-white hover:bg-white/30":"bg-gray-100 text-gray-700 hover:bg-gray-200"}\n                `,children:n?"ðŸ’¼ Pro Mode":"ðŸŽ¨ Gen Z Mode"})]}),s.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[s.jsx("div",{className:`\n              w-12 h-12 rounded-xl flex items-center justify-center text-2xl\n              ${n?"bg-white/20":"bg-blue-100"}\n            `,children:"ðŸš½"}),s.jsxs("div",{className:n?"text-white":"text-gray-900",children:[s.jsx("h1",{className:"font-bold text-lg",children:G.name}),s.jsx("p",{className:"text-sm "+(n?"text-white/80":"text-gray-600"),children:[G.building,G.floor,G.area].filter(Boolean).join(" â€¢ ")})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center justify-between text-sm",children:[s.jsx("span",{className:n?"text-white/90":"text-gray-600",children:n?`Progress ${B}/${Gt.length}`:`${B} of ${Gt.length} completed`}),A>0&&s.jsxs("span",{className:"font-bold "+(n?"text-white":"text-blue-600"),children:["Score: ",A]})]}),s.jsx("div",{className:"w-full h-2 bg-white/20 rounded-full overflow-hidden",children:s.jsx("div",{className:"h-full transition-all duration-300 "+(n?"bg-white":"bg-blue-600"),style:{width:`${Math.max(5,Q)}%`}})})]})]})}),s.jsxs("div",{className:"p-4 space-y-4",children:[Gt.map(e=>{const t=m.get(e.id),r=g.get(e.id)||[],a=F===e.id;return s.jsxs("div",{children:[a?s.jsx(_t,{config:e,value:(null==t?void 0:t.rating)||null,onChange:t=>((e,t)=>{const s=m.get(e)||{component:e,rating:1};h(new Map(m.set(e,Xt(Jt({},s),{rating:t}))))})(e.id,t),onPhotoAdd:e.allowPhoto?()=>{}:void 0,hasPhoto:r.length>0,genZMode:n,notes:null==t?void 0:t.notes,onNotesChange:t=>((e,t)=>{const s=m.get(e);s&&h(new Map(m.set(e,Xt(Jt({},s),{notes:t}))))})(e.id,t)}):s.jsxs("button",{type:"button",onClick:()=>R(e.id),className:`\n                    w-full p-4 rounded-2xl flex items-center justify-between\n                    transition-all border-2\n                    ${t?n?"bg-gradient-to-r from-green-50 to-emerald-50 border-green-400":"bg-green-50 border-green-500":n?"bg-white/80 border-purple-200 hover:border-purple-400":"bg-white border-gray-200 hover:border-gray-300"}\n                  `,children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("span",{className:"text-2xl",children:n?e.iconGenZ:e.icon}),s.jsx("span",{className:"font-medium text-gray-900",children:n?e.labelGenZ:e.label})]}),t?s.jsx(_,{className:"w-5 h-5 text-green-600"}):e.required?s.jsx("span",{className:"text-red-500",children:"*"}):null]}),a&&e.allowPhoto&&s.jsx("div",{className:"mt-3",children:s.jsx(Tt,{componentId:e.id,photos:r,onPhotosChange:t=>{return s=e.id,r=t,void p(new Map(g.set(s,r)));var s,r},genZMode:n})}),a&&s.jsx("button",{type:"button",onClick:()=>R(null),className:`\n                    w-full mt-2 py-2 rounded-xl text-sm font-medium\n                    ${n?"bg-purple-100 text-purple-700 hover:bg-purple-200":"bg-gray-100 text-gray-700 hover:bg-gray-200"}\n                  `,children:n?"â†‘ Minimize":"â†‘ Collapse"})]},e.id)}),s.jsxs("div",{className:(n?"bg-white/80":"bg-white")+" rounded-2xl p-4 shadow-sm border border-gray-100",children:[s.jsxs("label",{className:"flex items-center justify-between mb-3",children:[s.jsx("span",{className:"font-semibold text-gray-900",children:n?"âš ï¸ Ada masalah yang ditemukan?":"Issues Found?"}),s.jsx("input",{type:"checkbox",checked:j,onChange:e=>v(e.target.checked),className:"w-5 h-5 text-blue-600 rounded focus:ring-blue-500"})]}),j&&s.jsx("textarea",{value:N,onChange:e=>w(e.target.value),placeholder:n?"Jelasin masalahnya...":"Describe the issues found...",className:"w-full px-3 py-2 border border-gray-300 rounded-xl focus:ring-blue-500 focus:border-blue-500 resize-none",rows:3})]}),s.jsxs("div",{className:(n?"bg-white/80":"bg-white")+" rounded-2xl p-4 shadow-sm border border-gray-100",children:[s.jsxs("label",{className:"flex items-center justify-between mb-3",children:[s.jsx("span",{className:"font-semibold text-gray-900",children:n?"ðŸ”§ Perlu maintenance?":"Requires Maintenance?"}),s.jsx("input",{type:"checkbox",checked:k,onChange:e=>S(e.target.checked),className:"w-5 h-5 text-blue-600 rounded focus:ring-blue-500"})]}),k&&s.jsx("div",{className:"grid grid-cols-2 gap-2",children:["low","medium","high","urgent"].map(e=>s.jsx("button",{type:"button",onClick:()=>P(e),className:`\n                    py-2 px-3 rounded-xl text-sm font-medium capitalize\n                    ${C===e?"urgent"===e?"bg-red-100 text-red-700 border-2 border-red-500":"high"===e?"bg-orange-100 text-orange-700 border-2 border-orange-500":"medium"===e?"bg-yellow-100 text-yellow-700 border-2 border-yellow-500":"bg-blue-100 text-blue-700 border-2 border-blue-500":"bg-gray-100 text-gray-700 border-2 border-gray-200"}\n                  `,children:e},e))})]}),s.jsxs("div",{className:(n?"bg-white/80":"bg-white")+" rounded-2xl p-4 shadow-sm border border-gray-100",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:n?"ðŸ“ Catatan tambahan (opsional)":"General Notes (Optional)"}),s.jsx("textarea",{value:b,onChange:e=>f(e.target.value),placeholder:n?"Ada yang mau ditambahin?":"Any additional observations...",className:"w-full px-3 py-2 border border-gray-300 rounded-xl focus:ring-blue-500 focus:border-blue-500 resize-none",rows:3})]}),W>0&&s.jsxs("div",{className:(n?"bg-white/80":"bg-white")+" rounded-2xl p-4 shadow-sm border border-gray-100",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsx("h3",{className:"font-semibold text-gray-900",children:n?"ðŸ“¸ Foto yang akan diupload":"ðŸ“¸ Photos to Upload"}),s.jsxs("span",{className:"text-sm px-3 py-1 rounded-full "+(n?"bg-purple-100 text-purple-700":"bg-blue-100 text-blue-700"),children:[W," ",1===W?"photo":"photos"]})]}),s.jsx("div",{className:"grid grid-cols-3 gap-3",children:Array.from(g.entries()).map(([e,t])=>t.map((t,r)=>{const a=Gt.find(t=>t.id===e);return s.jsxs("div",{className:"relative group",children:[s.jsx("img",{src:t.preview,alt:`${null==a?void 0:a.label} photo`,className:"w-full h-24 object-cover rounded-xl border-2 border-gray-200"}),s.jsx("div",{className:"absolute top-1 left-1 bg-black/70 backdrop-blur-sm text-white text-xs px-2 py-1 rounded-lg",children:n?null==a?void 0:a.iconGenZ:null==a?void 0:a.icon}),s.jsxs("div",{className:"absolute bottom-1 left-1 right-1 flex items-center justify-between",children:[t.location&&s.jsx("div",{className:"bg-black/70 backdrop-blur-sm text-white text-xs px-1.5 py-0.5 rounded flex items-center space-x-0.5",children:s.jsx("span",{children:"ðŸ“"})}),s.jsx("div",{className:"bg-black/70 backdrop-blur-sm text-white text-xs px-1.5 py-0.5 rounded flex items-center space-x-0.5",children:s.jsx("span",{children:"â°"})})]})]},`${e}-${r}`)}))}),s.jsx("p",{className:"text-xs text-gray-500 mt-3 text-center",children:n?"âœ¨ Semua foto udah include GPS & timestamp":"âœ¨ All photos include GPS location & timestamp"})]}),A>0&&s.jsxs("div",{className:`\n            rounded-2xl p-6 text-center shadow-lg\n            ${n?"bg-gradient-to-br from-purple-100 to-pink-100":"bg-gradient-to-br from-blue-50 to-indigo-50"}\n          `,children:[s.jsx("div",{className:"text-6xl mb-2",children:Z.emoji}),s.jsx("div",{className:"text-4xl font-bold text-gray-900 mb-2",children:A}),s.jsx("div",{className:"text-lg font-semibold "+("green"===Z.color?"text-green-700":"blue"===Z.color?"text-blue-700":"yellow"===Z.color?"text-yellow-700":"orange"===Z.color?"text-orange-700":"text-red-700"),children:n?Z.labelGenZ:Z.label})]})]}),s.jsx("div",{className:"fixed bottom-0 left-0 right-0 p-4 bg-white border-t border-gray-200 safe-area-bottom",children:s.jsx("button",{type:"button",onClick:()=>{return e=void 0,t=null,s=function*(){var e;if(o){if((()=>{const e=Gt.filter(e=>e.required).filter(e=>!m.has(e.id));if(e.length>0){const t=e.map(e=>n?e.labelGenZ:e.label).join(", ");return u.error(n?`Masih ada yang belum diisi: ${t}`:`Please rate: ${t}`),R(e[0].id),!1}return j&&!N.trim()?(u.error(n?"Tolong jelasin masalah yang ditemukan!":"Please describe the issues found"),!1):!(k&&!C&&(u.error(n?"Pilih prioritas maintenance!":"Please select maintenance priority"),1))})()){I(!0);try{const s=new Date,r=Math.floor((s.getTime()-O.getTime())/1e3),l=[],d=new Map(m);for(const[e,a]of g.entries())for(const s of a)try{const t=yield zt(s.file);if(t){l.push(t);const s=d.get(e);s&&(s.photo=t,d.set(e,s))}}catch(t){}const h={ratings:Array.from(d.values()),score:A,issues_found:j,issue_description:j?N.trim():null,requires_maintenance:k,maintenance_priority:k?C:null,inspection_mode:n?"genz":"professional",submitted_at:(new Date).toISOString(),inspector:{id:o.id,name:(null==c?void 0:c.full_name)||(null==(e=o.email)?void 0:e.split("@")[0])||"Unknown Inspector",email:o.email,profile_id:null==c?void 0:c.id}},p=Array.from(g.values()).flat().map(e=>e.file);yield x.mutateAsync({location_id:a,user_id:o.id,responses:h,photos:p,notes:b.trim()||void 0,duration_seconds:r}),u.success(n?`ðŸŽ‰ Inspection selesai! Score: ${A}`:`Inspection submitted successfully! Score: ${A}`),setTimeout(()=>{i("/scan",{replace:!0})},1500)}catch(t){u.error(n?"Gagal submit inspection. Coba lagi ya!":t.message||"Failed to submit inspection")}finally{I(!1)}}}else u.error("Please login first")},new Promise((r,a)=>{var n=e=>{try{i(s.next(e))}catch(t){a(t)}},l=e=>{try{i(s.throw(e))}catch(t){a(t)}},i=e=>e.done?r(e.value):Promise.resolve(e.value).then(n,l);i((s=s.apply(e,t)).next())});var e,t,s},disabled:M||B<H,className:`\n            w-full py-4 rounded-2xl font-semibold shadow-lg\n            flex items-center justify-center space-x-2\n            transition-all disabled:opacity-50 disabled:cursor-not-allowed\n            active:scale-95\n            ${n?"bg-gradient-to-r from-purple-600 to-pink-600 text-white":"bg-blue-600 text-white"}\n          `,children:M?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),s.jsx("span",{children:"Submitting..."})]}):s.jsxs(s.Fragment,{children:[s.jsx(D,{className:"w-5 h-5"}),s.jsx("span",{children:n?"Submit Inspection "+(B<H?`(${H-B} lagi!)`:"ðŸŽ‰"):"Submit Inspection "+(B<H?`(${H-B} remaining)`:"")})]})})})]})},ts=()=>{const{locationId:t}=A(),[a,n]=e.useState(()=>{const e=localStorage.getItem("genZMode");return!!e&&JSON.parse(e)});return t?s.jsx(es,{locationId:t,genZMode:a,onToggleMode:()=>{const e=!a;n(e),localStorage.setItem("genZMode",JSON.stringify(e))}}):s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:s.jsxs("div",{className:"text-center",children:[s.jsx(r,{className:"w-12 h-12 text-red-500 mx-auto mb-3"}),s.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:"Invalid Location"}),s.jsx("p",{className:"text-gray-600",children:"No location ID provided in URL"})]})})};var ss=(e,t,s)=>new Promise((r,a)=>{var n=e=>{try{i(s.next(e))}catch(t){a(t)}},l=e=>{try{i(s.throw(e))}catch(t){a(t)}},i=e=>e.done?r(e.value):Promise.resolve(e.value).then(n,l);i((s=s.apply(e,t)).next())});const rs=(e,t)=>y({queryKey:["monthly-inspections",e,je(t,"yyyy-MM")],queryFn:()=>ss(void 0,null,function*(){if(!e)return[];const s=je(ve(t),"yyyy-MM-dd"),r=je(Ne(t),"yyyy-MM-dd"),{data:a,error:n}=yield Le.from("inspection_records").select("\n          id,\n          inspection_date,\n          inspection_time,\n          overall_status,\n          responses,\n          photo_urls,\n          notes,\n          location:locations!inner(id, name, building, floor),\n          user:users!inspection_records_user_id_fkey(id, full_name)\n        ").eq("user_id",e).gte("inspection_date",s).lte("inspection_date",r).order("inspection_date",{ascending:!1}).order("inspection_time",{ascending:!1});if(n)throw n;const l=(a||[]).reduce((e,t)=>{const s=t.inspection_date;return e[s]||(e[s]=[]),e[s].push({id:t.id,inspection_date:t.inspection_date,inspection_time:t.inspection_time,overall_status:t.overall_status,responses:t.responses,location:t.location,user:t.user,photo_urls:t.photo_urls||[],notes:t.notes}),e},{});return Object.entries(l).map(([e,t])=>{const s=t.map(e=>(e=>{if(!e)return 0;if("number"==typeof e.score)return e.score;if(Array.isArray(e.ratings)&&e.ratings.length>0)return Zt(e.ratings);const t=Object.values(e).filter(e=>"string"==typeof e||"boolean"==typeof e);if(0===t.length)return 0;const s=t.filter(e=>!0===e||"good"===e||"excellent"===e||"baik"===e||"bersih"===e).length;return Math.round(s/t.length*100)})(e.responses));return{date:e,inspections:t,averageScore:s.length>0?Math.round(s.reduce((e,t)=>e+t,0)/s.length):0,count:t.length}})}),enabled:!!e}),as=({currentDate:e,onDateChange:t,dateInspections:r,onDateClick:a})=>{const n=ve(e),l=Ne(e),i=we({start:n,end:l}),o=n.getDay(),c=Array(o).fill(null);return s.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100",children:[s.jsxs("div",{className:"p-4 border-b border-gray-100",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("button",{onClick:()=>{t(ke(e,1))},className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:s.jsx(T,{className:"w-5 h-5 text-gray-600"})}),s.jsx("h2",{className:"text-lg font-bold text-gray-900",children:je(e,"MMMM yyyy")}),s.jsx("button",{onClick:()=>{t(Se(e,1))},className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:s.jsx(N,{className:"w-5 h-5 text-gray-600"})})]}),s.jsx("div",{className:"grid grid-cols-7 gap-1 mt-4",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(e=>s.jsx("div",{className:"text-center text-xs font-medium text-gray-500 py-2",children:e},e))})]}),s.jsx("div",{className:"p-2",children:s.jsxs("div",{className:"grid grid-cols-7 gap-1",children:[c.map((e,t)=>s.jsx("div",{className:"aspect-square"},`empty-${t}`)),i.map(e=>{const t=(e=>{const t=je(e,"yyyy-MM-dd");return r.find(e=>e.date===t)})(e),n=t&&t.count>0,l=_e(e),i=je(e,"yyyy-MM-dd");return s.jsxs("button",{onClick:()=>n&&a(i),disabled:!n,className:`\n                  aspect-square p-1 rounded-lg transition-all relative\n                  ${l?"ring-2 ring-blue-500":""}\n                  ${n?"hover:bg-gray-50 cursor-pointer active:scale-95":"cursor-default opacity-40"}\n                `,children:[s.jsx("div",{className:`\n                  text-sm font-medium\n                  ${l?"text-blue-600 font-bold":"text-gray-700"}\n                `,children:je(e,"d")}),n&&s.jsx("div",{className:"absolute bottom-1 left-1/2 transform -translate-x-1/2",children:s.jsx("div",{className:"w-1.5 h-1.5 rounded-full "+(o=t.averageScore,o>=85?"bg-green-500":o>=70?"bg-yellow-500":"bg-red-500")})})]},e.toISOString());var o})]})}),s.jsxs("div",{className:"p-4 border-t border-gray-100 flex items-center justify-center space-x-4 text-xs text-gray-600",children:[s.jsxs("div",{className:"flex items-center space-x-1",children:[s.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500"}),s.jsx("span",{children:"Good (85+)"})]}),s.jsxs("div",{className:"flex items-center space-x-1",children:[s.jsx("div",{className:"w-2 h-2 rounded-full bg-yellow-500"}),s.jsx("span",{children:"Fair (70-84)"})]}),s.jsxs("div",{className:"flex items-center space-x-1",children:[s.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500"}),s.jsx("span",{children:"Poor (<70)"})]})]})]})},ns=({isOpen:t,onClose:r,inspections:a,selectedDate:n,onInspectionClick:l})=>{const[i,o]=e.useState(0),[c,d]=e.useState(0),[x,u]=e.useState(!1);if(e.useEffect(()=>(document.body.style.overflow=t?"hidden":"unset",()=>{document.body.style.overflow="unset"}),[t]),!t)return null;const m=je(new Date(n),"EEEE, MMMM d, yyyy");return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 transition-opacity",onClick:r}),s.jsxs("div",{className:"fixed bottom-0 left-0 right-0 bg-white rounded-t-3xl shadow-2xl z-50 max-h-[80vh] flex flex-col transition-transform",style:{transform:`translateY(${c}px)`},children:[s.jsx("div",{className:"py-3 flex justify-center cursor-grab active:cursor-grabbing",onTouchStart:e=>{o(e.touches[0].clientY),u(!0)},onTouchMove:e=>{if(!x)return;const t=e.touches[0].clientY-i;t>0&&d(t)},onTouchEnd:()=>{u(!1),c>100&&r(),d(0)},children:s.jsx("div",{className:"w-12 h-1.5 bg-gray-300 rounded-full"})}),s.jsx("div",{className:"px-6 pb-4 border-b border-gray-100",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"Inspections"}),s.jsx("p",{className:"text-sm text-gray-600 mt-0.5",children:m}),s.jsx("div",{className:"flex items-center space-x-2 mt-2",children:s.jsxs("span",{className:"px-2 py-1 bg-blue-100 text-blue-700 text-xs font-medium rounded-full",children:[a.length," inspection",a.length>1?"s":""]})})]}),s.jsx("button",{onClick:r,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:s.jsx(S,{className:"w-5 h-5 text-gray-600"})})]})}),s.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-4 space-y-3",children:a.map(e=>{var t;const r=(null==(t=e.responses)?void 0:t.score)||0,a=(e=>e>=85?"bg-green-100 text-green-700 border-green-200":e>=70?"bg-yellow-100 text-yellow-700 border-yellow-200":"bg-red-100 text-red-700 border-red-200")(r),n=(e=>e>=85?"ðŸ˜Š":e>=70?"ðŸ˜":"ðŸ˜Ÿ")(r);return s.jsxs("button",{onClick:()=>l(e),className:"w-full bg-gray-50 rounded-xl p-4 hover:bg-gray-100 transition-colors active:scale-[0.98] text-left",children:[s.jsxs("div",{className:"flex items-start justify-between space-x-3",children:[s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[s.jsx(v,{className:"w-4 h-4 text-blue-600 flex-shrink-0"}),s.jsx("h3",{className:"font-semibold text-gray-900 truncate",children:e.location.name})]}),s.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.location.building&&s.jsxs("p",{className:"truncate",children:["ðŸ¢ ",e.location.building," â€¢ ",e.location.floor]}),s.jsxs("div",{className:"flex items-center space-x-1",children:[s.jsx(k,{className:"w-3.5 h-3.5"}),s.jsx("span",{children:e.inspection_time})]})]}),e.photo_urls.length>0&&s.jsx("div",{className:"mt-2",children:s.jsxs("span",{className:"text-xs text-gray-500",children:["ðŸ“¸ ",e.photo_urls.length," photo",e.photo_urls.length>1?"s":""]})})]}),s.jsxs("div",{className:"flex flex-col items-end flex-shrink-0",children:[s.jsxs("div",{className:`\n                      px-3 py-2 rounded-xl border-2 font-bold\n                      flex items-center space-x-1.5\n                      ${a}\n                    `,children:[s.jsx("span",{className:"text-lg",children:n}),s.jsx("span",{className:"text-xl",children:r})]}),s.jsx("span",{className:"text-xs text-gray-500 mt-1",children:"Score"})]})]}),e.notes&&s.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:s.jsxs("p",{className:"text-sm text-gray-600 line-clamp-2",children:["ðŸ’¬ ",e.notes]})})]},e.id)})})]})]})},ls=e=>e>=85?"bg-green-100 text-green-700":e>=70?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700",is=e=>["ðŸ˜¨","ðŸ˜Ÿ","ðŸ˜","ðŸ˜Š","ðŸŒŸ"][e-1]||"ðŸ˜",os=({isOpen:e,onClose:t,inspection:r})=>{if(!e||!r)return null;const a=r.responses,n=(e=>{if(!e)return 0;if("number"==typeof e.score)return e.score;if(Array.isArray(e.ratings)&&e.ratings.length>0)return Zt(e.ratings);const t=Object.values(e).filter(e=>"string"==typeof e||"boolean"==typeof e);if(0===t.length)return 0;const s=t.filter(e=>!0===e||"good"===e||"excellent"===e||"baik"===e).length;return Math.round(s/t.length*100)})(a),l=(null==a?void 0:a.ratings)||[],i=je(new Date(r.inspection_date),"EEEE, MMMM d, yyyy");return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 backdrop-blur-sm",onClick:t}),s.jsxs("div",{className:"fixed inset-x-4 top-[5%] bottom-[5%] bg-white rounded-3xl shadow-2xl z-50 flex flex-col overflow-hidden max-w-2xl mx-auto",children:[s.jsxs("div",{className:"flex-shrink-0 p-6 border-b border-gray-100",children:[s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-1",children:"Inspection Details"}),s.jsx("p",{className:"text-sm text-gray-600",children:i})]}),s.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors flex-shrink-0",children:s.jsx(S,{className:"w-5 h-5 text-gray-600"})})]}),s.jsx("div",{className:"mt-4",children:s.jsxs("div",{className:`\n              inline-flex items-center space-x-2 px-4 py-2 rounded-xl font-bold\n              ${ls(n)}\n            `,children:[s.jsx("span",{className:"text-2xl",children:n>=85?"ðŸŒŸ":n>=70?"ðŸ˜Š":"ðŸ˜Ÿ"}),s.jsx("span",{className:"text-2xl",children:n}),s.jsx("span",{className:"text-sm font-normal",children:"Overall Score"})]})})]}),s.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[s.jsx("div",{className:"bg-blue-50 rounded-xl p-4",children:s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx(v,{className:"w-5 h-5 text-blue-600 mt-0.5 flex-shrink-0"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"font-semibold text-gray-900 mb-1",children:r.location.name}),s.jsxs("div",{className:"text-sm text-gray-600 space-y-0.5",children:[r.location.building&&s.jsxs("p",{children:["ðŸ¢ ",r.location.building]}),r.location.floor&&s.jsxs("p",{children:["ðŸ“ ",r.location.floor]}),s.jsxs("div",{className:"flex items-center space-x-1 mt-2",children:[s.jsx(k,{className:"w-4 h-4"}),s.jsx("span",{children:r.inspection_time})]})]})]})]})}),s.jsxs("div",{className:"flex items-center space-x-3 p-4 bg-gray-50 rounded-xl",children:[s.jsx("div",{className:"w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center",children:s.jsx(f,{className:"w-5 h-5 text-white"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600",children:"Inspected by"}),s.jsx("p",{className:"font-semibold text-gray-900",children:r.user.full_name})]})]}),s.jsxs("div",{children:[s.jsxs("h3",{className:"font-bold text-gray-900 mb-3 flex items-center space-x-2",children:[s.jsx("span",{children:"ðŸ“‹"}),s.jsx("span",{children:"Component Ratings"})]}),s.jsx("div",{className:"space-y-3",children:l.map((e,t)=>{const r=Gt.find(t=>t.id===e.component);return r?s.jsx("div",{className:"bg-gray-50 rounded-xl p-4",children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[s.jsx("span",{className:"text-xl",children:r.icon}),s.jsx("span",{className:"font-medium text-gray-900",children:r.label})]}),e.notes&&s.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["ðŸ’¬ ",e.notes]})]}),s.jsxs("div",{className:"flex items-center space-x-1 flex-shrink-0",children:[s.jsx("span",{className:"text-2xl",children:is(e.rating)}),s.jsxs("span",{className:"text-lg font-bold text-gray-900",children:[e.rating,"/5"]})]})]})},t):null})})]}),r.photo_urls.length>0&&s.jsxs("div",{children:[s.jsxs("h3",{className:"font-bold text-gray-900 mb-3 flex items-center space-x-2",children:[s.jsx(O,{className:"w-5 h-5"}),s.jsx("span",{children:"Photos"}),s.jsxs("span",{className:"text-sm font-normal text-gray-600",children:["(",r.photo_urls.length,")"]})]}),s.jsx("div",{className:"grid grid-cols-2 gap-3",children:r.photo_urls.map((e,t)=>s.jsx("div",{className:"aspect-square rounded-xl overflow-hidden",children:s.jsx("img",{src:e,alt:`Inspection photo ${t+1}`,className:"w-full h-full object-cover"})},t))})]}),r.notes&&s.jsxs("div",{children:[s.jsxs("h3",{className:"font-bold text-gray-900 mb-3 flex items-center space-x-2",children:[s.jsx(F,{className:"w-5 h-5"}),s.jsx("span",{children:"Additional Notes"})]}),s.jsx("div",{className:"bg-amber-50 rounded-xl p-4 border border-amber-200",children:s.jsx("p",{className:"text-gray-700 whitespace-pre-wrap",children:r.notes})})]}),(null==a?void 0:a.issues_found)&&s.jsxs("div",{className:"bg-red-50 rounded-xl p-4 border border-red-200",children:[s.jsxs("h3",{className:"font-bold text-red-900 mb-2 flex items-center space-x-2",children:[s.jsx("span",{children:"âš ï¸"}),s.jsx("span",{children:"Issues Found"})]}),s.jsx("p",{className:"text-red-800",children:a.issue_description}),a.requires_maintenance&&s.jsxs("div",{className:"mt-3 pt-3 border-t border-red-200",children:[s.jsx("p",{className:"text-sm font-semibold text-red-900",children:"ðŸ”§ Maintenance Required"}),s.jsxs("p",{className:"text-sm text-red-800 mt-1",children:["Priority: ",s.jsx("span",{className:"font-bold uppercase",children:a.maintenance_priority})]})]})]})]}),s.jsx("div",{className:"flex-shrink-0 p-6 border-t border-gray-100",children:s.jsx("button",{onClick:t,className:"w-full py-3 bg-blue-600 text-white rounded-xl font-semibold hover:bg-blue-700 transition-colors active:scale-[0.98]",children:"Close"})})]})]})},cs=()=>{const{user:t}=Re(),[r,a]=e.useState(new Date),[n,l]=e.useState(null),[i,o]=e.useState(null),{data:c,isLoading:d}=rs(null==t?void 0:t.id,r),{data:x}=(u=null==t?void 0:t.id,y({queryKey:["date-inspections",u,m=n||""],queryFn:()=>ss(void 0,null,function*(){if(!u||!m)return[];const{data:e,error:t}=yield Le.from("inspection_records").select("\n          id,\n          inspection_date,\n          inspection_time,\n          overall_status,\n          responses,\n          photo_urls,\n          notes,\n          location:locations!inner(id, name, building, floor),\n          user:users!inspection_records_user_id_fkey(id, full_name)\n        ").eq("user_id",u).eq("inspection_date",m).order("inspection_time",{ascending:!1});if(t)throw t;return(e||[]).map(e=>({id:e.id,inspection_date:e.inspection_date,inspection_time:e.inspection_time,overall_status:e.overall_status,responses:e.responses,location:e.location,user:e.user,photo_urls:e.photo_urls||[],notes:e.notes}))}),enabled:!!u&&!!m}));var u,m;const h=(null==c?void 0:c.reduce((e,t)=>e+t.count,0))||0,p=c&&c.length>0?Math.round(c.reduce((e,t)=>e+t.averageScore*t.count,0)/h):0;return d?s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):s.jsxs("div",{className:"min-h-screen bg-gray-50 pb-24",children:[s.jsxs("div",{className:"bg-gradient-to-br from-blue-600 to-blue-400 p-6 rounded-b-3xl shadow-lg",children:[s.jsxs("div",{className:"flex items-center justify-between text-white mb-4",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold",children:"Reports"}),s.jsx("p",{className:"text-blue-100 mt-1",children:"Inspection history & analytics"})]}),s.jsx(g,{className:"w-8 h-8 opacity-80"})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsxs("div",{className:"bg-white/20 backdrop-blur rounded-xl p-4",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[s.jsx(F,{className:"w-4 h-4 text-white"}),s.jsx("span",{className:"text-xs text-blue-100",children:"This Month"})]}),s.jsx("div",{className:"text-2xl font-bold text-white",children:h}),s.jsx("div",{className:"text-xs text-blue-100 mt-1",children:"Inspections"})]}),s.jsxs("div",{className:"bg-white/20 backdrop-blur rounded-xl p-4",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[s.jsx(P,{className:"w-4 h-4 text-white"}),s.jsx("span",{className:"text-xs text-blue-100",children:"Average"})]}),s.jsx("div",{className:"text-2xl font-bold text-white",children:p}),s.jsx("div",{className:"text-xs text-blue-100 mt-1",children:"Score"})]})]})]}),s.jsxs("div",{className:"p-4 space-y-4",children:[s.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4",children:s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx("div",{className:"text-2xl",children:"ðŸ’¡"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"text-sm font-medium text-blue-900 mb-1",children:"Tap a date to view inspections"}),s.jsxs("p",{className:"text-xs text-blue-700",children:["Colored dots indicate average scores:",s.jsx("span",{className:"font-semibold",children:" Green"})," (excellent),",s.jsx("span",{className:"font-semibold",children:" Yellow"})," (good),",s.jsx("span",{className:"font-semibold",children:" Red"})," (needs work)"]})]})]})}),s.jsx(as,{currentDate:r,onDateChange:a,dateInspections:c||[],onDateClick:e=>{l(e)}}),(!c||0===c.length)&&s.jsxs("div",{className:"bg-white rounded-xl p-8 text-center",children:[s.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“…"}),s.jsx("h3",{className:"font-bold text-gray-900 mb-2",children:"No inspections yet"}),s.jsx("p",{className:"text-gray-600 text-sm",children:"Start inspecting locations to see them here"})]})]}),s.jsx(ns,{isOpen:!!n,onClose:()=>{l(null)},inspections:x||[],selectedDate:n||"",onInspectionClick:e=>{o(e)}}),s.jsx(os,{isOpen:!!i,onClose:()=>{o(null)},inspection:i})]})};const ds=()=>{const{user:t}=Re(),[r,a]=e.useState("week"),[n,l]=e.useState(!1),{data:i,isLoading:o,error:c}=y({queryKey:["analytics",null==t?void 0:t.id,r],queryFn:()=>{return e=void 0,s=null,a=function*(){if(!(null==t?void 0:t.id))throw new Error("User not authenticated");const e=new Date;let s,a=je(e,"yyyy-MM-dd");switch(r){case"week":default:s=je(Ce(e),"yyyy-MM-dd");break;case"month":s=je(ve(e),"yyyy-MM-dd");break;case"year":s=je(new Date(e.getFullYear(),0,1),"yyyy-MM-dd")}const{data:n,error:l}=yield Le.from("inspection_records").select("\n          id,\n          inspection_date,\n          inspection_time,\n          responses,\n          location_id,\n          locations (\n            id,\n            name,\n            building,\n            floor\n          )\n        ").eq("user_id",t.id).gte("inspection_date",s).lte("inspection_date",a).order("inspection_date",{ascending:!0});if(l)throw l;const i=e=>{try{if(!e||"object"!=typeof e)return 0;const t=Object.values(e);if(0===t.length)return 0;const s=t.filter(e=>{if("boolean"==typeof e)return e;if("string"==typeof e){const t=e.toLowerCase().trim();return["good","excellent","baik","bersih","ada","yes","true","ok","lengkap"].includes(t)}return"number"==typeof e&&e>0}).length;return Math.round(s/t.length*100)}catch(t){return 0}},o=new Map;null==n||n.forEach(e=>{try{const t=e.inspection_date,s=i(e.responses);o.has(t)||o.set(t,{count:0,totalScore:0});const r=o.get(t);r.count++,r.totalScore+=s}catch(t){}});const c=Array.from(o.entries()).map(([e,t])=>({date:e,count:t.count,avgScore:t.count>0?Math.round(t.totalScore/t.count):0})),d=new Map;null==n||n.forEach(e=>{try{if(e.inspection_time&&"string"==typeof e.inspection_time){const t=e.inspection_time.split(":");if(t.length>0){const e=t[0],s=parseInt(e);!isNaN(s)&&s>=0&&s<=23&&d.set(s,(d.get(s)||0)+1)}}}catch(t){}});const x=Array.from(d.entries()).map(([e,t])=>({hour:e,count:t})).sort((e,t)=>e.hour-t.hour),u=x.length>0?x.reduce((e,t)=>t.count>e.count?t:e):null,m=new Map;null==n||n.forEach(e=>{try{if(!e.locations)return;const t=e.location_id,s=i(e.responses);m.has(t)||m.set(t,{name:e.locations.name||"Unknown Location",building:e.locations.building||void 0,floor:e.locations.floor||void 0,scores:[],count:0});const r=m.get(t);r.scores.push(s),r.count++}catch(t){}});const h=Array.from(m.entries()).map(([e,t])=>{const s=t.scores.length>0?Math.round(t.scores.reduce((e,t)=>e+t,0)/t.scores.length):0,r=t.scores.length>=2?t.scores[t.scores.length-1]-t.scores[0]:0;return{id:e,name:t.name,building:t.building,floor:t.floor,avgScore:s,count:t.count,trend:r}}).sort((e,t)=>t.avgScore-e.avgScore),g={excellent:0,good:0,fair:0,poor:0};null==n||n.forEach(e=>{try{const t=i(e.responses);t>=85?g.excellent++:t>=70?g.good++:t>=50?g.fair++:g.poor++}catch(t){}});const p=(null==n?void 0:n.length)||0,b=p>0?Math.round(n.reduce((e,t)=>e+i(t.responses),0)/p):0;let f,y;try{switch(r){case"week":default:f=je(Pe(Ce(e),7),"yyyy-MM-dd"),y=je(Pe(Me(e),7),"yyyy-MM-dd");break;case"month":const t=new Date(e.getFullYear(),e.getMonth()-1,1);f=je(t,"yyyy-MM-dd"),y=je(new Date(t.getFullYear(),t.getMonth()+1,0),"yyyy-MM-dd");break;case"year":f=je(new Date(e.getFullYear()-1,0,1),"yyyy-MM-dd"),y=je(new Date(e.getFullYear()-1,11,31),"yyyy-MM-dd")}const{data:s}=yield Le.from("inspection_records").select("id, responses").eq("user_id",t.id).gte("inspection_date",f).lte("inspection_date",y),a=(null==s?void 0:s.length)||0,n=a>0?Math.round(s.reduce((e,t)=>e+i(t.responses),0)/a):0;return{totalInspections:p,avgScore:b,scoreChange:b-n,countChange:p-a,dailyTrend:c,hourlyDistribution:x,peakHour:u,locationPerformance:h,scoreRanges:g,topPerformer:h[0]||null,needsAttention:h.filter(e=>e.avgScore<70)}}catch(j){return{totalInspections:p,avgScore:b,scoreChange:0,countChange:0,dailyTrend:c,hourlyDistribution:x,peakHour:u,locationPerformance:h,scoreRanges:g,topPerformer:h[0]||null,needsAttention:h.filter(e=>e.avgScore<70)}}},new Promise((t,r)=>{var n=e=>{try{i(a.next(e))}catch(t){r(t)}},l=e=>{try{i(a.throw(e))}catch(t){r(t)}},i=e=>e.done?t(e.value):Promise.resolve(e.value).then(n,l);i((a=a.apply(e,s)).next())});var e,s,a},enabled:!!(null==t?void 0:t.id),retry:2,staleTime:3e5}),d={week:"This Week",month:"This Month",year:"This Year"};return c?s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx(R,{className:"w-8 h-8 text-red-600"})}),s.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:"Failed to Load Analytics"}),s.jsx("p",{className:"text-gray-600 mb-4",children:c instanceof Error?c.message:"An unexpected error occurred"}),s.jsx("button",{onClick:()=>window.location.reload(),className:"px-6 py-3 bg-blue-600 text-white rounded-xl font-medium hover:bg-blue-700 transition-colors",children:"Retry"})]})}):o?s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600",children:"Loading analytics..."})]})}):s.jsxs("div",{className:"min-h-screen bg-gray-50 pb-24",children:[s.jsxs("div",{className:"bg-gradient-to-br from-purple-600 via-purple-500 to-pink-500 p-6 rounded-b-3xl shadow-lg",children:[s.jsxs("div",{className:"flex items-center justify-between text-white mb-4",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold",children:"Analytics"}),s.jsx("p",{className:"text-purple-100 mt-1",children:"Performance insights & trends"})]}),s.jsx(b,{className:"w-8 h-8 opacity-80"})]}),s.jsxs("div",{className:"relative",children:[s.jsxs("button",{onClick:()=>l(!n),className:"w-full bg-white/20 backdrop-blur-sm border border-white/30 rounded-xl px-4 py-3 flex items-center justify-between text-white font-medium",children:[s.jsx("span",{children:d[r]}),s.jsx($,{className:"w-5 h-5 transition-transform "+(n?"rotate-180":"")})]}),n&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>l(!1)}),s.jsx("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white rounded-xl shadow-xl border border-gray-200 overflow-hidden z-20",children:["week","month","year"].map(e=>s.jsx("button",{onClick:()=>{a(e),l(!1)},className:`\n                      w-full px-4 py-3 text-left hover:bg-gray-50 transition-colors\n                      ${r===e?"bg-blue-50 text-blue-600 font-medium":"text-gray-900"}\n                    `,children:d[e]},e))})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-4",children:[s.jsxs("div",{className:"bg-white/15 backdrop-blur-sm rounded-2xl p-4 border border-white/20",children:[s.jsx("div",{className:"text-white/80 text-xs mb-1",children:"Total Inspections"}),s.jsxs("div",{className:"flex items-end gap-2",children:[s.jsx("span",{className:"text-3xl font-bold text-white",children:(null==i?void 0:i.totalInspections)||0}),i&&0!==i.countChange&&s.jsxs("span",{className:"text-sm flex items-center gap-1 mb-1 "+(i.countChange>0?"text-green-300":"text-red-300"),children:[i.countChange>0?s.jsx(P,{className:"w-3 h-3"}):s.jsx(z,{className:"w-3 h-3"}),Math.abs(i.countChange)]})]})]}),s.jsxs("div",{className:"bg-white/15 backdrop-blur-sm rounded-2xl p-4 border border-white/20",children:[s.jsx("div",{className:"text-white/80 text-xs mb-1",children:"Average Score"}),s.jsxs("div",{className:"flex items-end gap-2",children:[s.jsx("span",{className:"text-3xl font-bold text-white",children:(null==i?void 0:i.avgScore)||0}),i&&0!==i.scoreChange&&s.jsxs("span",{className:"text-sm flex items-center gap-1 mb-1 "+(i.scoreChange>0?"text-green-300":"text-red-300"),children:[i.scoreChange>0?s.jsx(P,{className:"w-3 h-3"}):s.jsx(z,{className:"w-3 h-3"}),Math.abs(i.scoreChange)]})]})]})]})]}),s.jsxs("div",{className:"p-4 space-y-4",children:[s.jsxs(ut,{children:[s.jsx(mt,{title:"Score Distribution",subtitle:"Quality breakdown",icon:s.jsx(U,{className:"w-5 h-5 text-purple-600"})}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Excellent (85-100)"}),s.jsx("span",{className:"text-sm font-bold text-green-600",children:(null==i?void 0:i.scoreRanges.excellent)||0})]}),s.jsx("div",{className:"h-3 bg-gray-100 rounded-full overflow-hidden",children:s.jsx("div",{className:"h-full bg-gradient-to-r from-green-500 to-green-400 rounded-full transition-all duration-500",style:{width:(null==i?void 0:i.totalInspections)?i.scoreRanges.excellent/i.totalInspections*100+"%":"0%"}})})]}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Good (70-84)"}),s.jsx("span",{className:"text-sm font-bold text-yellow-600",children:(null==i?void 0:i.scoreRanges.good)||0})]}),s.jsx("div",{className:"h-3 bg-gray-100 rounded-full overflow-hidden",children:s.jsx("div",{className:"h-full bg-gradient-to-r from-yellow-500 to-yellow-400 rounded-full transition-all duration-500",style:{width:(null==i?void 0:i.totalInspections)?i.scoreRanges.good/i.totalInspections*100+"%":"0%"}})})]}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Fair (50-69)"}),s.jsx("span",{className:"text-sm font-bold text-orange-600",children:(null==i?void 0:i.scoreRanges.fair)||0})]}),s.jsx("div",{className:"h-3 bg-gray-100 rounded-full overflow-hidden",children:s.jsx("div",{className:"h-full bg-gradient-to-r from-orange-500 to-orange-400 rounded-full transition-all duration-500",style:{width:(null==i?void 0:i.totalInspections)?i.scoreRanges.fair/i.totalInspections*100+"%":"0%"}})})]}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Needs Work (0-49)"}),s.jsx("span",{className:"text-sm font-bold text-red-600",children:(null==i?void 0:i.scoreRanges.poor)||0})]}),s.jsx("div",{className:"h-3 bg-gray-100 rounded-full overflow-hidden",children:s.jsx("div",{className:"h-full bg-gradient-to-r from-red-500 to-red-400 rounded-full transition-all duration-500",style:{width:(null==i?void 0:i.totalInspections)?i.scoreRanges.poor/i.totalInspections*100+"%":"0%"}})})]})]})]}),(null==i?void 0:i.peakHour)&&s.jsxs(ut,{children:[s.jsx(mt,{title:"Peak Inspection Hour",subtitle:"Most active time",icon:s.jsx(k,{className:"w-5 h-5 text-blue-600"})}),s.jsxs("div",{className:"flex items-center justify-between p-4 bg-blue-50 rounded-xl",children:[s.jsxs("div",{children:[s.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"Busiest at"}),s.jsxs("div",{className:"text-3xl font-bold text-blue-600",children:[i.peakHour.hour.toString().padStart(2,"0"),":00"]})]}),s.jsxs("div",{className:"text-right",children:[s.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"Total checks"}),s.jsx("div",{className:"text-2xl font-bold text-gray-900",children:i.peakHour.count})]})]})]}),s.jsxs(ut,{children:[s.jsx(mt,{title:"Location Rankings",subtitle:"Performance by location",icon:s.jsx(v,{className:"w-5 h-5 text-purple-600"})}),s.jsxs("div",{className:"space-y-2",children:[null==i?void 0:i.locationPerformance.slice(0,10).map((e,t)=>s.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-xl hover:bg-gray-100 transition-colors",children:[s.jsxs("div",{className:`\n                  w-8 h-8 rounded-lg flex items-center justify-center font-bold text-sm flex-shrink-0\n                  ${0===t?"bg-yellow-100 text-yellow-600":1===t?"bg-gray-100 text-gray-600":2===t?"bg-orange-100 text-orange-600":"bg-gray-50 text-gray-500"}\n                `,children:["#",t+1]}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("div",{className:"font-medium text-gray-900 truncate",children:e.name}),s.jsxs("div",{className:"text-xs text-gray-500",children:[e.count," inspections"]})]}),s.jsxs("div",{className:"text-right",children:[s.jsx("div",{className:"text-lg font-bold text-gray-900",children:e.avgScore}),0!==e.trend&&s.jsxs("div",{className:"text-xs flex items-center gap-0.5 "+(e.trend>0?"text-green-600":"text-red-600"),children:[e.trend>0?"â†‘":"â†“"," ",Math.abs(e.trend)]})]})]},e.id)),!(null==i?void 0:i.locationPerformance.length)&&s.jsx("p",{className:"text-center text-gray-500 py-8",children:"No location data available"})]})]}),(null==i?void 0:i.needsAttention)&&i.needsAttention.length>0&&s.jsxs(ut,{children:[s.jsx(mt,{title:"Needs Attention",subtitle:"Locations below 70 score",icon:s.jsx(R,{className:"w-5 h-5 text-red-600"})}),s.jsx("div",{className:"space-y-2",children:i.needsAttention.map(e=>s.jsxs("div",{className:"flex items-center gap-3 p-3 bg-red-50 rounded-xl border border-red-100",children:[s.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center flex-shrink-0",children:s.jsx(R,{className:"w-5 h-5 text-red-600"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("div",{className:"font-medium text-gray-900 truncate",children:e.name}),s.jsxs("div",{className:"text-xs text-gray-500",children:[e.building&&`${e.building} â€¢ `,e.floor]})]}),s.jsx("div",{className:"text-xl font-bold text-red-600",children:e.avgScore})]},e.id))})]}),s.jsxs("button",{onClick:()=>alert("Export feature coming soon!"),className:"w-full flex items-center justify-center gap-2 p-4 bg-white border-2 border-gray-200 rounded-2xl font-medium text-gray-900 hover:bg-gray-50 transition-colors active:scale-95",children:[s.jsx(G,{className:"w-5 h-5"}),s.jsx("span",{children:"Export Analytics Report"})]})]}),s.jsx(tt,{})]})};var xs={},us=(e,t,s)=>new Promise((r,a)=>{var n=e=>{try{i(s.next(e))}catch(t){a(t)}},l=e=>{try{i(s.throw(e))}catch(t){a(t)}},i=e=>e.done?r(e.value):Promise.resolve(e.value).then(n,l);i((s=s.apply(e,t)).next())});const ms=()=>{const{user:r,profile:n,signOut:l}=Re(),i=t(),o=E(),c=e.useRef(null),[d,x]=e.useState(!1),{data:m,isLoading:h}=y({queryKey:["user-stats",null==r?void 0:r.id],queryFn:()=>us(void 0,null,function*(){if(!(null==r?void 0:r.id))throw new Error("User not authenticated");const{data:e,error:t}=yield Le.from("inspection_records").select("\n          id,\n          inspection_date,\n          responses,\n          locations (name)\n        ").eq("user_id",r.id).order("inspection_date",{ascending:!1});if(t)throw t;const s=e=>{const t=Object.values(e||{});if(0===t.length)return 0;const s=t.filter(e=>!0===e||"good"===e||"excellent"===e||"baik"===e||"bersih"===e||"ada"===e).length;return Math.round(s/t.length*100)},a=(null==e?void 0:e.length)||0,n=a>0?Math.round(e.reduce((e,t)=>e+s(t.responses),0)/a):0;let l=0;if(e&&e.length>0){const t=[...new Set(e.map(e=>e.inspection_date))].sort().reverse();for(let e=0;e<t.length;e++){const s=new Date;s.setDate(s.getDate()-e);const r=s.toISOString().split("T")[0];if(t[e]!==r)break;l++}}const i=new Map;null==e||e.forEach(e=>{if(!e.locations)return;const t=e.locations.name,r=s(e.responses);i.has(t)||i.set(t,{scores:[],name:t}),i.get(t).scores.push(r)});let o=null,c=0;return i.forEach(e=>{const t=Math.round(e.scores.reduce((e,t)=>e+t,0)/e.scores.length);t>c&&(c=t,o={name:e.name,score:t})}),{totalInspections:a,avgScore:n,currentStreak:l,bestLocation:o}}),enabled:!!(null==r?void 0:r.id)}),{data:p}=y({queryKey:["user-occupation",null==n?void 0:n.occupation_id],queryFn:()=>us(void 0,null,function*(){if(!(null==n?void 0:n.occupation_id))return null;const{data:e,error:t}=yield Le.from("user_occupations").select("*").eq("id",n.occupation_id).single();if(t)throw t;return e}),enabled:!!(null==n?void 0:n.occupation_id)}),b=q({mutationFn:e=>us(void 0,null,function*(){if(!(null==r?void 0:r.id))throw new Error("User not authenticated");const t=new FormData;t.append("file",e),t.append("upload_preset",xs.NEXT_PUBLIC_CLOUDINARY_UPLOAD_PRESET),t.append("folder","profile-photos");const s=yield fetch(`https://api.cloudinary.com/v1_1/${xs.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME}/image/upload`,{method:"POST",body:t});if(!s.ok)throw new Error("Upload failed");const a=(yield s.json()).secure_url,{error:n}=yield Le.from("users").update({profile_photo_url:a}).eq("id",r.id);if(n)throw n;return a}),onSuccess:()=>{o.invalidateQueries({queryKey:["user-profile"]}),u.success("Profile photo updated!")},onError:e=>{u.error(`Upload failed: ${e.message}`)}});return n?s.jsxs("div",{className:"min-h-screen bg-gray-50 pb-24",children:[s.jsx("div",{className:"bg-gradient-to-br from-blue-600 via-blue-500 to-purple-600 pt-12 pb-24 px-6",children:s.jsxs("div",{className:"flex items-center justify-between text-white mb-6",children:[s.jsx("h1",{className:"text-2xl font-bold",children:"Profile"}),s.jsx("button",{onClick:()=>i("/settings"),className:"p-2 hover:bg-white/10 rounded-xl transition-colors",children:s.jsx(j,{className:"w-6 h-6"})})]})}),s.jsxs("div",{className:"px-6 -mt-16",children:[s.jsxs(ut,{className:"relative",children:[s.jsx("div",{className:"flex justify-center -mt-16 mb-4",children:s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"w-32 h-32 rounded-full bg-white p-2 shadow-xl",children:n.profile_photo_url?s.jsx("img",{src:n.profile_photo_url,alt:n.full_name,className:"w-full h-full rounded-full object-cover"}):s.jsx("div",{className:"w-full h-full rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center",children:s.jsx("span",{className:"text-4xl font-bold text-white",children:n.full_name.charAt(0).toUpperCase()})})}),s.jsx("button",{onClick:()=>{var e;return null==(e=c.current)?void 0:e.click()},disabled:d,className:"absolute bottom-0 right-0 bg-blue-600 text-white p-3 rounded-full shadow-lg hover:bg-blue-700 transition-colors disabled:opacity-50",children:d?s.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}):s.jsx(O,{className:"w-5 h-5"})}),s.jsx("input",{ref:c,type:"file",accept:"image/*",onChange:e=>us(void 0,null,function*(){var t;const s=null==(t=e.target.files)?void 0:t[0];if(!s)return;if(["image/jpeg","image/jpg","image/png","image/webp"].includes(s.type))if(s.size>5242880)u.error("Image size must be less than 5MB");else{x(!0);try{yield b.mutateAsync(s)}finally{x(!1),c.current&&(c.current.value="")}}else u.error("Please upload a valid image (JPG, PNG, or WebP)")}),className:"hidden"})]})}),s.jsxs("div",{className:"text-center mb-6",children:[s.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:n.full_name}),p&&s.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 rounded-full text-white font-medium mb-2",style:{backgroundColor:p.color||"#6B7280"},children:[s.jsx("span",{className:"text-lg",children:p.icon}),s.jsx("span",{children:p.display_name})]}),s.jsxs("div",{className:"inline-flex items-center gap-1 px-3 py-1 bg-gray-100 rounded-full text-sm text-gray-600",children:[s.jsx(f,{className:"w-4 h-4"}),s.jsx("span",{children:"Member"})]})]}),s.jsxs("div",{className:"space-y-3 mb-6",children:[s.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-xl",children:[s.jsx(a,{className:"w-5 h-5 text-gray-500"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"text-xs text-gray-500",children:"Email"}),s.jsx("div",{className:"font-medium text-gray-900",children:n.email})]})]}),n.phone&&s.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-xl",children:[s.jsx(Z,{className:"w-5 h-5 text-gray-500"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"text-xs text-gray-500",children:"Phone"}),s.jsx("div",{className:"font-medium text-gray-900",children:n.phone})]})]}),s.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-xl",children:[s.jsx(g,{className:"w-5 h-5 text-gray-500"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"text-xs text-gray-500",children:"Member Since"}),s.jsx("div",{className:"font-medium text-gray-900",children:je(new Date(n.created_at),"dd MMM yyyy")})]})]}),n.last_login_at&&s.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-xl",children:[s.jsx(k,{className:"w-5 h-5 text-gray-500"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"text-xs text-gray-500",children:"Last Login"}),s.jsx("div",{className:"font-medium text-gray-900",children:je(new Date(n.last_login_at),"dd MMM yyyy, HH:mm")})]})]})]})]}),s.jsxs("div",{className:"mt-4",children:[s.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-3",children:"Your Statistics"}),h?s.jsx("div",{className:"grid grid-cols-2 gap-3",children:[...Array(4)].map((e,t)=>s.jsx("div",{className:"h-24 bg-gray-100 rounded-xl animate-pulse"},t))}):s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsx(ut,{className:"p-4",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center",children:s.jsx(_,{className:"w-6 h-6 text-blue-600"})}),s.jsxs("div",{children:[s.jsx("div",{className:"text-2xl font-bold text-gray-900",children:(null==m?void 0:m.totalInspections)||0}),s.jsx("div",{className:"text-xs text-gray-500",children:"Inspections"})]})]})}),s.jsx(ut,{className:"p-4",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center",children:s.jsx(P,{className:"w-6 h-6 text-green-600"})}),s.jsxs("div",{children:[s.jsx("div",{className:"text-2xl font-bold text-gray-900",children:(null==m?void 0:m.avgScore)||0}),s.jsx("div",{className:"text-xs text-gray-500",children:"Avg Score"})]})]})}),s.jsx(ut,{className:"p-4",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-xl flex items-center justify-center",children:s.jsx("span",{className:"text-2xl",children:"ðŸ”¥"})}),s.jsxs("div",{children:[s.jsx("div",{className:"text-2xl font-bold text-gray-900",children:(null==m?void 0:m.currentStreak)||0}),s.jsx("div",{className:"text-xs text-gray-500",children:"Day Streak"})]})]})}),s.jsx(ut,{className:"p-4",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center",children:s.jsx(K,{className:"w-6 h-6 text-purple-600"})}),s.jsx("div",{className:"flex-1 min-w-0",children:(null==m?void 0:m.bestLocation)?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"text-lg font-bold text-gray-900",children:m.bestLocation.score}),s.jsx("div",{className:"text-xs text-gray-500 truncate",children:m.bestLocation.name})]}):s.jsx("div",{className:"text-xs text-gray-500",children:"No data yet"})})]})})]})]}),s.jsxs("div",{className:"mt-6 space-y-3",children:[s.jsxs("button",{onClick:()=>i("/edit-profile"),className:"w-full flex items-center justify-center gap-2 p-4 bg-white border-2 border-gray-200 rounded-2xl font-medium text-gray-900 hover:bg-gray-50 transition-colors active:scale-95",children:[s.jsx(B,{className:"w-5 h-5"}),s.jsx("span",{children:"Edit Profile"})]}),s.jsxs("button",{onClick:()=>us(void 0,null,function*(){window.confirm("Are you sure you want to logout?")&&(yield l(),i("/login"))}),className:"w-full flex items-center justify-center gap-2 p-4 bg-red-50 border-2 border-red-200 rounded-2xl font-medium text-red-600 hover:bg-red-100 transition-colors active:scale-95",children:[s.jsx(H,{className:"w-5 h-5"}),s.jsx("span",{children:"Logout"})]})]})]}),s.jsx(tt,{})]}):s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})})},hs=({locations:t,onClose:r})=>{const a=e.useRef(null),n=Q.useReactToPrint({contentRef:a,documentTitle:"WC-Check-QR-Codes",pageStyle:"\n      @page {\n        size: A4;\n        margin: 20mm;\n      }\n      @media print {\n        body {\n          -webkit-print-color-adjust: exact;\n          print-color-adjust: exact;\n        }\n        .page-break {\n          page-break-after: always;\n        }\n      }\n    "});return s.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:s.jsxs("div",{className:"bg-white rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[s.jsxs("div",{className:"p-6 border-b border-gray-200 flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Generate QR Codes"}),s.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[t.length," location",1!==t.length?"s":""," selected"]})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsxs("button",{onClick:()=>{n&&n()},className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-colors",children:[s.jsx(W,{className:"w-4 h-4"}),s.jsx("span",{children:"Print"})]}),s.jsx("button",{onClick:r,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:s.jsx(S,{className:"w-5 h-5 text-gray-600"})})]})]}),s.jsx("div",{className:"flex-1 overflow-auto p-6",children:s.jsx("div",{ref:a,className:"space-y-8",children:t.map((e,r)=>s.jsxs("div",{className:"bg-white border-2 border-gray-200 rounded-2xl p-8 "+(r<t.length-1?"page-break":""),children:[s.jsxs("div",{className:"text-center mb-6",children:[s.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-2",children:e.name}),s.jsxs("div",{className:"text-gray-600 space-y-1",children:[e.building&&s.jsxs("p",{className:"text-lg",children:["Building: ",e.building]}),e.floor&&s.jsxs("p",{className:"text-lg",children:["Floor: ",e.floor]}),e.code&&s.jsx("p",{className:"text-sm font-mono bg-gray-100 inline-block px-3 py-1 rounded",children:e.code})]})]}),s.jsx("div",{className:"flex justify-center mb-6",children:s.jsx("div",{className:"bg-white p-6 rounded-2xl border-4 border-gray-900",children:s.jsx(V,{value:`http://localhost:5173/locations/${e.id}`,size:300,level:"H",includeMargin:!1})})}),s.jsxs("div",{className:"text-center text-gray-600 space-y-2",children:[s.jsx("p",{className:"text-lg font-medium",children:"Scan to Inspect"}),s.jsx("p",{className:"text-sm",children:"Use the WC Check app to scan this QR code and start your inspection"})]}),s.jsxs("div",{className:"mt-6 pt-4 border-t border-gray-200 text-center text-xs text-gray-500",children:[s.jsx("p",{children:"WC Check - Toilet Monitoring System"}),s.jsx("p",{className:"mt-1 font-mono",children:e.id})]})]},e.id))})})]})})};var gs=Object.defineProperty,ps=Object.defineProperties,bs=Object.getOwnPropertyDescriptors,fs=Object.getOwnPropertySymbols,ys=Object.prototype.hasOwnProperty,js=Object.prototype.propertyIsEnumerable,vs=(e,t,s)=>t in e?gs(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,Ns=(e,t)=>{for(var s in t||(t={}))ys.call(t,s)&&vs(e,s,t[s]);if(fs)for(var s of fs(t))js.call(t,s)&&vs(e,s,t[s]);return e},ws=(e,t)=>ps(e,bs(t)),_s=(e,t,s)=>new Promise((r,a)=>{var n=e=>{try{i(s.next(e))}catch(t){a(t)}},l=e=>{try{i(s.throw(e))}catch(t){a(t)}},i=e=>e.done?r(e.value):Promise.resolve(e.value).then(n,l);i((s=s.apply(e,t)).next())});const ks=()=>{var t,r;const{user:a}=Re(),n=E(),[l,i]=e.useState(!1),[o,c]=e.useState(null),[d,x]=e.useState(""),[u,m]=e.useState(!1),[h,g]=e.useState([]),[b,j]=e.useState(null),{data:N,isLoading:w}=y({queryKey:["locations"],queryFn:()=>_s(void 0,null,function*(){const{data:e,error:t}=yield Le.from("locations").select("*").order("created_at",{ascending:!1});if(t)throw t;return e})}),_=null==N?void 0:N.filter(e=>{var t,s;return e.name.toLowerCase().includes(d.toLowerCase())||(null==(t=e.building)?void 0:t.toLowerCase().includes(d.toLowerCase()))||(null==(s=e.code)?void 0:s.toLowerCase().includes(d.toLowerCase()))}),k=q({mutationFn:e=>_s(void 0,null,function*(){const{error:t}=yield Le.from("locations").delete().eq("id",e);if(t)throw t}),onSuccess:()=>{n.invalidateQueries({queryKey:["locations"]}),I.success("Location deleted")},onError:e=>{I.error(e.message||"Failed to delete")}}),S=e=>`http://localhost:5173/locations/${e}`;return w?s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):s.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[s.jsx("div",{className:"bg-gradient-to-br from-blue-600 to-blue-400 p-6 rounded-b-3xl shadow-lg",children:s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-white",children:"Location Management"}),s.jsx("p",{className:"text-blue-100",children:"Manage toilet locations & QR codes"})]}),a&&s.jsxs("div",{className:"hidden sm:flex items-center space-x-2 bg-white/20 px-3 py-2 rounded-lg",children:[s.jsx(f,{className:"w-4 h-4 text-white"}),s.jsx("span",{className:"text-white text-sm font-medium",children:(null==(t=a.user_metadata)?void 0:t.name)||a.email})]})]})}),s.jsxs("div",{className:"p-4 space-y-4",children:[a&&s.jsx(ut,{className:"sm:hidden p-3 bg-blue-50 border-blue-200",children:s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(f,{className:"w-4 h-4 text-blue-600"}),s.jsx("span",{className:"text-blue-900 text-sm font-medium",children:(null==(r=a.user_metadata)?void 0:r.name)||a.email})]})}),s.jsx(ut,{children:s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"relative",children:[s.jsx(Y,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),s.jsx("input",{type:"text",placeholder:"Search locations...",value:d,onChange:e=>x(e.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsxs(vt,{onClick:()=>{c(null),i(!0)},className:"flex items-center justify-center space-x-2",children:[s.jsx(J,{className:"w-5 h-5"}),s.jsx("span",{children:"Add"})]}),s.jsxs(vt,{variant:"outline",onClick:()=>{N&&0!==N.length?(g(N),m(!0)):I.error("No locations available")},className:"flex items-center justify-center space-x-2",children:[s.jsx(p,{className:"w-5 h-5"}),s.jsx("span",{children:"Bulk QR"})]})]})]})}),s.jsx("div",{className:"space-y-3",children:0===(null==_?void 0:_.length)?s.jsx(ut,{children:s.jsxs("div",{className:"text-center py-8 text-gray-500",children:[s.jsx(v,{className:"w-12 h-12 mx-auto mb-2 text-gray-300"}),s.jsx("p",{children:"No locations found"})]})}):null==_?void 0:_.map(e=>s.jsxs(ut,{className:"relative",children:[s.jsxs("div",{className:"pr-10",children:[s.jsxs("div",{className:"flex items-start space-x-3 mb-3",children:[s.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center text-xl flex-shrink-0",children:"ðŸš½"}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("h3",{className:"font-semibold text-gray-900 truncate",children:e.name}),e.code&&s.jsx("span",{className:"inline-block mt-1 px-2 py-0.5 bg-blue-100 text-blue-700 text-xs rounded-full",children:e.code})]})]}),s.jsxs("div",{className:"text-sm text-gray-600 space-y-1 mb-3",children:[e.building&&s.jsxs("p",{className:"truncate",children:["ðŸ¢ ",e.building]}),e.floor&&s.jsxs("p",{className:"truncate",children:["ðŸ“ ",e.floor]}),e.area&&s.jsxs("p",{className:"truncate",children:["ðŸ—ºï¸ ",e.area]})]}),e.created_by&&s.jsxs("div",{className:"text-xs text-gray-500 mb-2",children:["Created by: ",e.created_by===(null==a?void 0:a.id)?"You":e.created_by]}),s.jsxs("details",{className:"text-xs",children:[s.jsx("summary",{className:"text-blue-600 cursor-pointer hover:text-blue-700 font-medium",children:"View URL"}),s.jsx("div",{className:"mt-2 p-2 bg-gray-50 rounded-lg border border-gray-200",children:s.jsx("p",{className:"text-gray-600 break-all font-mono",children:S(e.id)})})]})]}),s.jsxs("div",{className:"absolute top-4 right-4",children:[s.jsx("button",{onClick:()=>j(b===e.id?null:e.id),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:s.jsx(X,{className:"w-5 h-5 text-gray-600"})}),b===e.id&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>j(null)}),s.jsxs("div",{className:"absolute right-0 top-full mt-2 w-48 bg-white rounded-xl shadow-xl border border-gray-200 z-20 overflow-hidden",children:[s.jsxs("button",{onClick:()=>(e=>{g([e]),m(!0),j(null)})(e),className:"w-full px-4 py-3 text-left hover:bg-gray-50 flex items-center space-x-3 transition-colors",children:[s.jsx(p,{className:"w-5 h-5 text-blue-600"}),s.jsx("span",{className:"text-sm font-medium text-gray-900",children:"Generate QR"})]}),s.jsxs("button",{onClick:()=>(e=>{const t=S(e.id);navigator.clipboard.writeText(t),I.success("URL copied!"),j(null)})(e),className:"w-full px-4 py-3 text-left hover:bg-gray-50 flex items-center space-x-3 transition-colors border-t border-gray-100",children:[s.jsx(ee,{className:"w-5 h-5 text-gray-600"}),s.jsx("span",{className:"text-sm font-medium text-gray-900",children:"Copy URL"})]}),s.jsxs("button",{onClick:()=>(e=>{c(e),i(!0),j(null)})(e),className:"w-full px-4 py-3 text-left hover:bg-gray-50 flex items-center space-x-3 transition-colors border-t border-gray-100",children:[s.jsx(B,{className:"w-5 h-5 text-gray-600"}),s.jsx("span",{className:"text-sm font-medium text-gray-900",children:"Edit"})]}),s.jsxs("button",{onClick:()=>{return t=e.id,s=e.name,_s(void 0,null,function*(){window.confirm(`Delete "${s}"?`)&&(k.mutate(t),j(null))});var t,s},className:"w-full px-4 py-3 text-left hover:bg-red-50 flex items-center space-x-3 transition-colors border-t border-gray-100",children:[s.jsx(te,{className:"w-5 h-5 text-red-600"}),s.jsx("span",{className:"text-sm font-medium text-red-600",children:"Delete"})]})]})]})]})]},e.id))})]}),l&&s.jsx(Ss,{location:o,onClose:()=>{i(!1),c(null)},onSuccess:()=>{n.invalidateQueries({queryKey:["locations"]}),i(!1),c(null)}}),u&&s.jsx(hs,{locations:h,onClose:()=>{m(!1),g([])}})]})},Ss=({location:t,onClose:r,onSuccess:a})=>{var n;const{user:l}=Re(),i=E(),[o,c]=e.useState([]),[d,x]=e.useState([]),[u,m]=e.useState(!1),[h,g]=e.useState({name:(null==t?void 0:t.name)||"",code:(null==t?void 0:t.code)||"",organization_id:(null==t?void 0:t.organization_id)||"",building_id:(null==t?void 0:t.building_id)||"",floor:(null==t?void 0:t.floor)||"",area:(null==t?void 0:t.area)||"",section:(null==t?void 0:t.section)||"",description:(null==t?void 0:t.description)||""});e.useEffect(()=>{_s(void 0,null,function*(){const{data:e,error:t}=yield Le.from("organizations").select("*").eq("is_active",!0).order("name");t||c(e||[])})},[]),e.useEffect(()=>{_s(void 0,null,function*(){if(!h.organization_id)return void x([]);m(!0);const{data:e,error:t}=yield Le.from("buildings").select("*").eq("organization_id",h.organization_id).eq("is_active",!0).order("name");t||x(e||[]),m(!1)})},[h.organization_id]);const p=q({mutationFn:e=>_s(void 0,null,function*(){if(!e.organization_id||!e.building_id)throw new Error("Organization and Building are required");if(t){const s={name:e.name,code:e.code,organization_id:e.organization_id,building_id:e.building_id,floor:e.floor,area:e.area,section:e.section,description:e.description,updated_at:(new Date).toISOString()},{error:r}=yield Le.from("locations").update(s).eq("id",t.id);if(r)throw r}else{const{data:t,error:s}=yield Le.from("buildings").select("short_code, organizations(short_code)").eq("id",e.building_id).single();if(s||!t)throw new Error("Building not found");const r=t.organizations.short_code+"-"+t.short_code+"-"+(e.code||"LOC")+"-"+Date.now().toString(36).slice(-4),a={name:e.name,code:e.code,organization_id:e.organization_id,building_id:e.building_id,floor:e.floor,area:e.area,section:e.section,description:e.description,qr_code:r.toUpperCase(),is_active:!0,created_by:(null==l?void 0:l.id)||null},{error:n}=yield Le.from("locations").insert(a);if(n)throw n}}),onSuccess:()=>{I.success(t?"Location updated":"Location created"),i.invalidateQueries({queryKey:["locations"]}),a()},onError:e=>{I.error(e.message||"Failed to save location")}});return s.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:s.jsxs(ut,{className:"w-full max-w-lg max-h-[90vh] overflow-y-auto",children:[s.jsxs("div",{className:"sticky top-0 bg-white pb-4 border-b border-gray-200",children:[s.jsx("h2",{className:"text-xl font-bold text-gray-900",children:t?"Edit Location":"Add Location"}),l&&s.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Created by: ",(null==(n=l.user_metadata)?void 0:n.name)||l.email]})]}),s.jsxs("form",{onSubmit:e=>{var t;e.preventDefault(),(null==(t=h.name)?void 0:t.trim())?h.organization_id?h.building_id?p.mutate(h):I.error("Building is required"):I.error("Organization is required"):I.error("Location name is required")},className:"space-y-4 mt-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Organization *"}),s.jsxs("select",{value:h.organization_id||"",onChange:e=>g(ws(Ns({},h),{organization_id:e.target.value,building_id:""})),className:"w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,disabled:p.isPending,children:[s.jsx("option",{value:"",children:"Select Organization"}),o.map(e=>s.jsxs("option",{value:e.id,children:[e.name," (",e.short_code,")"]},e.id))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Building *"}),s.jsxs("select",{value:h.building_id||"",onChange:e=>g(ws(Ns({},h),{building_id:e.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,disabled:!h.organization_id||u||p.isPending,children:[s.jsx("option",{value:"",children:u?"Loading buildings...":h.organization_id?"Select Building":"Select organization first"}),d.map(e=>s.jsxs("option",{value:e.id,children:[e.name," (",e.short_code,")"]},e.id))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Location Name *"}),s.jsx("input",{type:"text",value:h.name||"",onChange:e=>g(ws(Ns({},h),{name:e.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"e.g. Toilet Lantai 3",required:!0,disabled:p.isPending})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Location Code"}),s.jsx("input",{type:"text",value:h.code||"",onChange:e=>g(ws(Ns({},h),{code:e.target.value.toUpperCase()})),className:"w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"e.g. WC-03, T-MEN-1",disabled:p.isPending})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Floor"}),s.jsx("input",{type:"text",value:h.floor||"",onChange:e=>g(ws(Ns({},h),{floor:e.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Lantai 3",disabled:p.isPending})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Section"}),s.jsx("input",{type:"text",value:h.section||"",onChange:e=>g(ws(Ns({},h),{section:e.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Pria/Wanita",disabled:p.isPending})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Area Type"}),s.jsxs("select",{value:h.area||"",onChange:e=>g(ws(Ns({},h),{area:e.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:p.isPending,children:[s.jsx("option",{value:"",children:"Select Area Type"}),s.jsx("option",{value:"Public Area",children:"Public Area"}),s.jsx("option",{value:"Staff Area",children:"Staff Area"}),s.jsx("option",{value:"VIP Area",children:"VIP Area"}),s.jsx("option",{value:"Service Area",children:"Service Area"}),s.jsx("option",{value:"Emergency Area",children:"Emergency Area"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),s.jsx("textarea",{value:h.description||"",onChange:e=>g(ws(Ns({},h),{description:e.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",rows:3,placeholder:"Additional information...",disabled:p.isPending})]}),s.jsxs("div",{className:"flex space-x-3 pt-4",children:[s.jsx(vt,{type:"button",variant:"outline",onClick:r,className:"flex-1",disabled:p.isPending,children:"Cancel"}),s.jsx(vt,{type:"submit",className:"flex-1",disabled:p.isPending||!h.name||!h.organization_id||!h.building_id,children:p.isPending?"Saving...":t?"Update":"Create"})]})]})]})})},Cs=({icon:e,title:r,description:a,path:n,color:l="blue",count:i,badge:o})=>{var c;const d=t(),x={blue:"bg-blue-100 text-blue-600",purple:"bg-purple-100 text-purple-600",green:"bg-green-100 text-green-600",orange:"bg-orange-100 text-orange-600",red:"bg-red-100 text-red-600",cyan:"bg-cyan-100 text-cyan-600"};return s.jsxs("button",{onClick:()=>d(n),className:"\n        relative w-full p-6 bg-white rounded-2xl shadow-sm border border-gray-100\n        hover:shadow-lg hover:scale-[1.02] active:scale-[0.98]\n        transition-all duration-200\n        text-left group\n      ",children:[o&&s.jsx("div",{className:"absolute top-4 right-4 px-2 py-1 bg-red-500 text-white text-xs font-bold rounded-full",children:o}),s.jsx("div",{className:`\n        w-14 h-14 ${x[l]||x.blue} \n        rounded-2xl flex items-center justify-center mb-4\n        group-hover:scale-110 transition-transform\n      `,children:s.jsx(e,{className:"w-7 h-7"})}),s.jsxs("div",{className:"mb-4",children:[s.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-1",children:r}),s.jsx("p",{className:"text-sm text-gray-600",children:a})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[void 0!==i&&s.jsx("div",{className:"text-2xl font-bold text-gray-900",children:i}),s.jsxs("div",{className:`\n          ml-auto flex items-center gap-1 text-sm font-medium\n          ${(null==(c=x[l])?void 0:c.split(" ")[1])||"text-blue-600"}\n          group-hover:gap-2 transition-all\n        `,children:[s.jsx("span",{children:"Manage"}),s.jsx(N,{className:"w-4 h-4"})]})]})]})};const Ps=()=>{const{profile:e}=Re(),r=t(),{data:a,isLoading:n}=y({queryKey:["admin-stats"],queryFn:()=>{return e=void 0,t=null,s=function*(){const e=je(new Date,"yyyy-MM-dd"),t=je(Pe(new Date,1),"yyyy-MM-dd"),s=je(Pe(new Date,7),"yyyy-MM-dd"),{count:r}=yield Le.from("users").select("*",{count:"exact",head:!0}).eq("is_active",!0),{count:a}=yield Le.from("locations").select("*",{count:"exact",head:!0}).eq("is_active",!0),{count:n}=yield Le.from("inspection_records").select("*",{count:"exact",head:!0}),{count:l}=yield Le.from("inspection_records").select("*",{count:"exact",head:!0}).eq("inspection_date",e),{count:i}=yield Le.from("inspection_records").select("*",{count:"exact",head:!0}).eq("inspection_date",t),{count:o}=yield Le.from("users").select("*",{count:"exact",head:!0}).gte("last_login_at",s).eq("is_active",!0),{data:c}=yield Le.from("inspection_records").select("responses").limit(100);return{totalUsers:r||0,totalLocations:a||0,totalInspections:n||0,todayInspections:l||0,activeUsers:o||0,avgScore:c&&c.length>0?Math.round(c.reduce((e,t)=>e+(e=>{const t=Object.values(e||{});if(0===t.length)return 0;const s=t.filter(e=>!0===e||"good"===e||"excellent"===e||"baik"===e||"bersih"===e||"ada"===e).length;return Math.round(s/t.length*100)})(t.responses),0)/c.length):0,userGrowth:0,inspectionGrowth:i&&i>0?Math.round(((l||0)-i)/i*100):0}},new Promise((r,a)=>{var n=e=>{try{i(s.next(e))}catch(t){a(t)}},l=e=>{try{i(s.throw(e))}catch(t){a(t)}},i=e=>e.done?r(e.value):Promise.resolve(e.value).then(n,l);i((s=s.apply(e,t)).next())});var e,t,s}});return n?s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):s.jsxs("div",{className:"min-h-screen bg-gray-50 pb-8",children:[s.jsxs("div",{className:"bg-gradient-to-br from-purple-600 via-purple-500 to-pink-500 p-6 rounded-b-3xl shadow-lg",children:[s.jsxs("div",{className:"flex items-center justify-between text-white mb-6",children:[s.jsx("button",{onClick:()=>r(-1),className:"p-2 hover:bg-white/10 rounded-xl transition-colors",children:s.jsx(L,{className:"w-6 h-6"})}),s.jsx("button",{onClick:()=>r("/profile"),className:"p-2 hover:bg-white/10 rounded-xl transition-colors",children:s.jsx(j,{className:"w-6 h-6"})})]}),s.jsxs("div",{className:"flex items-center gap-3 text-white mb-2",children:[s.jsx("div",{className:"w-12 h-12 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center",children:s.jsx(se,{className:"w-7 h-7"})}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold",children:"Admin Dashboard"}),s.jsxs("p",{className:"text-purple-100",children:["Welcome back, ",null==e?void 0:e.full_name,"!"]})]})]})]}),s.jsxs("div",{className:"px-6 -mt-8",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-6",children:[s.jsxs(ut,{className:"p-4 bg-gradient-to-br from-blue-50 to-cyan-50 border-blue-100",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center",children:s.jsx(U,{className:"w-5 h-5 text-blue-600"})}),a&&0!==a.inspectionGrowth&&s.jsxs("div",{className:"flex items-center gap-1 text-xs font-medium "+(a.inspectionGrowth>0?"text-green-600":"text-red-600"),children:[a.inspectionGrowth>0?s.jsx(P,{className:"w-3 h-3"}):s.jsx(z,{className:"w-3 h-3"}),s.jsxs("span",{children:[Math.abs(a.inspectionGrowth),"%"]})]})]}),s.jsx("div",{className:"text-2xl font-bold text-gray-900",children:(null==a?void 0:a.todayInspections)||0}),s.jsx("div",{className:"text-xs text-gray-600",children:"Today's Inspections"})]}),s.jsxs(ut,{className:"p-4 bg-gradient-to-br from-green-50 to-emerald-50 border-green-100",children:[s.jsx("div",{className:"flex items-center justify-between mb-2",children:s.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-xl flex items-center justify-center",children:s.jsx(b,{className:"w-5 h-5 text-green-600"})})}),s.jsx("div",{className:"text-2xl font-bold text-gray-900",children:(null==a?void 0:a.avgScore)||0}),s.jsx("div",{className:"text-xs text-gray-600",children:"Average Score"})]}),s.jsxs(ut,{className:"p-4 bg-gradient-to-br from-purple-50 to-pink-50 border-purple-100",children:[s.jsx("div",{className:"flex items-center justify-between mb-2",children:s.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-xl flex items-center justify-center",children:s.jsx(re,{className:"w-5 h-5 text-purple-600"})})}),s.jsx("div",{className:"text-2xl font-bold text-gray-900",children:(null==a?void 0:a.totalUsers)||0}),s.jsx("div",{className:"text-xs text-gray-600",children:"Total Users"})]}),s.jsxs(ut,{className:"p-4 bg-gradient-to-br from-orange-50 to-amber-50 border-orange-100",children:[s.jsx("div",{className:"flex items-center justify-between mb-2",children:s.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-xl flex items-center justify-center",children:s.jsx(U,{className:"w-5 h-5 text-orange-600"})})}),s.jsx("div",{className:"text-2xl font-bold text-gray-900",children:(null==a?void 0:a.activeUsers)||0}),s.jsx("div",{className:"text-xs text-gray-600",children:"Active Users (7d)"})]})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-3",children:"Management"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsx(Cs,{icon:re,title:"User Management",description:"Manage users, roles, and permissions",path:"/admin/users",color:"blue",count:null==a?void 0:a.totalUsers}),s.jsx(Cs,{icon:v,title:"Locations",description:"Manage toilet locations and QR codes",path:"/admin/locations",color:"green",count:null==a?void 0:a.totalLocations}),s.jsx(Cs,{icon:ae,title:"Occupations",description:"Manage job titles and roles",path:"/admin/occupations",color:"purple"}),s.jsx(Cs,{icon:ne,title:"Organizations",description:"Manage buildings and organizations",path:"/admin/organizations",color:"cyan"}),s.jsx(Cs,{icon:F,title:"Templates",description:"Manage inspection templates",path:"/admin/templates",color:"orange"}),s.jsx(Cs,{icon:b,title:"Reports",description:"View detailed analytics and reports",path:"/admin/reports",color:"red",count:null==a?void 0:a.totalInspections})]})]}),s.jsxs(ut,{children:[s.jsx(mt,{title:"System Overview",subtitle:"Key metrics at a glance",icon:s.jsx(U,{className:"w-5 h-5 text-blue-600"})}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-xl",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(F,{className:"w-5 h-5 text-gray-500"}),s.jsx("span",{className:"text-sm font-medium text-gray-900",children:"Total Inspections"})]}),s.jsx("span",{className:"text-lg font-bold text-gray-900",children:(null==a?void 0:a.totalInspections)||0})]}),s.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-xl",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(v,{className:"w-5 h-5 text-gray-500"}),s.jsx("span",{className:"text-sm font-medium text-gray-900",children:"Active Locations"})]}),s.jsx("span",{className:"text-lg font-bold text-gray-900",children:(null==a?void 0:a.totalLocations)||0})]}),s.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-xl",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(g,{className:"w-5 h-5 text-gray-500"}),s.jsx("span",{className:"text-sm font-medium text-gray-900",children:"Today's Activity"})]}),s.jsx("span",{className:"text-lg font-bold text-gray-900",children:(null==a?void 0:a.todayInspections)||0})]})]})]})]})]})},Ms=new fe({defaultOptions:{queries:{refetchOnWindowFocus:!1,retry:1}}});function Is(){const{user:e,loading:t}=Re();return t?s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600",children:"Loading..."})]})}):s.jsxs(ce,{children:[s.jsx(de,{path:"/login",element:e?s.jsx(xe,{to:"/",replace:!0}):s.jsx(ze,{})}),s.jsx(de,{path:"/register",element:e?s.jsx(xe,{to:"/",replace:!0}):s.jsx(Xe,{})}),s.jsx(de,{path:"/",element:e?s.jsx(rt,{}):s.jsx(xe,{to:"/login",replace:!0})}),s.jsx(de,{path:"/dashboard",element:e?s.jsx(xe,{to:"/",replace:!0}):s.jsx(xe,{to:"/login",replace:!0})}),s.jsx(de,{path:"/scan",element:e?s.jsx(wt,{}):s.jsx(xe,{to:"/login",replace:!0})}),s.jsx(de,{path:"/inspect/:locationId",element:e?s.jsx(ts,{}):s.jsx(xe,{to:"/login",replace:!0})}),s.jsx(de,{path:"/reports",element:e?s.jsx(cs,{}):s.jsx(xe,{to:"/login",replace:!0})}),s.jsx(de,{path:"/history",element:e?s.jsx(cs,{}):s.jsx(xe,{to:"/login",replace:!0})}),s.jsx(de,{path:"/analytics",element:e?s.jsx(ds,{}):s.jsx(xe,{to:"/login",replace:!0})}),s.jsx(de,{path:"/locations",element:e?s.jsx(ks,{}):s.jsx(xe,{to:"/login",replace:!0})}),s.jsx(de,{path:"/profile",element:e?s.jsx(ms,{}):s.jsx(xe,{to:"/login",replace:!0})}),s.jsx(de,{path:"/admin",element:e?s.jsx(Ps,{}):s.jsx(xe,{to:"/login",replace:!0})}),s.jsx(de,{path:"/admin/qr-generator",element:e?s.jsx(hs,{}):s.jsx(xe,{to:"/login",replace:!0})}),s.jsx(de,{path:"*",element:s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:s.jsxs("div",{className:"text-center",children:[s.jsx("h1",{className:"text-6xl font-bold text-gray-300 mb-4",children:"404"}),s.jsx("p",{className:"text-gray-600 mb-4",children:"Page not found"}),s.jsx("a",{href:"/",className:"text-blue-600 hover:underline font-medium",children:"Back to Dashboard"})]})})})]})}function Os(){return s.jsx(le,{client:Ms,children:s.jsxs(ie,{children:[s.jsx(Is,{}),s.jsx(oe,{position:"top-center",toastOptions:{duration:3e3,style:{background:"#363636",color:"#fff",borderRadius:"12px"},success:{iconTheme:{primary:"#10b981",secondary:"#fff"}},error:{iconTheme:{primary:"#ef4444",secondary:"#fff"}}}})]})})}Te.validateOnStartup(),ue.createRoot(document.getElementById("root")).render(s.jsx(me.StrictMode,{children:s.jsx(Os,{})}));
