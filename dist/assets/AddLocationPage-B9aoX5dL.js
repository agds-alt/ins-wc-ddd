import{f as e,u as s,r as a,b as i,j as r,aj as t,A as n,O as o,J as l,s as d,M as c,ak as u,ai as m,al as x,am as g,F as b,an as h,n as p}from"./react-vendor-BYw-DaJy.js";import{u as f,s as j}from"./admin-qdYEAokf.js";import{u as y}from"./useIsAdmin-Bas633Jw.js";import{S as v,B as w}from"./reports-MWgRG4S9.js";import"./vendor-BhGL79_Y.js";import"./supabase-vendor-BBQbdcgC.js";import"./date-vendor-cDx4sJEp.js";import"./inspection-CUNmxaai.js";const N=()=>{const N=e(),{user:_,authLoading:z}=f(),{isAdmin:S,loading:A}=y(),C=s(),[P,q]=a.useState(!1),[L,F]=a.useState([]),[O,E]=a.useState([]),[k,B]=a.useState(!1),[R,T]=a.useState({organization_id:"",building_id:"",name:"",code:"",floor:"",area:"",section:"",description:""});a.useEffect(()=>{(async()=>{const{data:e,error:s}=await j.from("organizations").select("*").eq("is_active",!0).order("name");s?p.error("Failed to load organizations"):F(e||[])})()},[]),a.useEffect(()=>{(async()=>{if(!R.organization_id)return void E([]);B(!0);const{data:e,error:s}=await j.from("buildings").select("*").eq("organization_id",R.organization_id).eq("is_active",!0).order("name");s?p.error("Failed to load buildings"):E(e||[]),B(!1)})()},[R.organization_id]);const D=i({mutationFn:async e=>{if(!(null==_?void 0:_.id))throw new Error("User not authenticated");if(!e.organization_id||!e.building_id)throw new Error("Organization and Building are required");const{data:s,error:a}=await j.from("buildings").select("short_code, organizations(short_code)").eq("id",e.building_id).single();if(a||!s)throw new Error("Building not found");const i=`${s.organizations.short_code}-${s.short_code}-${e.code||"LOC"}-${Date.now().toString(36).slice(-4)}`.toUpperCase(),r={name:e.name.trim(),code:e.code.trim()||null,organization_id:e.organization_id,building_id:e.building_id,floor:e.floor.trim()||null,area:e.area||null,section:e.section.trim()||null,description:e.description.trim()||null,qr_code:i,is_active:!0,created_by:_.id},{data:t,error:n}=await j.from("locations").insert(r).select().single();if(n)throw n;return t},onSuccess:()=>{C.invalidateQueries({queryKey:["locations-list"]}),C.invalidateQueries({queryKey:["locations"]}),p.success("Location added successfully!"),N("/locations")},onError:e=>{p.error(e.message||"Failed to add location")}}),Q=(e,s)=>{T(a=>"organization_id"===e?{...a,[e]:s,building_id:""}:{...a,[e]:s})};return z||A?r.jsx("div",{className:"min-h-screen bg-white flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),r.jsx("p",{className:"text-gray-600 text-sm",children:"Loading..."})]})}):_?S?r.jsxs("div",{className:"min-h-screen bg-white pb-24",children:[r.jsx(v,{isOpen:P,onClose:()=>q(!1)}),r.jsx("div",{className:"bg-white p-6 border-b border-gray-100",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("button",{onClick:()=>N(-1),className:"w-10 h-10 bg-white rounded-full flex items-center justify-center shadow-md hover:shadow-lg transition-shadow border border-gray-100",children:r.jsx(n,{className:"w-5 h-5 text-gray-600"})}),r.jsxs("div",{children:[r.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Add Location"}),r.jsx("p",{className:"text-sm text-gray-500",children:"Create new inspection point"})]})]}),r.jsx("button",{onClick:()=>q(!0),className:"w-10 h-10 bg-white rounded-full flex items-center justify-center shadow-md hover:shadow-lg transition-shadow border border-gray-100",children:r.jsx(o,{className:"w-5 h-5 text-gray-600"})})]})}),r.jsxs("div",{className:"p-6",children:[r.jsxs("form",{onSubmit:async e=>{e.preventDefault(),R.organization_id?R.building_id?R.name.trim()?D.mutate(R):p.error("Location name is required"):p.error("Please select a building"):p.error("Please select an organization")},className:"space-y-5",children:[r.jsxs("div",{children:[r.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-2",children:[r.jsx(l,{className:"w-4 h-4 text-blue-600"}),"Organization *"]}),r.jsxs("select",{value:R.organization_id,onChange:e=>Q("organization_id",e.target.value),className:"w-full px-4 py-3 bg-white border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,disabled:D.isPending,children:[r.jsx("option",{value:"",children:"Select Organization"}),L.map(e=>r.jsxs("option",{value:e.id,children:[e.name," (",e.short_code,")"]},e.id))]}),0===L.length&&r.jsx("p",{className:"text-xs text-red-500 mt-1",children:"No organizations found. Please contact admin."})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-2",children:[r.jsx(d,{className:"w-4 h-4 text-blue-600"}),"Building *"]}),r.jsxs("select",{value:R.building_id,onChange:e=>Q("building_id",e.target.value),className:"w-full px-4 py-3 bg-white border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:opacity-50 disabled:cursor-not-allowed",required:!0,disabled:!R.organization_id||k||D.isPending,children:[r.jsx("option",{value:"",children:k?"Loading buildings...":R.organization_id?"Select Building":"Select organization first"}),O.map(e=>r.jsxs("option",{value:e.id,children:[e.name," (",e.short_code,")"]},e.id))]}),R.organization_id&&0===O.length&&!k&&r.jsx("p",{className:"text-xs text-orange-500 mt-1",children:"No buildings found for this organization."})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-2",children:[r.jsx(c,{className:"w-4 h-4 text-blue-600"}),"Location Name *"]}),r.jsx("input",{type:"text",value:R.name,onChange:e=>Q("name",e.target.value),placeholder:"e.g., Men's Toilet, Women's Restroom",className:"w-full px-4 py-3 bg-white border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,disabled:D.isPending})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-2",children:[r.jsx(u,{className:"w-4 h-4 text-gray-400"}),"Location Code (Optional)"]}),r.jsx("input",{type:"text",value:R.code,onChange:e=>Q("code",e.target.value.toUpperCase()),placeholder:"e.g., WC-01, TL-A1",className:"w-full px-4 py-3 bg-white border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:D.isPending}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Will be used for QR code generation"})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[r.jsxs("div",{children:[r.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-2",children:[r.jsx(m,{className:"w-4 h-4 text-gray-400"}),"Floor"]}),r.jsx("input",{type:"text",value:R.floor,onChange:e=>Q("floor",e.target.value),placeholder:"e.g., 1F, Ground",className:"w-full px-4 py-3 bg-white border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:D.isPending})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-2",children:[r.jsx(x,{className:"w-4 h-4 text-gray-400"}),"Section"]}),r.jsx("input",{type:"text",value:R.section,onChange:e=>Q("section",e.target.value),placeholder:"e.g., Men, Women",className:"w-full px-4 py-3 bg-white border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:D.isPending})]})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-2",children:[r.jsx(g,{className:"w-4 h-4 text-gray-400"}),"Area Type"]}),r.jsxs("select",{value:R.area,onChange:e=>Q("area",e.target.value),className:"w-full px-4 py-3 bg-white border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:D.isPending,children:[r.jsx("option",{value:"",children:"Select Area Type (Optional)"}),r.jsx("option",{value:"Public Area",children:"Public Area"}),r.jsx("option",{value:"Staff Area",children:"Staff Area"}),r.jsx("option",{value:"VIP Area",children:"VIP Area"}),r.jsx("option",{value:"Service Area",children:"Service Area"}),r.jsx("option",{value:"Emergency Area",children:"Emergency Area"})]})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-2",children:[r.jsx(b,{className:"w-4 h-4 text-gray-400"}),"Description (Optional)"]}),r.jsx("textarea",{value:R.description,onChange:e=>Q("description",e.target.value),placeholder:"Additional notes or special instructions...",className:"w-full px-4 py-3 bg-white border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",rows:3,disabled:D.isPending})]}),r.jsxs("div",{className:"pt-4 space-y-3",children:[r.jsx("button",{type:"submit",disabled:D.isPending,className:"w-full bg-blue-600 text-white py-4 rounded-2xl font-bold shadow-lg hover:bg-blue-700 active:scale-[0.98] transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:D.isPending?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),r.jsx("span",{children:"Saving..."})]}):r.jsxs(r.Fragment,{children:[r.jsx(h,{className:"w-5 h-5"}),r.jsx("span",{children:"Save Location"})]})}),r.jsx("button",{type:"button",onClick:()=>N(-1),disabled:D.isPending,className:"w-full bg-white border-2 border-gray-200 text-gray-700 py-4 rounded-2xl font-medium hover:bg-gray-50 active:scale-[0.98] transition-all disabled:opacity-50",children:"Cancel"})]})]}),r.jsxs("div",{className:"mt-6 bg-blue-50 border border-blue-100 rounded-xl p-4",children:[r.jsx("p",{className:"text-sm text-blue-900 font-medium mb-2",children:"ðŸ’¡ Tips:"}),r.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[r.jsx("li",{children:"â€¢ Select organization first, then building"}),r.jsx("li",{children:"â€¢ QR code will be auto-generated from codes"}),r.jsx("li",{children:"â€¢ Use clear, descriptive location names"}),r.jsx("li",{children:"â€¢ Location will be active by default"})]})]})]}),r.jsx(w,{})]}):r.jsx("div",{className:"min-h-screen bg-white flex items-center justify-center p-6",children:r.jsxs("div",{className:"text-center max-w-md",children:[r.jsx(t,{className:"w-20 h-20 text-red-500 mx-auto mb-4"}),r.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-3",children:"Admin Access Required"}),r.jsx("p",{className:"text-gray-600 mb-6 leading-relaxed",children:"You need administrator privileges to add new locations. Please contact your system administrator if you believe this is an error."}),r.jsx("button",{onClick:()=>N("/"),className:"w-full bg-blue-600 text-white px-6 py-3 rounded-xl font-medium hover:bg-blue-700 transition-colors",children:"Return to Dashboard"})]})}):(N("/login",{replace:!0}),null)};export{N as AddLocationPage};
