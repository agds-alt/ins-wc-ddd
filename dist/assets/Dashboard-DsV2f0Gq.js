import{r as e,j as s,X as t,ak as a,D as r,u as l,h as n,m as i,U as d,Q as o,t as c,M as x,d as m,V as h,K as u}from"./react-vendor-B7zQ2Eq0.js";import{u as g,S as p,B as b,s as j}from"./admin-DR-prBnq.js";import{i as f,a as w,g as N,s as y}from"./index-BlhPS-er.js";import"./vendor-CnJW_4UD.js";import"./supabase-vendor-Cq9hqQQH.js";import"./date-vendor-CSGrVI8S.js";const v=()=>{const[l,n]=e.useState(!1),[i,d]=e.useState(!1);e.useEffect(()=>{if(f())return;if(sessionStorage.getItem("pwa-prompt-dismissed"))return;const e=()=>{n(!0)};return window.addEventListener("pwa-installable",e),w()&&!f()&&setTimeout(()=>{n(!0)},3e3),()=>{window.removeEventListener("pwa-installable",e)}},[]);const o=()=>{d(!0),sessionStorage.setItem("pwa-prompt-dismissed","true"),n(!1)};return!l||i||f()?null:s.jsx("div",{className:"fixed bottom-20 left-4 right-4 z-50 animate-in slide-in-from-bottom duration-300 md:left-auto md:right-4 md:w-96",children:s.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl border border-gray-200 p-4",children:[s.jsx("button",{onClick:o,className:"absolute top-2 right-2 p-1 hover:bg-gray-100 rounded-lg transition-colors",children:s.jsx(t,{className:"w-4 h-4 text-gray-500"})}),s.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[s.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-600 to-blue-400 rounded-2xl flex items-center justify-center flex-shrink-0 shadow-lg",children:s.jsx(a,{className:"w-6 h-6 text-white"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"font-bold text-gray-900 text-lg",style:{textShadow:"1px 1px 2px rgba(0,0,0,0.1)"},children:"Install WC Check"}),s.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Install our app for faster access and offline support"})]})]}),s.jsxs("div",{className:"space-y-2 mb-4",children:[s.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700",children:[s.jsx("div",{className:"w-1.5 h-1.5 bg-blue-600 rounded-full"}),s.jsx("span",{children:"Works offline"})]}),s.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700",children:[s.jsx("div",{className:"w-1.5 h-1.5 bg-blue-600 rounded-full"}),s.jsx("span",{children:"Quick access from home screen"})]}),s.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700",children:[s.jsx("div",{className:"w-1.5 h-1.5 bg-blue-600 rounded-full"}),s.jsx("span",{children:"Faster performance"})]})]}),w()&&s.jsxs("div",{className:"mb-3 p-3 bg-blue-50 rounded-xl border border-blue-100",children:[s.jsx("p",{className:"text-xs text-blue-900 font-medium mb-1",children:"ðŸ“± How to install:"}),s.jsx("p",{className:"text-xs text-blue-700",children:N()})]}),s.jsxs("div",{className:"flex gap-2",children:[!w()&&s.jsxs("button",{onClick:async()=>{await y()||(d(!0),sessionStorage.setItem("pwa-prompt-dismissed","true")),n(!1)},className:"flex-1 bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-700 hover:to-blue-600 text-white py-3 px-4 rounded-xl font-medium transition-all flex items-center justify-center gap-2 shadow-lg shadow-blue-600/30",children:[s.jsx(r,{className:"w-4 h-4"}),"Install Now"]}),s.jsx("button",{onClick:o,className:(w()?"flex-1":"")+" bg-gray-100 hover:bg-gray-200 text-gray-700 py-3 px-4 rounded-xl font-medium transition-colors",children:w()?"Got it":"Later"})]})]})})},_=()=>{var t;const{user:a,profile:r,loading:f}=g(),w=l(),[N,y]=e.useState(!1),_=!f&&!!(null==a?void 0:a.id),{data:C,isLoading:k,error:S}=n({queryKey:["dashboard-stats",null==a?void 0:a.id],queryFn:async()=>{if(!(null==a?void 0:a.id))return null;const{data:e,error:s}=await j.from("inspection_records").select("id, overall_status, inspection_date, responses").eq("user_id",a.id).order("inspection_date",{ascending:!1}).limit(50);if(s)return{total:0,todayCount:0,completed:0,recent:[]};const t=(null==e?void 0:e.length)||0,r=new Date,l=r.toISOString().split("T")[0];new Date(r.getFullYear(),r.getMonth(),r.getDate());return{total:t,todayCount:(null==e?void 0:e.filter(e=>{if(!e.inspection_date)return!1;if(e.inspection_date===l)return!0;if(e.inspection_date.startsWith(l))return!0;try{const s=new Date(e.inspection_date);return s.getFullYear()===r.getFullYear()&&s.getMonth()===r.getMonth()&&s.getDate()===r.getDate()}catch{return!1}}).length)||0,completed:(null==e?void 0:e.filter(e=>{var s;return"completed"===e.overall_status||"excellent"===e.overall_status||"good"===e.overall_status||(null==(s=e.responses)?void 0:s.score)&&e.responses.score>=60}).length)||0,recent:(null==e?void 0:e.slice(0,3))||[]}},enabled:_,staleTime:3e5,gcTime:6e5,refetchOnMount:!1,refetchOnWindowFocus:!1,retry:!1}),I=C||{total:0,todayCount:0,completed:0,recent:[]};return s.jsxs("div",{className:"min-h-screen bg-white pb-20",children:[s.jsx(p,{isOpen:N,onClose:()=>y(!1)}),s.jsx("div",{className:"bg-white p-6 border-b border-gray-100",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("button",{onClick:()=>y(!0),className:"w-10 h-10 bg-white rounded-full flex items-center justify-center shadow-md hover:shadow-lg transition-shadow border border-gray-100",children:s.jsx(i,{className:"w-5 h-5 text-gray-600"})}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"WC Check"}),s.jsxs("p",{className:"text-sm text-gray-500",children:["Hi, ",(null==r?void 0:r.full_name)||(null==(t=null==a?void 0:a.email)?void 0:t.split("@")[0])||"User"]})]})]}),s.jsx("button",{onClick:()=>w("/profile"),className:"w-10 h-10 bg-white rounded-full flex items-center justify-center shadow-md hover:shadow-lg transition-shadow border border-gray-100",children:s.jsx(d,{className:"w-5 h-5 text-gray-600"})})]})}),s.jsxs("main",{className:"p-5 space-y-5",children:[s.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[s.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-[0_8px_30px_rgb(0,0,0,0.08)] border border-gray-50",children:[s.jsx("p",{className:"text-3xl font-bold text-gray-900",children:I.total}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Total"})]}),s.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-[0_8px_30px_rgb(0,0,0,0.08)] border border-gray-50",children:[s.jsx("p",{className:"text-3xl font-bold text-blue-600",children:I.todayCount}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Today"})]}),s.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-[0_8px_30px_rgb(0,0,0,0.08)] border border-gray-50",children:[s.jsx("p",{className:"text-3xl font-bold text-green-600",children:I.completed}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Done"})]})]}),s.jsx("button",{onClick:()=>w("/scan"),type:"button",className:"w-full bg-white rounded-3xl p-6 shadow-[0_12px_40px_rgb(0,0,0,0.12)] active:shadow-[0_8px_30px_rgb(0,0,0,0.1)] active:translate-y-1 transition-all border border-gray-100",children:s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{className:"w-16 h-16 bg-blue-600 rounded-2xl flex items-center justify-center shadow-lg",children:s.jsx(o,{className:"w-8 h-8 text-white"})}),s.jsxs("div",{className:"flex-1 text-left",children:[s.jsx("p",{className:"font-bold text-lg text-gray-900",children:"Scan QR Code"}),s.jsx("p",{className:"text-gray-500 text-sm",children:"Start new inspection"})]}),s.jsx(c,{className:"w-6 h-6 text-gray-400"})]})}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsxs("button",{onClick:()=>w("/locations"),className:"bg-white rounded-2xl p-5 shadow-[0_8px_30px_rgb(0,0,0,0.08)] active:shadow-[0_4px_20px_rgb(0,0,0,0.06)] active:translate-y-1 transition-all border border-gray-50",children:[s.jsx(x,{className:"w-7 h-7 text-blue-600 mb-3"}),s.jsx("p",{className:"font-semibold text-gray-900 text-sm",children:"Locations"})]}),s.jsxs("button",{onClick:()=>w("/reports"),className:"bg-white rounded-2xl p-5 shadow-[0_8px_30px_rgb(0,0,0,0.08)] active:shadow-[0_4px_20px_rgb(0,0,0,0.06)] active:translate-y-1 transition-all border border-gray-50",children:[s.jsx(m,{className:"w-7 h-7 text-blue-600 mb-3"}),s.jsx("p",{className:"font-semibold text-gray-900 text-sm",children:"Reports"})]})]}),I.recent&&I.recent.length>0&&s.jsxs("div",{className:"bg-white rounded-2xl shadow-[0_8px_30px_rgb(0,0,0,0.08)] border border-gray-50 p-5",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h2",{className:"font-bold text-gray-900",children:"Recent"}),s.jsx("button",{onClick:()=>w("/reports"),className:"text-blue-600 text-sm font-medium",children:"View All"})]}),s.jsx("div",{className:"space-y-3",children:I.recent.slice(0,3).map(e=>s.jsx("div",{className:"flex items-center justify-between",children:s.jsxs("div",{className:"flex items-center gap-3",children:["completed"===e.overall_status||"excellent"===e.overall_status||"good"===e.overall_status?s.jsx("div",{className:"w-10 h-10 bg-green-50 rounded-xl flex items-center justify-center",children:s.jsx(h,{className:"w-5 h-5 text-green-600"})}):s.jsx("div",{className:"w-10 h-10 bg-gray-50 rounded-xl flex items-center justify-center",children:s.jsx(u,{className:"w-5 h-5 text-gray-400"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Inspection"}),s.jsx("p",{className:"text-xs text-gray-500",children:e.inspection_date})]})]})},e.id))})]}),0===I.total&&s.jsxs("div",{className:"text-center py-12 bg-white rounded-2xl shadow-[0_8px_30px_rgb(0,0,0,0.08)] border border-gray-50",children:[s.jsx("div",{className:"w-20 h-20 bg-gray-50 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx(o,{className:"w-10 h-10 text-gray-300"})}),s.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:"No Inspections Yet"}),s.jsx("p",{className:"text-gray-500 text-sm",children:"Scan a QR code to start"})]})]}),s.jsx(v,{}),s.jsx(b,{})]})};export{_ as Dashboard};
