var e=Object.defineProperty,t=(t,s,a)=>((t,s,a)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a)(t,"symbol"!=typeof s?s+"":s,a);import{r as s,j as a,l as r,X as n,P as i,Q as o,D as l,u as c,a as d,b as u,U as m,S as x,c as g,d as h,M as p,E as b,C as f,e as v,T as y,n as j,f as w,g as N,A as S,h as _,i as k,k as I,m as C,o as L,p as E,q as z,B as T,s as O,F as A,t as M}from"./react-vendor-BYw-DaJy.js";import{c as q}from"./vendor-BhGL79_Y.js";import{c as P}from"./supabase-vendor-BBQbdcgC.js";import{f as R,s as U}from"./date-vendor-cDx4sJEp.js";const $=new class{constructor(){t(this,"sessionId"),t(this,"userId"),t(this,"logs",[]),t(this,"maxLogs",100),t(this,"isDev",!1),this.sessionId=this.getOrCreateSessionId(),this.initSession()}getOrCreateSessionId(){let e=sessionStorage.getItem("app_session_id");return e||(e=`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,sessionStorage.setItem("app_session_id",e)),e}initSession(){this.info("Session started",{sessionId:this.sessionId,timestamp:(new Date).toISOString(),userAgent:navigator.userAgent,screen:`${window.screen.width}x${window.screen.height}`,viewport:`${window.innerWidth}x${window.innerHeight}`,platform:navigator.platform,language:navigator.language})}setUserId(e){this.userId=e,this.info("User authenticated",{userId:e})}createLogEntry(e,t,s){return{timestamp:(new Date).toISOString(),level:e,message:t,data:s,sessionId:this.sessionId,userId:this.userId,url:window.location.href,userAgent:navigator.userAgent}}addLog(e){this.logs.push(e),this.logs.length>this.maxLogs&&this.logs.shift();try{localStorage.setItem("app_logs",JSON.stringify(this.logs.slice(-20)))}catch(t){}}debug(e,t){if(!this.isDev)return;const s=this.createLogEntry("debug",e,t);this.addLog(s)}info(e,t){const s=this.createLogEntry("info",e,t);this.addLog(s)}warn(e,t){const s=this.createLogEntry("warn",e,t);this.addLog(s)}error(e,t){const s=this.createLogEntry("error",e,{error:(null==t?void 0:t.message)||t,stack:null==t?void 0:t.stack,name:null==t?void 0:t.name});this.addLog(s),this.sendErrorToServer(s)}startTimer(e){const t=performance.now();return this.debug(`â±ï¸ Timer started: ${e}`),()=>{const s=performance.now()-t;this.info(`â±ï¸ Timer ended: ${e}`,{duration:`${s.toFixed(2)}ms`,slow:s>1e3}),s>1e3&&this.warn(`Slow operation detected: ${e}`,{duration:s})}}logApiCall(e,t,s,a){const r=`API ${e} ${t}`;this[s&&s>=400?"error":"info"](r,{method:e,url:t,status:s,duration:a?`${a}ms`:void 0})}getLogs(e){return e?this.logs.filter(t=>t.level===e):this.logs}exportLogs(){return JSON.stringify({sessionId:this.sessionId,userId:this.userId,exportedAt:(new Date).toISOString(),logs:this.logs},null,2)}clearLogs(){this.logs=[],localStorage.removeItem("app_logs"),this.info("Logs cleared")}async sendErrorToServer(e){}};window.addEventListener("error",e=>{$.error("Uncaught error",{message:e.message,filename:e.filename,lineno:e.lineno,colno:e.colno,error:e.error})}),window.addEventListener("unhandledrejection",e=>{$.error("Unhandled promise rejection",{reason:e.reason})}),window.addEventListener("popstate",()=>{$.info("Navigation",{url:window.location.href,type:"popstate"})});const D="https://zznhsfsvankfewasstel.supabase.co",F="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp6bmhzZnN2YW5rZmV3YXNzdGVsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA2MzY5MTQsImV4cCI6MjA3NjIxMjkxNH0.U2XCOfWSuZQpTzzgwMhkSAL0CJz1bqtHIkziLYpwmZ0";class B extends Error{constructor(e){super(e),this.name="SupabaseConfigError"}}class Q extends Error{constructor(e){super(e),this.name="SupabaseConnectionError"}}const J=(()=>{try{(()=>{const e=[];if(e.length>0){const t=new B(`Missing required environment variables: ${e.join(", ")}`);throw $.error("Supabase config validation failed",t),t}try{new URL(D)}catch{const e=new B("Invalid VITE_SUPABASE_URL format");throw $.error("Invalid Supabase URL",e),e}$.info("Supabase configuration validated",{url:`${D.substring(0,25)}...`,hasKey:!0,keyLength:208})})();const e=P(D,F,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"pkce",storage:localStorage},realtime:{params:{eventsPerSecond:10}},global:{headers:{"X-Client-Info":"wc-check-app","X-Client-Version":"1.0.0"}},db:{schema:"public"}});return $.info("Supabase client created successfully"),e}catch(e){throw $.error("Failed to create Supabase client",e),e}})();let G=!1,V=!1;(async()=>{const e=$.startTimer("Supabase connection test");try{$.info("Testing Supabase connection...");const{data:t,error:s}=await(async(e,t=3,a=1e3)=>{let r;for(let n=1;n<=t;n++)try{return await e()}catch(s){if(r=s,$.warn(`Retry attempt ${n}/${t} failed`,{attempt:n,maxRetries:t,error:r.message}),n===t)break;const i=a*Math.pow(2,n-1);$.debug(`Retrying in ${i}ms...`),await new Promise(e=>setTimeout(e,i))}throw $.error("All retry attempts failed",r),r})(async()=>{var e,t,s,a;const r=await J.auth.getSession();if((null==(t=null==(e=r.error)?void 0:e.message)?void 0:t.includes("fetch"))||(null==(a=null==(s=r.error)?void 0:s.message)?void 0:a.includes("network")))throw new Q(`Network error: ${r.error.message}`);return r});return e(),s?($.error("Supabase connection test failed",s),!1):($.info("Supabase connected successfully",{authenticated:!!t.session}),!0)}catch(t){return e(),$.error("Supabase connection test failed after retries",t),!1}})().then(e=>{G=!0,V=e,e?$.info("Supabase client initialized and ready"):$.error("Supabase client initialization failed")}),new Promise(e=>{const t=()=>{G?e(V):setTimeout(t,100)};t()});const W={save(e){var t;try{if(!e)return;const s={access_token:e.access_token,refresh_token:e.refresh_token,expires_at:e.expires_at,expires_in:e.expires_in,token_type:e.token_type,user:e.user};localStorage.setItem("supabase.auth.token",JSON.stringify(s)),localStorage.setItem("sb-auth-token",e.access_token),localStorage.setItem("sb-refresh-token",e.refresh_token),localStorage.setItem("sb-user-data",JSON.stringify(e.user)),localStorage.setItem("sb-expires-at",(null==(t=e.expires_at)?void 0:t.toString())||"")}catch(s){}},isValid(){try{const e=localStorage.getItem("supabase.auth.token");if(!e)return!1;const t=JSON.parse(e);return!(!t||"object"!=typeof t)&&!!t.access_token}catch(e){return!1}},clear(){try{const e=Object.keys(localStorage);e.filter(e=>e.startsWith("supabase.auth")||e.startsWith("sb-")).forEach(e=>{localStorage.removeItem(e)}),localStorage.removeItem("user"),localStorage.removeItem("session"),localStorage.removeItem("token"),sessionStorage.clear()}catch(e){try{localStorage.clear()}catch(t){}}},validateOnStartup(){(!this.isValid()&&this.hasStoredToken()||this.hasStoredToken()&&this.isTokenExpired())&&this.clear()},hasStoredToken(){try{const e=localStorage.getItem("supabase.auth.token");return null!==e&&"undefined"!==e&&""!==e}catch{return!1}},getTokenExpiry(){try{const e=localStorage.getItem("supabase.auth.token");if(!e)return null;const t=JSON.parse(e);return t.expires_at?new Date(1e3*t.expires_at):null}catch(e){return null}},isTokenExpired(){const e=this.getTokenExpiry();if(!e)return!0;const t=Date.now(),s=e.getTime()<t+6e4;return s},getTimeUntilExpiry(){const e=this.getTokenExpiry();if(!e)return 0;const t=Date.now(),s=e.getTime(),a=Math.floor((s-t)/1e3);return Math.max(0,a)},getUserId(){var e;try{const t=localStorage.getItem("supabase.auth.token");if(!t)return null;return(null==(e=JSON.parse(t).user)?void 0:e.id)||null}catch{return null}},debug(){Object.keys(localStorage).filter(e=>e.startsWith("supabase")||e.startsWith("sb-"))},emergencyReset(){this.clear(),window.location.href="/login"}};"undefined"!=typeof window&&(window.authStorage=W);let K=null,X=0;function H(){const[e,t]=s.useState(null),[a,r]=s.useState(null),[n,i]=s.useState(!0),[o,l]=s.useState(null),c=s.useRef(!1),d=async e=>{try{const t=Date.now();if(K&&t-X<3e5)return K;const{data:s,error:a}=await J.from("users").select("id, email, full_name, is_active, occupation_id").eq("id",e).eq("is_active",!0).maybeSingle();return a?null:s?(K=s,X=t,s):null}catch(t){return null}},u=s.useCallback(async()=>{if(!(null==e?void 0:e.id))return;const t=await d(e.id);r(t)},[null==e?void 0:e.id]);s.useEffect(()=>{if(c.current)return;c.current=!0;let e=!0;return(async()=>{const s=setTimeout(()=>{e&&i(!1)},3e3);try{const{data:{session:a},error:n}=await J.auth.getSession();if(clearTimeout(s),!e)return;if(n||!(null==a?void 0:a.user))return W.clear(),t(null),r(null),void i(!1);W.save(a);const o={id:a.user.id,email:a.user.email,user_metadata:a.user.user_metadata,app_metadata:a.user.app_metadata,created_at:a.user.created_at,updated_at:a.user.updated_at};t(o),d(a.user.id).then(t=>{e&&r(t)}),i(!1)}catch(a){e&&(t(null),r(null),i(!1))}})(),()=>{e=!1}},[]),s.useEffect(()=>{const{data:{subscription:e}}=J.auth.onAuthStateChange(async(e,s)=>{switch(e){case"SIGNED_IN":if(null==s?void 0:s.user){W.save(s);const e={id:s.user.id,email:s.user.email,user_metadata:s.user.user_metadata,app_metadata:s.user.app_metadata,created_at:s.user.created_at,updated_at:s.user.updated_at};t(e);const a=await d(s.user.id);r(a),await(async e=>{try{await J.from("users").update({last_login_at:(new Date).toISOString()}).eq("id",e)}catch(t){}})(s.user.id)}break;case"TOKEN_REFRESHED":break;case"SIGNED_OUT":W.clear(),K=null,X=0,t(null),r(null)}});return()=>{e.unsubscribe()}},[]);const m=s.useCallback(async()=>{try{await J.auth.signOut(),W.clear(),K=null,X=0,t(null),r(null)}catch(e){}},[]);return{user:e,profile:a,loading:n,error:o,isAuthenticated:!!e,signOut:m,refreshProfile:u}}const Y=({children:e,variant:t="default",hoverable:s=!0,padding:r="md",className:n,...i})=>{const o=s?"hover:shadow-md hover:-translate-y-0.5 active:scale-[0.99]":"";return a.jsx("div",{className:q("bg-white rounded-2xl transition-all",{default:"shadow-sm border border-gray-100",flat:"border border-gray-200",bordered:"border-2 border-gray-200",glass:"glass"}[t],{none:"",sm:"p-3",md:"p-4",lg:"p-6"}[r],o,n),...i,children:e})},Z=({title:e,subtitle:t,action:s,icon:r})=>a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[r&&a.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center text-xl",children:r}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold text-gray-900",children:e}),t&&a.jsx("p",{className:"text-sm text-gray-500",children:t})]})]}),s&&a.jsx("div",{children:s})]}),ee=({variant:e="primary",size:t="md",children:s,loading:r=!1,className:n,disabled:i,...o})=>a.jsx("button",{className:q("font-medium rounded-2xl transition-all active:scale-95 focus:outline-none focus:ring-2 focus:ring-offset-2",{primary:"bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500 shadow-lg",secondary:"bg-gray-600 text-white hover:bg-gray-700 focus:ring-gray-500",outline:"border border-gray-300 text-gray-700 hover:bg-gray-50 focus:ring-blue-500 bg-white"}[e],{sm:"px-3 py-2 text-sm",md:"px-4 py-3 text-sm",lg:"px-6 py-4 text-base"}[t],(i||r)&&"opacity-50 cursor-not-allowed",n),disabled:i||r,...o,children:r?a.jsxs("div",{className:"flex items-center justify-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Loading..."]}):s}),te=({locations:e,onClose:t})=>{const c=s.useRef(null),d=e=>`https://wc-checks.vercel.app/locations/${e}`,u=r.useReactToPrint({content:()=>c.current,documentTitle:`QR-Codes-${(new Date).toISOString().split("T")[0]}`,pageStyle:"\n      @page {\n        size: A4;\n        margin: 15mm;\n      }\n      @media print {\n        body {\n          -webkit-print-color-adjust: exact;\n          print-color-adjust: exact;\n        }\n      }\n    "});return a.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 overflow-y-auto",children:a.jsxs(Y,{className:"w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[a.jsxs("div",{className:"sticky top-0 bg-white pb-4 border-b border-gray-200 flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"QR Code Generator"}),a.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[e.length," location",e.length>1?"s":""," â€¢ Production URL"]})]}),a.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:a.jsx(n,{className:"w-5 h-5"})})]}),a.jsx("div",{className:"flex space-x-3 my-4",children:a.jsxs(ee,{onClick:u,className:"flex-1 flex items-center justify-center space-x-2",children:[a.jsx(i,{className:"w-5 h-5"}),a.jsxs("span",{children:["Print All (",e.length,")"]})]})}),a.jsx("div",{className:"space-y-4",children:e.map(e=>{const t=d(e.id);return a.jsx(Y,{className:"bg-gray-50",children:a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsx("div",{id:`qr-${e.id}`,className:"flex-shrink-0 bg-white p-2 rounded-lg",children:a.jsx(o,{value:t,size:120,level:"H",includeMargin:!0})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("h3",{className:"font-semibold text-gray-900 truncate",children:e.name}),e.code&&a.jsxs("p",{className:"text-sm text-blue-600 font-medium",children:["Code: ",e.code]}),a.jsxs("div",{className:"text-sm text-gray-600 mt-1 space-y-0.5",children:[e.building&&a.jsxs("p",{children:["ðŸ¢ ",e.building]}),e.floor&&a.jsxs("p",{children:["ðŸ“ ",e.floor]}),e.area&&a.jsxs("p",{children:["ðŸ“Œ ",e.area]})]}),a.jsxs("div",{className:"mt-2 p-2 bg-white rounded border border-gray-200",children:[a.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"QR URL:"}),a.jsx("p",{className:"text-xs font-mono text-gray-700 break-all",children:t})]})]}),a.jsx(ee,{variant:"outline",size:"sm",onClick:()=>(e=>{var t;const s=null==(t=document.getElementById(`qr-${e.id}`))?void 0:t.querySelector("svg");if(!s)return;const a=(new XMLSerializer).serializeToString(s),r=document.createElement("canvas"),n=r.getContext("2d"),i=new Image;r.width=512,r.height=512,i.onload=()=>{null==n||n.drawImage(i,0,0),r.toBlob(t=>{if(t){const s=URL.createObjectURL(t),a=document.createElement("a");a.download=`QR-${e.code||e.name}.png`,a.href=s,a.click(),URL.revokeObjectURL(s)}})},i.src="data:image/svg+xml;base64,"+btoa(a)})(e),className:"flex-shrink-0",title:"Download PNG",children:a.jsx(l,{className:"w-4 h-4"})})]})},e.id)})}),a.jsx("div",{style:{display:"none"},children:a.jsxs("div",{ref:c,children:[a.jsx("style",{children:"\n                @media print {\n                  .qr-print-item {\n                    page-break-inside: avoid;\n                    page-break-after: auto;\n                    margin-bottom: 30mm;\n                  }\n                  .qr-print-item:last-child {\n                    page-break-after: avoid;\n                  }\n                }\n              "}),e.map(e=>{const t=d(e.id);return a.jsx("div",{className:"qr-print-item",children:a.jsxs("div",{style:{border:"2px solid #e5e7eb",borderRadius:"12px",padding:"20mm",textAlign:"center",background:"white"},children:[a.jsx("div",{style:{marginBottom:"10mm"},children:a.jsx(o,{value:t,size:200,level:"H",includeMargin:!0})}),a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("h2",{style:{fontSize:"24px",fontWeight:"bold",marginBottom:"8px",color:"#111827"},children:e.name}),e.code&&a.jsx("p",{style:{fontSize:"18px",color:"#2563eb",fontWeight:"600",marginBottom:"8px"},children:e.code}),e.building&&a.jsx("p",{style:{fontSize:"14px",color:"#6b7280",marginBottom:"4px"},children:e.building}),e.floor&&a.jsx("p",{style:{fontSize:"14px",color:"#6b7280",marginBottom:"4px"},children:e.floor}),e.area&&a.jsx("p",{style:{fontSize:"14px",color:"#6b7280"},children:e.area})]})]})},e.id)})]})})]})})},se=Object.freeze(Object.defineProperty({__proto__:null,QRCodeGenerator:te},Symbol.toStringTag,{value:"Module"})),ae=({location:e,onClose:t,onSuccess:r})=>{var n;const{user:i}=H(),o=c(),[l,d]=s.useState([]),[m,x]=s.useState([]),[g,h]=s.useState(!1),[p,b]=s.useState({name:(null==e?void 0:e.name)||"",code:(null==e?void 0:e.code)||"",organization_id:(null==e?void 0:e.organization_id)||"",building_id:(null==e?void 0:e.building_id)||"",floor:(null==e?void 0:e.floor)||"",area:(null==e?void 0:e.area)||"",section:(null==e?void 0:e.section)||"",description:(null==e?void 0:e.description)||""});s.useEffect(()=>{(async()=>{const{data:e,error:t}=await J.from("organizations").select("*").eq("is_active",!0).order("name");t||d(e||[])})()},[]),s.useEffect(()=>{(async()=>{if(!p.organization_id)return void x([]);h(!0);const{data:e,error:t}=await J.from("buildings").select("*").eq("organization_id",p.organization_id).eq("is_active",!0).order("name");t||x(e||[]),h(!1)})()},[p.organization_id]);const f=u({mutationFn:async t=>{if(!t.organization_id||!t.building_id)throw new Error("Organization and Building are required");if(e){const s={name:t.name,code:t.code,organization_id:t.organization_id,building_id:t.building_id,floor:t.floor,area:t.area,section:t.section,description:t.description,updated_at:(new Date).toISOString()},{error:a}=await J.from("locations").update(s).eq("id",e.id);if(a)throw a}else{const{data:e,error:s}=await J.from("buildings").select("short_code, organizations(short_code)").eq("id",t.building_id).single();if(s||!e)throw new Error("Building not found");const a=e.organizations.short_code+"-"+e.short_code+"-"+(t.code||"LOC")+"-"+Date.now().toString(36).slice(-4),r={name:t.name,code:t.code,organization_id:t.organization_id,building_id:t.building_id,floor:t.floor,area:t.area,section:t.section,description:t.description,qr_code:a.toUpperCase(),is_active:!0,created_by:(null==i?void 0:i.id)||null},{error:n}=await J.from("locations").insert(r);if(n)throw n}},onSuccess:()=>{j.success(e?"Location updated":"Location created"),o.invalidateQueries({queryKey:["locations"]}),r()},onError:e=>{j.error(e.message||"Failed to save location")}});return a.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:a.jsxs(Y,{className:"w-full max-w-lg max-h-[90vh] overflow-y-auto",children:[a.jsxs("div",{className:"sticky top-0 bg-white pb-4 border-b border-gray-200",children:[a.jsx("h2",{className:"text-xl font-bold text-gray-900",children:e?"Edit Location":"Add Location"}),i&&a.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Created by: ",(null==(n=i.user_metadata)?void 0:n.name)||i.email]})]}),a.jsxs("form",{onSubmit:e=>{var t;e.preventDefault(),(null==(t=p.name)?void 0:t.trim())?p.organization_id?p.building_id?f.mutate(p):j.error("Building is required"):j.error("Organization is required"):j.error("Location name is required")},className:"space-y-4 mt-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Organization *"}),a.jsxs("select",{value:p.organization_id||"",onChange:e=>b({...p,organization_id:e.target.value,building_id:""}),className:"w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,disabled:f.isPending,children:[a.jsx("option",{value:"",children:"Select Organization"}),l.map(e=>a.jsxs("option",{value:e.id,children:[e.name," (",e.short_code,")"]},e.id))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Building *"}),a.jsxs("select",{value:p.building_id||"",onChange:e=>b({...p,building_id:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,disabled:!p.organization_id||g||f.isPending,children:[a.jsx("option",{value:"",children:g?"Loading buildings...":p.organization_id?"Select Building":"Select organization first"}),m.map(e=>a.jsxs("option",{value:e.id,children:[e.name," (",e.short_code,")"]},e.id))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Location Name *"}),a.jsx("input",{type:"text",value:p.name||"",onChange:e=>b({...p,name:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"e.g. Toilet Lantai 3",required:!0,disabled:f.isPending})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Location Code"}),a.jsx("input",{type:"text",value:p.code||"",onChange:e=>b({...p,code:e.target.value.toUpperCase()}),className:"w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"e.g. WC-03, T-MEN-1",disabled:f.isPending})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Floor"}),a.jsx("input",{type:"text",value:p.floor||"",onChange:e=>b({...p,floor:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Lantai 3",disabled:f.isPending})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Section"}),a.jsx("input",{type:"text",value:p.section||"",onChange:e=>b({...p,section:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Pria/Wanita",disabled:f.isPending})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Area Type"}),a.jsxs("select",{value:p.area||"",onChange:e=>b({...p,area:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:f.isPending,children:[a.jsx("option",{value:"",children:"Select Area Type"}),a.jsx("option",{value:"Public Area",children:"Public Area"}),a.jsx("option",{value:"Staff Area",children:"Staff Area"}),a.jsx("option",{value:"VIP Area",children:"VIP Area"}),a.jsx("option",{value:"Service Area",children:"Service Area"}),a.jsx("option",{value:"Emergency Area",children:"Emergency Area"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),a.jsx("textarea",{value:p.description||"",onChange:e=>b({...p,description:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",rows:3,placeholder:"Additional information...",disabled:f.isPending})]}),a.jsxs("div",{className:"flex space-x-3 pt-4",children:[a.jsx(ee,{type:"button",variant:"outline",onClick:t,className:"flex-1",disabled:f.isPending,children:"Cancel"}),a.jsx(ee,{type:"submit",className:"flex-1",disabled:f.isPending||!p.name||!p.organization_id||!p.building_id,children:f.isPending?"Saving...":e?"Update":"Create"})]})]})]})})},re=Object.freeze(Object.defineProperty({__proto__:null,LocationsManager:()=>{var e,t;const{user:r}=H(),n=c(),[i,o]=s.useState(!1),[l,w]=s.useState(null),[N,S]=s.useState(""),[_,k]=s.useState(!1),[I,C]=s.useState([]),[L,E]=s.useState(null),{data:z,isLoading:T}=d({queryKey:["locations"],queryFn:async()=>{const{data:e,error:t}=await J.from("locations").select("*").order("created_at",{ascending:!1});if(t)throw t;return e}}),O=null==z?void 0:z.filter(e=>{var t,s;return e.name.toLowerCase().includes(N.toLowerCase())||(null==(t=e.building)?void 0:t.toLowerCase().includes(N.toLowerCase()))||(null==(s=e.code)?void 0:s.toLowerCase().includes(N.toLowerCase()))}),A=u({mutationFn:async e=>{const{error:t}=await J.from("locations").delete().eq("id",e);if(t)throw t},onSuccess:()=>{n.invalidateQueries({queryKey:["locations"]}),j.success("Location deleted")},onError:e=>{j.error(e.message||"Failed to delete")}}),M=e=>`http://localhost:5173/locations/${e}`;return T?a.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):a.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[a.jsx("div",{className:"bg-gradient-to-br from-blue-600 to-blue-400 p-6 rounded-b-3xl shadow-lg",children:a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-bold text-white",children:"Location Management"}),a.jsx("p",{className:"text-blue-100",children:"Manage toilet locations & QR codes"})]}),r&&a.jsxs("div",{className:"hidden sm:flex items-center space-x-2 bg-white/20 px-3 py-2 rounded-lg",children:[a.jsx(m,{className:"w-4 h-4 text-white"}),a.jsx("span",{className:"text-white text-sm font-medium",children:(null==(e=r.user_metadata)?void 0:e.name)||r.email})]})]})}),a.jsxs("div",{className:"p-4 space-y-4",children:[r&&a.jsx(Y,{className:"sm:hidden p-3 bg-blue-50 border-blue-200",children:a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(m,{className:"w-4 h-4 text-blue-600"}),a.jsx("span",{className:"text-blue-900 text-sm font-medium",children:(null==(t=r.user_metadata)?void 0:t.name)||r.email})]})}),a.jsx(Y,{children:a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"relative",children:[a.jsx(x,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),a.jsx("input",{type:"text",placeholder:"Search locations...",value:N,onChange:e=>S(e.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[a.jsxs(ee,{onClick:()=>{w(null),o(!0)},className:"flex items-center justify-center space-x-2",children:[a.jsx(g,{className:"w-5 h-5"}),a.jsx("span",{children:"Add"})]}),a.jsxs(ee,{variant:"outline",onClick:()=>{z&&0!==z.length?(C(z),k(!0)):j.error("No locations available")},className:"flex items-center justify-center space-x-2",children:[a.jsx(h,{className:"w-5 h-5"}),a.jsx("span",{children:"Bulk QR"})]})]})]})}),a.jsx("div",{className:"space-y-3",children:0===(null==O?void 0:O.length)?a.jsx(Y,{children:a.jsxs("div",{className:"text-center py-8 text-gray-500",children:[a.jsx(p,{className:"w-12 h-12 mx-auto mb-2 text-gray-300"}),a.jsx("p",{children:"No locations found"})]})}):null==O?void 0:O.map(e=>a.jsxs(Y,{className:"relative",children:[a.jsxs("div",{className:"pr-10",children:[a.jsxs("div",{className:"flex items-start space-x-3 mb-3",children:[a.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center text-xl flex-shrink-0",children:"ðŸš½"}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("h3",{className:"font-semibold text-gray-900 truncate",children:e.name}),e.code&&a.jsx("span",{className:"inline-block mt-1 px-2 py-0.5 bg-blue-100 text-blue-700 text-xs rounded-full",children:e.code})]})]}),a.jsxs("div",{className:"text-sm text-gray-600 space-y-1 mb-3",children:[e.building&&a.jsxs("p",{className:"truncate",children:["ðŸ¢ ",e.building]}),e.floor&&a.jsxs("p",{className:"truncate",children:["ðŸ“ ",e.floor]}),e.area&&a.jsxs("p",{className:"truncate",children:["ðŸ—ºï¸ ",e.area]})]}),e.created_by&&a.jsxs("div",{className:"text-xs text-gray-500 mb-2",children:["Created by: ",e.created_by===(null==r?void 0:r.id)?"You":e.created_by]}),a.jsxs("details",{className:"text-xs",children:[a.jsx("summary",{className:"text-blue-600 cursor-pointer hover:text-blue-700 font-medium",children:"View URL"}),a.jsx("div",{className:"mt-2 p-2 bg-gray-50 rounded-lg border border-gray-200",children:a.jsx("p",{className:"text-gray-600 break-all font-mono",children:M(e.id)})})]})]}),a.jsxs("div",{className:"absolute top-4 right-4",children:[a.jsx("button",{onClick:()=>E(L===e.id?null:e.id),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:a.jsx(b,{className:"w-5 h-5 text-gray-600"})}),L===e.id&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>E(null)}),a.jsxs("div",{className:"absolute right-0 top-full mt-2 w-48 bg-white rounded-xl shadow-xl border border-gray-200 z-20 overflow-hidden",children:[a.jsxs("button",{onClick:()=>(e=>{C([e]),k(!0),E(null)})(e),className:"w-full px-4 py-3 text-left hover:bg-gray-50 flex items-center space-x-3 transition-colors",children:[a.jsx(h,{className:"w-5 h-5 text-blue-600"}),a.jsx("span",{className:"text-sm font-medium text-gray-900",children:"Generate QR"})]}),a.jsxs("button",{onClick:()=>(e=>{const t=M(e.id);navigator.clipboard.writeText(t),j.success("URL copied!"),E(null)})(e),className:"w-full px-4 py-3 text-left hover:bg-gray-50 flex items-center space-x-3 transition-colors border-t border-gray-100",children:[a.jsx(f,{className:"w-5 h-5 text-gray-600"}),a.jsx("span",{className:"text-sm font-medium text-gray-900",children:"Copy URL"})]}),a.jsxs("button",{onClick:()=>(e=>{w(e),o(!0),E(null)})(e),className:"w-full px-4 py-3 text-left hover:bg-gray-50 flex items-center space-x-3 transition-colors border-t border-gray-100",children:[a.jsx(v,{className:"w-5 h-5 text-gray-600"}),a.jsx("span",{className:"text-sm font-medium text-gray-900",children:"Edit"})]}),a.jsxs("button",{onClick:()=>(async(e,t)=>{window.confirm(`Delete "${t}"?`)&&(A.mutate(e),E(null))})(e.id,e.name),className:"w-full px-4 py-3 text-left hover:bg-red-50 flex items-center space-x-3 transition-colors border-t border-gray-100",children:[a.jsx(y,{className:"w-5 h-5 text-red-600"}),a.jsx("span",{className:"text-sm font-medium text-red-600",children:"Delete"})]})]})]})]})]},e.id))})]}),i&&a.jsx(ae,{location:l,onClose:()=>{o(!1),w(null)},onSuccess:()=>{n.invalidateQueries({queryKey:["locations"]}),o(!1),w(null)}}),_&&a.jsx(te,{locations:I,onClose:()=>{k(!1),C([])}})]})}},Symbol.toStringTag,{value:"Module"})),ne=({icon:e,title:t,description:s,path:r,color:n="blue",count:i,badge:o})=>{var l;const c=w(),d={blue:"bg-blue-100 text-blue-600",purple:"bg-purple-100 text-purple-600",green:"bg-green-100 text-green-600",orange:"bg-orange-100 text-orange-600",red:"bg-red-100 text-red-600",cyan:"bg-cyan-100 text-cyan-600"};return a.jsxs("button",{onClick:()=>c(r),className:"\n        relative w-full p-6 bg-white rounded-2xl shadow-sm border border-gray-100\n        hover:shadow-lg hover:scale-[1.02] active:scale-[0.98]\n        transition-all duration-200\n        text-left group\n      ",children:[o&&a.jsx("div",{className:"absolute top-4 right-4 px-2 py-1 bg-red-500 text-white text-xs font-bold rounded-full",children:o}),a.jsx("div",{className:`\n        w-14 h-14 ${d[n]||d.blue} \n        rounded-2xl flex items-center justify-center mb-4\n        group-hover:scale-110 transition-transform\n      `,children:a.jsx(e,{className:"w-7 h-7"})}),a.jsxs("div",{className:"mb-4",children:[a.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-1",children:t}),a.jsx("p",{className:"text-sm text-gray-600",children:s})]}),a.jsxs("div",{className:"flex items-center justify-between",children:[void 0!==i&&a.jsx("div",{className:"text-2xl font-bold text-gray-900",children:i}),a.jsxs("div",{className:`\n          ml-auto flex items-center gap-1 text-sm font-medium\n          ${(null==(l=d[n])?void 0:l.split(" ")[1])||"text-blue-600"}\n          group-hover:gap-2 transition-all\n        `,children:[a.jsx("span",{children:"Manage"}),a.jsx(N,{className:"w-4 h-4"})]})]})]})},ie=Object.freeze(Object.defineProperty({__proto__:null,AdminDashboard:()=>{var e;e="HomePage",s.useEffect(()=>{const t=performance.now();return $.debug(`Component mounted: ${e}`),()=>{const s=performance.now()-t;$.debug(`Component unmounted: ${e}`,{lifetime:`${s.toFixed(2)}ms`})}},[e]),s.useEffect(()=>{if("undefined"==typeof window)return;const e=()=>{const e=performance.getEntriesByType("navigation")[0];if(e){const t={dns:e.domainLookupEnd-e.domainLookupStart,tcp:e.connectEnd-e.connectStart,ttfb:e.responseStart-e.requestStart,download:e.responseEnd-e.responseStart,domParse:e.domInteractive-e.responseEnd,domReady:e.domContentLoadedEventEnd-e.domContentLoadedEventStart,onload:e.loadEventEnd-e.loadEventStart,total:e.loadEventEnd-e.fetchStart};$.info("Page performance",{url:window.location.pathname,metrics:Object.entries(t).map(([e,t])=>`${e}: ${t.toFixed(2)}ms`).join(", "),slowPage:t.total>3e3}),t.ttfb>800&&$.warn("Slow Time To First Byte (TTFB)",{ttfb:`${t.ttfb.toFixed(2)}ms`,threshold:"800ms"}),t.total>3e3&&$.warn("Slow page load",{total:`${t.total.toFixed(2)}ms`,threshold:"3000ms"})}};if("complete"!==document.readyState)return window.addEventListener("load",e),()=>window.removeEventListener("load",e);e()},[]);const{profile:t}=H(),r=w(),{data:n,isLoading:i}=d({queryKey:["admin-stats"],queryFn:async()=>{const e=R(new Date,"yyyy-MM-dd"),t=R(U(new Date,1),"yyyy-MM-dd"),s=R(U(new Date,7),"yyyy-MM-dd"),{count:a}=await J.from("users").select("*",{count:"exact",head:!0}).eq("is_active",!0),{count:r}=await J.from("locations").select("*",{count:"exact",head:!0}).eq("is_active",!0),{count:n}=await J.from("inspection_records").select("*",{count:"exact",head:!0}),{count:i}=await J.from("inspection_records").select("*",{count:"exact",head:!0}).eq("inspection_date",e),{count:o}=await J.from("inspection_records").select("*",{count:"exact",head:!0}).eq("inspection_date",t),{count:l}=await J.from("users").select("*",{count:"exact",head:!0}).gte("last_login_at",s).eq("is_active",!0),{data:c}=await J.from("inspection_records").select("responses").limit(100);return{totalUsers:a||0,totalLocations:r||0,totalInspections:n||0,todayInspections:i||0,activeUsers:l||0,avgScore:c&&c.length>0?Math.round(c.reduce((e,t)=>e+(e=>{const t=Object.values(e||{});if(0===t.length)return 0;const s=t.filter(e=>!0===e||"good"===e||"excellent"===e||"baik"===e||"bersih"===e||"ada"===e).length;return Math.round(s/t.length*100)})(t.responses),0)/c.length):0,userGrowth:0,inspectionGrowth:o&&o>0?Math.round(((i||0)-o)/o*100):0}}});return i?a.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):a.jsxs("div",{className:"min-h-screen bg-gray-50 pb-8",children:[a.jsxs("div",{className:"bg-gradient-to-br from-purple-600 via-purple-500 to-pink-500 p-6 rounded-b-3xl shadow-lg",children:[a.jsxs("div",{className:"flex items-center justify-between text-white mb-6",children:[a.jsx("button",{onClick:()=>r(-1),className:"p-2 hover:bg-white/10 rounded-xl transition-colors",children:a.jsx(S,{className:"w-6 h-6"})}),a.jsx("button",{onClick:()=>r("/profile"),className:"p-2 hover:bg-white/10 rounded-xl transition-colors",children:a.jsx(_,{className:"w-6 h-6"})})]}),a.jsxs("div",{className:"flex items-center gap-3 text-white mb-2",children:[a.jsx("div",{className:"w-12 h-12 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center",children:a.jsx(k,{className:"w-7 h-7"})}),a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-bold",children:"Admin Dashboard"}),a.jsxs("p",{className:"text-purple-100",children:["Welcome back, ",null==t?void 0:t.full_name,"!"]})]})]})]}),a.jsxs("div",{className:"px-6 -mt-8",children:[a.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-6",children:[a.jsxs(Y,{className:"p-4 bg-gradient-to-br from-blue-50 to-cyan-50 border-blue-100",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center",children:a.jsx(I,{className:"w-5 h-5 text-blue-600"})}),n&&0!==n.inspectionGrowth&&a.jsxs("div",{className:"flex items-center gap-1 text-xs font-medium "+(n.inspectionGrowth>0?"text-green-600":"text-red-600"),children:[n.inspectionGrowth>0?a.jsx(C,{className:"w-3 h-3"}):a.jsx(L,{className:"w-3 h-3"}),a.jsxs("span",{children:[Math.abs(n.inspectionGrowth),"%"]})]})]}),a.jsx("div",{className:"text-2xl font-bold text-gray-900",children:(null==n?void 0:n.todayInspections)||0}),a.jsx("div",{className:"text-xs text-gray-600",children:"Today's Inspections"})]}),a.jsxs(Y,{className:"p-4 bg-gradient-to-br from-green-50 to-emerald-50 border-green-100",children:[a.jsx("div",{className:"flex items-center justify-between mb-2",children:a.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-xl flex items-center justify-center",children:a.jsx(E,{className:"w-5 h-5 text-green-600"})})}),a.jsx("div",{className:"text-2xl font-bold text-gray-900",children:(null==n?void 0:n.avgScore)||0}),a.jsx("div",{className:"text-xs text-gray-600",children:"Average Score"})]}),a.jsxs(Y,{className:"p-4 bg-gradient-to-br from-purple-50 to-pink-50 border-purple-100",children:[a.jsx("div",{className:"flex items-center justify-between mb-2",children:a.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-xl flex items-center justify-center",children:a.jsx(z,{className:"w-5 h-5 text-purple-600"})})}),a.jsx("div",{className:"text-2xl font-bold text-gray-900",children:(null==n?void 0:n.totalUsers)||0}),a.jsx("div",{className:"text-xs text-gray-600",children:"Total Users"})]}),a.jsxs(Y,{className:"p-4 bg-gradient-to-br from-orange-50 to-amber-50 border-orange-100",children:[a.jsx("div",{className:"flex items-center justify-between mb-2",children:a.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-xl flex items-center justify-center",children:a.jsx(I,{className:"w-5 h-5 text-orange-600"})})}),a.jsx("div",{className:"text-2xl font-bold text-gray-900",children:(null==n?void 0:n.activeUsers)||0}),a.jsx("div",{className:"text-xs text-gray-600",children:"Active Users (7d)"})]})]}),a.jsxs("div",{className:"mb-6",children:[a.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-3",children:"Management"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsx(ne,{icon:z,title:"User Management",description:"Manage users, roles, and permissions",path:"/admin/users",color:"blue",count:null==n?void 0:n.totalUsers}),a.jsx(ne,{icon:p,title:"Locations",description:"Manage toilet locations and QR codes",path:"/admin/locations",color:"green",count:null==n?void 0:n.totalLocations}),a.jsx(ne,{icon:T,title:"Occupations",description:"Manage job titles and roles",path:"/admin/occupations",color:"purple"}),a.jsx(ne,{icon:O,title:"Organizations",description:"Manage buildings and organizations",path:"/admin/organizations",color:"cyan"}),a.jsx(ne,{icon:A,title:"Templates",description:"Manage inspection templates",path:"/admin/templates",color:"orange"}),a.jsx(ne,{icon:E,title:"Reports",description:"View detailed analytics and reports",path:"/admin/reports",color:"red",count:null==n?void 0:n.totalInspections})]})]}),a.jsxs(Y,{children:[a.jsx(Z,{title:"System Overview",subtitle:"Key metrics at a glance",icon:a.jsx(I,{className:"w-5 h-5 text-blue-600"})}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-xl",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(A,{className:"w-5 h-5 text-gray-500"}),a.jsx("span",{className:"text-sm font-medium text-gray-900",children:"Total Inspections"})]}),a.jsx("span",{className:"text-lg font-bold text-gray-900",children:(null==n?void 0:n.totalInspections)||0})]}),a.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-xl",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(p,{className:"w-5 h-5 text-gray-500"}),a.jsx("span",{className:"text-sm font-medium text-gray-900",children:"Active Locations"})]}),a.jsx("span",{className:"text-lg font-bold text-gray-900",children:(null==n?void 0:n.totalLocations)||0})]}),a.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-xl",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(M,{className:"w-5 h-5 text-gray-500"}),a.jsx("span",{className:"text-sm font-medium text-gray-900",children:"Today's Activity"})]}),a.jsx("span",{className:"text-lg font-bold text-gray-900",children:(null==n?void 0:n.todayInspections)||0})]})]})]})]})]})}},Symbol.toStringTag,{value:"Module"}));export{ie as A,Y as C,re as L,se as Q,Z as a,W as b,$ as l,J as s,H as u};
