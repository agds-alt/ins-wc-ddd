import{f as e,H as s,j as t,J as n,t as a,d as r,p as l,U as i,X as o,M as c,F as d,K as x,a as m,N as h,g as u,r as g,x as p,y as b,v as f,O as j,m as y,R as v,V as N,o as w,k as _,D as M}from"./react-vendor-B_wON18L.js";import{u as k,s as C,C as S,a as A}from"./admin-DxXcpQLf.js";import{c as I,g as D,I as R}from"./inspection-Bd6L4SDO.js";import{f as E,a as P,e as F,b as O,i as T,c as q,d as z,g as $,s as L,h as Y}from"./date-vendor-DWqTPjCA.js";import{c as H}from"./vendor-C4HD8sBH.js";const W=[{id:"home",icon:n,label:"Home",path:"/"},{id:"history",icon:a,label:"History",path:"/history"},{id:"scan",icon:r,label:"Scan",path:"/scan",isCenter:!0},{id:"analytics",icon:l,label:"Analytics",path:"/analytics"},{id:"profile",icon:i,label:"Profile",path:"/profile"}],G=()=>{const n=e(),a=s();return t.jsx("nav",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 z-50 safe-area-bottom",children:t.jsx("div",{className:"flex items-center justify-around relative px-2 pt-2 pb-2",children:W.map(e=>{const s=e.icon,r=a.pathname===e.path||"/"!==e.path&&a.pathname.startsWith(e.path);return e.isCenter?t.jsx("div",{className:"flex-1 flex justify-center",children:t.jsx("button",{onClick:()=>n(e.path),className:"\n                    w-14 h-14 \n                    bg-gradient-to-br from-blue-600 to-blue-400\n                    rounded-full \n                    flex items-center justify-center \n                    text-white \n                    shadow-lg shadow-blue-600/30\n                    -mt-6\n                    transition-all duration-200\n                    active:scale-90\n                    hover:shadow-xl hover:shadow-blue-600/40\n                  ","aria-label":e.label,children:t.jsx(s,{className:"w-7 h-7",strokeWidth:2.5})})},e.id):t.jsxs("button",{onClick:()=>n(e.path),className:H("flex-1 flex flex-col items-center justify-center gap-1 py-2 px-2 rounded-xl transition-all duration-200",r?"text-blue-600":"text-gray-500 hover:text-gray-700 active:scale-95"),"aria-label":e.label,children:[t.jsxs("div",{className:H("relative",r&&"scale-110"),children:[t.jsx(s,{className:"w-6 h-6",strokeWidth:r?2.5:2}),r&&t.jsx("div",{className:"absolute -bottom-1 left-1/2 transform -translate-x-1/2 w-1 h-1 bg-blue-600 rounded-full"})]}),t.jsx("span",{className:H("text-[11px] font-medium",r?"text-blue-600":"text-gray-600"),children:e.label})]},e.id)})})})},U=({isOpen:a,onClose:l})=>{var m;const h=e(),u=s(),{profile:g,signOut:p}=k(),b=[{icon:n,label:"Dashboard",path:"/"},{icon:r,label:"Scan QR",path:"/scan"},{icon:c,label:"Locations",path:"/locations",description:"Manual inspection"},{icon:d,label:"Reports",path:"/reports"},{icon:i,label:"Profile",path:"/profile"}];return a?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 transition-opacity",onClick:l}),t.jsxs("div",{className:"fixed inset-y-0 left-0 w-80 bg-white z-50 shadow-2xl transform transition-transform",children:[t.jsxs("div",{className:"bg-white border-b border-gray-100 p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Menu"}),t.jsx("button",{onClick:l,className:"p-2 hover:bg-gray-100 rounded-xl transition-colors",children:t.jsx(o,{className:"w-6 h-6 text-gray-600"})})]}),g&&t.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-xl",children:[t.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center",children:t.jsx("span",{className:"text-lg font-bold text-white",children:(null==(m=g.full_name)?void 0:m.charAt(0).toUpperCase())||"U"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"font-semibold text-gray-900 truncate",children:g.full_name}),t.jsx("div",{className:"text-xs text-gray-500 truncate",children:g.email})]})]})]}),t.jsx("div",{className:"p-4 space-y-1 overflow-y-auto max-h-[calc(100vh-280px)]",children:b.map(e=>{const s=e.icon,n=(a=e.path,u.pathname===a);var a;return t.jsxs("button",{onClick:()=>(e=>{h(e),l()})(e.path),className:`\n                  w-full flex items-center gap-3 p-4 rounded-xl transition-all\n                  ${n?"bg-blue-50 text-blue-600 shadow-sm":"text-gray-700 hover:bg-gray-50"}\n                `,children:[t.jsx(s,{className:"w-5 h-5 "+(n?"text-blue-600":"text-gray-400")}),t.jsxs("div",{className:"flex-1 text-left",children:[t.jsx("div",{className:"font-medium",children:e.label}),e.description&&t.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:e.description})]})]},e.path)})}),t.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-4 bg-white border-t border-gray-100",children:t.jsxs("button",{onClick:async()=>{window.confirm("Are you sure you want to logout?")&&(await p(),h("/login"),l())},className:"w-full flex items-center justify-center gap-2 p-4 bg-white shadow-md border border-gray-100 rounded-xl font-medium text-red-600 hover:bg-red-50 transition-colors",children:[t.jsx(x,{className:"w-5 h-5"}),t.jsx("span",{children:"Logout"})]})})]})]}):null},K=(e,s)=>m({queryKey:["monthly-inspections",e,E(s,"yyyy-MM")],queryFn:async()=>{if(!e)return[];const t=E(P(s),"yyyy-MM-dd"),n=E(F(s),"yyyy-MM-dd"),{data:a,error:r}=await C.from("inspection_records").select("\n          id,\n          inspection_date,\n          inspection_time,\n          overall_status,\n          responses,\n          photo_urls,\n          notes,\n          location:locations!inner(id, name, building, floor),\n          user:users!inspection_records_user_id_fkey(id, full_name)\n        ").eq("user_id",e).gte("inspection_date",t).lte("inspection_date",n).order("inspection_date",{ascending:!1}).order("inspection_time",{ascending:!1});if(r)throw r;const l=(a||[]).reduce((e,s)=>{const t=s.inspection_date;return e[t]||(e[t]=[]),e[t].push({id:s.id,inspection_date:s.inspection_date,inspection_time:s.inspection_time,overall_status:s.overall_status,responses:s.responses,location:s.location,user:s.user,photo_urls:s.photo_urls||[],notes:s.notes}),e},{});return Object.entries(l).map(([e,s])=>{const t=s.map(e=>(e=>{if(!e)return 0;if("number"==typeof e.score)return e.score;if(Array.isArray(e.ratings)&&e.ratings.length>0)return I(e.ratings);const s=Object.values(e).filter(e=>"string"==typeof e||"boolean"==typeof e);if(0===s.length)return 0;const t=s.filter(e=>!0===e||"good"===e||"excellent"===e||"baik"===e||"bersih"===e).length;return Math.round(t/s.length*100)})(e.responses));return{date:e,inspections:s,averageScore:t.length>0?Math.round(t.reduce((e,s)=>e+s,0)/t.length):0,count:s.length}})},enabled:!!e}),B=({currentDate:e,onDateChange:s,dateInspections:n,onDateClick:a})=>{const r=P(e),l=F(e),i=O({start:r,end:l}),o=r.getDay(),c=Array(o).fill(null);return t.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100",children:[t.jsxs("div",{className:"p-4 border-b border-gray-100",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("button",{onClick:()=>{s(q(e,1))},className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:t.jsx(h,{className:"w-5 h-5 text-gray-600"})}),t.jsx("h2",{className:"text-lg font-bold text-gray-900",children:E(e,"MMMM yyyy")}),t.jsx("button",{onClick:()=>{s(z(e,1))},className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:t.jsx(u,{className:"w-5 h-5 text-gray-600"})})]}),t.jsx("div",{className:"grid grid-cols-7 gap-1 mt-4",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(e=>t.jsx("div",{className:"text-center text-xs font-medium text-gray-500 py-2",children:e},e))})]}),t.jsx("div",{className:"p-2",children:t.jsxs("div",{className:"grid grid-cols-7 gap-1",children:[c.map((e,s)=>t.jsx("div",{className:"aspect-square"},`empty-${s}`)),i.map(e=>{const s=(e=>{const s=E(e,"yyyy-MM-dd");return n.find(e=>e.date===s)})(e),r=s&&s.count>0,l=T(e),i=E(e,"yyyy-MM-dd");return t.jsxs("button",{onClick:()=>r&&a(i),disabled:!r,className:`\n                  aspect-square p-1 rounded-lg transition-all relative\n                  ${l?"ring-2 ring-blue-500":""}\n                  ${r?"hover:bg-gray-50 cursor-pointer active:scale-95":"cursor-default opacity-40"}\n                `,children:[t.jsx("div",{className:`\n                  text-sm font-medium\n                  ${l?"text-blue-600 font-bold":"text-gray-700"}\n                `,children:E(e,"d")}),r&&t.jsx("div",{className:"absolute bottom-1 left-1/2 transform -translate-x-1/2",children:t.jsx("div",{className:"w-1.5 h-1.5 rounded-full "+(o=s.averageScore,o>=85?"bg-green-500":o>=70?"bg-yellow-500":"bg-red-500")})})]},e.toISOString());var o})]})}),t.jsxs("div",{className:"p-4 border-t border-gray-100 flex items-center justify-center space-x-4 text-xs text-gray-600",children:[t.jsxs("div",{className:"flex items-center space-x-1",children:[t.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500"}),t.jsx("span",{children:"Good (85+)"})]}),t.jsxs("div",{className:"flex items-center space-x-1",children:[t.jsx("div",{className:"w-2 h-2 rounded-full bg-yellow-500"}),t.jsx("span",{children:"Fair (70-84)"})]}),t.jsxs("div",{className:"flex items-center space-x-1",children:[t.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500"}),t.jsx("span",{children:"Poor (<70)"})]})]})]})},Q=({isOpen:e,onClose:s,inspections:n,selectedDate:a,onInspectionClick:r})=>{const[l,i]=g.useState(0),[d,x]=g.useState(0),[m,h]=g.useState(!1);if(g.useEffect(()=>(document.body.style.overflow=e?"hidden":"unset",()=>{document.body.style.overflow="unset"}),[e]),!e)return null;const u=E(new Date(a),"EEEE, MMMM d, yyyy");return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 transition-opacity",onClick:s}),t.jsxs("div",{className:"fixed bottom-0 left-0 right-0 bg-white rounded-t-3xl shadow-2xl z-50 max-h-[80vh] flex flex-col transition-transform",style:{transform:`translateY(${d}px)`},children:[t.jsx("div",{className:"py-3 flex justify-center cursor-grab active:cursor-grabbing",onTouchStart:e=>{i(e.touches[0].clientY),h(!0)},onTouchMove:e=>{if(!m)return;const s=e.touches[0].clientY-l;s>0&&x(s)},onTouchEnd:()=>{h(!1),d>100&&s(),x(0)},children:t.jsx("div",{className:"w-12 h-1.5 bg-gray-300 rounded-full"})}),t.jsx("div",{className:"px-6 pb-4 border-b border-gray-100",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"Inspections"}),t.jsx("p",{className:"text-sm text-gray-600 mt-0.5",children:u}),t.jsx("div",{className:"flex items-center space-x-2 mt-2",children:t.jsxs("span",{className:"px-2 py-1 bg-blue-100 text-blue-700 text-xs font-medium rounded-full",children:[n.length," inspection",n.length>1?"s":""]})})]}),t.jsx("button",{onClick:s,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:t.jsx(o,{className:"w-5 h-5 text-gray-600"})})]})}),t.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-4 space-y-3",children:n.map(e=>{var s;const n=(null==(s=e.responses)?void 0:s.score)||0,a=(e=>e>=85?"bg-green-100 text-green-700 border-green-200":e>=70?"bg-yellow-100 text-yellow-700 border-yellow-200":"bg-red-100 text-red-700 border-red-200")(n),l=(e=>e>=85?"ðŸ˜Š":e>=70?"ðŸ˜":"ðŸ˜Ÿ")(n);return t.jsxs("button",{onClick:()=>r(e),className:"w-full bg-gray-50 rounded-xl p-4 hover:bg-gray-100 transition-colors active:scale-[0.98] text-left",children:[t.jsxs("div",{className:"flex items-start justify-between space-x-3",children:[t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[t.jsx(c,{className:"w-4 h-4 text-blue-600 flex-shrink-0"}),t.jsx("h3",{className:"font-semibold text-gray-900 truncate",children:e.location.name})]}),t.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.location.building&&t.jsxs("p",{className:"truncate",children:["ðŸ¢ ",e.location.building," â€¢ ",e.location.floor]}),t.jsxs("div",{className:"flex items-center space-x-1",children:[t.jsx(p,{className:"w-3.5 h-3.5"}),t.jsx("span",{children:e.inspection_time})]})]}),e.photo_urls.length>0&&t.jsx("div",{className:"mt-2",children:t.jsxs("span",{className:"text-xs text-gray-500",children:["ðŸ“¸ ",e.photo_urls.length," photo",e.photo_urls.length>1?"s":""]})})]}),t.jsxs("div",{className:"flex flex-col items-end flex-shrink-0",children:[t.jsxs("div",{className:`\n                      px-3 py-2 rounded-xl border-2 font-bold\n                      flex items-center space-x-1.5\n                      ${a}\n                    `,children:[t.jsx("span",{className:"text-lg",children:l}),t.jsx("span",{className:"text-xl",children:n})]}),t.jsx("span",{className:"text-xs text-gray-500 mt-1",children:"Score"})]})]}),e.notes&&t.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:t.jsxs("p",{className:"text-sm text-gray-600 line-clamp-2",children:["ðŸ’¬ ",e.notes]})})]},e.id)})})]})]})},J=(e,s)=>{if("aroma"===s)switch(e){case"good":return"ðŸŒ¸";case"normal":return"ðŸ˜";case"bad":return"ðŸ¤¢";case"other":return"ðŸ’¬";default:return"â“"}if("visual"===s)switch(e){case"good":return"âœ¨";case"normal":return"ðŸ˜";case"bad":return"ðŸ’©";case"other":return"ðŸ’¬";default:return"â“"}if("availability"===s||"functional"===s)switch(e){case"good":return"âœ…";case"normal":return"âš ï¸";case"bad":return"âŒ";case"other":return"ðŸ’¬";default:return"â“"}return"â“"},V=e=>{switch(e){case"good":return"bg-green-50 text-green-700 border-green-200";case"normal":return"bg-yellow-50 text-yellow-700 border-yellow-200";case"bad":return"bg-red-50 text-red-700 border-red-200";case"other":return"bg-blue-50 text-blue-700 border-blue-200";default:return"bg-gray-50 text-gray-700 border-gray-200"}},Z=({isOpen:e,onClose:s,inspection:n})=>{var a,r,l,c;if(!e||!n)return null;const x=n.responses,m=(e=>{if(!e)return 0;if("number"==typeof e.score)return e.score;if(Array.isArray(e.ratings)&&e.ratings.length>0)return I(e.ratings);const s=Object.values(e).filter(e=>"string"==typeof e||"boolean"==typeof e);if(0===s.length)return 0;const t=s.filter(e=>!0===e||"good"===e||"excellent"===e||"baik"===e).length;return Math.round(t/s.length*100)})(x),h=D(m),u=(null==x?void 0:x.ratings)||[],g=null==x?void 0:x.issues,j=null==x?void 0:x.maintenance,y=(null==x?void 0:x.inspection_mode)||"professional",v=E(new Date(n.inspection_date),"EEEE, MMMM d, yyyy");return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 backdrop-blur-sm",onClick:s}),t.jsx("div",{className:"fixed inset-x-4 top-1/2 -translate-y-1/2 max-w-2xl mx-auto z-50 max-h-[90vh] overflow-hidden",children:t.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl overflow-hidden",children:[t.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 p-6 text-white relative",children:[t.jsx("button",{onClick:s,className:"absolute top-4 right-4 p-2 hover:bg-white/20 rounded-xl transition-colors",children:t.jsx(o,{className:"w-5 h-5"})}),t.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[t.jsx("div",{className:"w-14 h-14 bg-white/20 rounded-xl flex items-center justify-center text-3xl",children:"ðŸš½"}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold",children:null==(a=n.location)?void 0:a.name}),t.jsxs("p",{className:"text-blue-100 text-sm",children:[null==(r=n.location)?void 0:r.building," â€¢ ",null==(l=n.location)?void 0:l.floor]})]})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:"text-blue-100 text-sm",children:"Inspection Score:"}),t.jsxs("div",{className:"bg-white/90 px-4 py-2 rounded-full",children:[t.jsx("span",{className:"text-2xl font-bold text-blue-600",children:m}),t.jsx("span",{className:"text-sm text-gray-600 ml-1",children:"/ 100"})]})]}),t.jsxs("div",{className:"bg-white/20 px-3 py-1 rounded-full text-sm",children:[h.emoji," ",h.label]})]})]}),t.jsxs("div",{className:"overflow-y-auto max-h-[calc(90vh-200px)] p-6 space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"flex items-center space-x-2 text-gray-600",children:[t.jsx(p,{className:"w-4 h-4"}),t.jsxs("div",{className:"text-sm",children:[t.jsx("p",{className:"font-medium text-gray-900",children:v}),t.jsx("p",{className:"text-xs",children:n.inspection_time})]})]}),t.jsxs("div",{className:"flex items-center space-x-2 text-gray-600",children:[t.jsx(i,{className:"w-4 h-4"}),t.jsxs("div",{className:"text-sm",children:[t.jsx("p",{className:"font-medium text-gray-900",children:null==(c=n.user)?void 0:c.full_name}),t.jsxs("p",{className:"text-xs capitalize",children:[y," mode"]})]})]})]}),t.jsxs("div",{children:[t.jsxs("h3",{className:"font-bold text-gray-900 mb-3 flex items-center space-x-2",children:[t.jsx("span",{children:"ðŸ“‹"}),t.jsx("span",{children:"Component Ratings"})]}),t.jsx("div",{className:"space-y-3",children:u.map((e,s)=>{const n=R.find(s=>s.id===e.component);return n?t.jsx("div",{className:`rounded-xl p-4 border-2 ${V(e.choice)}`,children:t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[t.jsx("span",{className:"text-xl",children:"genz"===y?n.iconGenZ:n.icon}),t.jsx("span",{className:"font-medium text-gray-900",children:n.label})]}),e.notes&&t.jsxs("p",{className:"text-sm text-gray-600 mt-2 pl-7",children:["ðŸ’¬ ",e.notes]})]}),t.jsxs("div",{className:"flex items-center space-x-1 flex-shrink-0 ml-3",children:[t.jsx("span",{className:"text-2xl",children:J(e.choice,n.category)}),t.jsx("span",{className:"text-sm font-medium capitalize",children:e.choice})]})]})},s):null})})]}),g&&t.jsx("div",{className:"bg-orange-50 border-2 border-orange-200 rounded-xl p-4",children:t.jsxs("div",{className:"flex items-start space-x-2",children:[t.jsx(b,{className:"w-5 h-5 text-orange-600 mt-0.5"}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-semibold text-orange-900 mb-1",children:"Issues Found"}),t.jsx("p",{className:"text-sm text-orange-800",children:g.description})]})]})}),j&&j.required&&t.jsx("div",{className:`\n                border-2 rounded-xl p-4\n                ${"urgent"===j.priority?"bg-red-50 border-red-200":"high"===j.priority?"bg-orange-50 border-orange-200":"medium"===j.priority?"bg-yellow-50 border-yellow-200":"bg-blue-50 border-blue-200"}\n              `,children:t.jsxs("div",{className:"flex items-start space-x-2",children:[t.jsx("span",{className:"text-xl",children:"ðŸ”§"}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-semibold text-gray-900 mb-1",children:"Maintenance Required"}),t.jsxs("p",{className:"text-sm text-gray-700",children:["Priority: ",t.jsx("span",{className:"font-semibold capitalize",children:j.priority})]})]})]})}),n.photo_urls&&n.photo_urls.length>0&&t.jsxs("div",{children:[t.jsxs("h3",{className:"font-bold text-gray-900 mb-3 flex items-center space-x-2",children:[t.jsx(f,{className:"w-5 h-5"}),t.jsxs("span",{children:["Photos (",n.photo_urls.length,")"]})]}),t.jsx("div",{className:"grid grid-cols-3 gap-3",children:n.photo_urls.map((e,s)=>t.jsx("a",{href:e,target:"_blank",rel:"noopener noreferrer",className:"aspect-square rounded-xl overflow-hidden hover:opacity-80 transition-opacity",children:t.jsx("img",{src:e,alt:`Photo ${s+1}`,className:"w-full h-full object-cover"})},s))})]}),n.notes&&t.jsx("div",{className:"bg-gray-50 rounded-xl p-4",children:t.jsxs("div",{className:"flex items-start space-x-2",children:[t.jsx(d,{className:"w-5 h-5 text-gray-600 mt-0.5"}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-semibold text-gray-900 mb-1",children:"General Notes"}),t.jsx("p",{className:"text-sm text-gray-700",children:n.notes})]})]})})]})]})})]})},X=Object.freeze(Object.defineProperty({__proto__:null,ReportsPage:()=>{const{user:e}=k(),[s,n]=g.useState(new Date),[r,l]=g.useState(null),[i,o]=g.useState(null),[c,x]=g.useState(!1),{data:h,isLoading:u}=K(null==e?void 0:e.id,s),{data:p}=(b=null==e?void 0:e.id,m({queryKey:["date-inspections",b,f=r||""],queryFn:async()=>{if(!b||!f)return[];const{data:e,error:s}=await C.from("inspection_records").select("\n          id,\n          inspection_date,\n          inspection_time,\n          overall_status,\n          responses,\n          photo_urls,\n          notes,\n          location:locations!inner(id, name, building, floor),\n          user:users!inspection_records_user_id_fkey(id, full_name)\n        ").eq("user_id",b).eq("inspection_date",f).order("inspection_time",{ascending:!1});if(s)throw s;return(e||[]).map(e=>({id:e.id,inspection_date:e.inspection_date,inspection_time:e.inspection_time,overall_status:e.overall_status,responses:e.responses,location:e.location,user:e.user,photo_urls:e.photo_urls||[],notes:e.notes}))},enabled:!!b&&!!f}));var b,f;const v=(null==h?void 0:h.reduce((e,s)=>e+s.count,0))||0,N=h&&h.length>0?Math.round(h.reduce((e,s)=>e+s.averageScore*s.count,0)/v):0;return u?t.jsx("div",{className:"min-h-screen bg-white flex items-center justify-center",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-600 text-sm",children:"Loading reports..."})]})}):t.jsxs("div",{className:"min-h-screen bg-white pb-24",children:[t.jsx(U,{isOpen:c,onClose:()=>x(!1)}),t.jsxs("div",{className:"bg-white p-6 border-b border-gray-100",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("button",{onClick:()=>x(!0),className:"w-10 h-10 bg-white rounded-full flex items-center justify-center shadow-md hover:shadow-lg transition-shadow border border-gray-100",children:t.jsx(j,{className:"w-5 h-5 text-gray-600"})}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Reports"}),t.jsx("p",{className:"text-sm text-gray-500",children:"Inspection history & analytics"})]})]}),t.jsx(a,{className:"w-6 h-6 text-gray-400"})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsxs("div",{className:"bg-white rounded-2xl shadow-[0_8px_30px_rgb(0,0,0,0.08)] border border-gray-50 p-4",children:[t.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[t.jsx(d,{className:"w-4 h-4 text-blue-600"}),t.jsx("span",{className:"text-xs text-gray-500",children:"This Month"})]}),t.jsx("div",{className:"text-2xl font-bold text-gray-900",children:v}),t.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Inspections"})]}),t.jsxs("div",{className:"bg-white rounded-2xl shadow-[0_8px_30px_rgb(0,0,0,0.08)] border border-gray-50 p-4",children:[t.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[t.jsx(y,{className:"w-4 h-4 text-green-600"}),t.jsx("span",{className:"text-xs text-gray-500",children:"Average"})]}),t.jsx("div",{className:"text-2xl font-bold text-gray-900",children:N}),t.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Score"})]})]})]}),t.jsxs("div",{className:"p-4 space-y-4",children:[t.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4",children:t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx("div",{className:"text-2xl",children:"ðŸ’¡"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("p",{className:"text-sm font-medium text-blue-900 mb-1",children:"Tap a date to view inspections"}),t.jsxs("p",{className:"text-xs text-blue-700",children:["Colored dots indicate average scores:",t.jsx("span",{className:"font-semibold",children:" Green"})," (excellent),",t.jsx("span",{className:"font-semibold",children:" Yellow"})," (good),",t.jsx("span",{className:"font-semibold",children:" Red"})," (needs work)"]})]})]})}),t.jsx(B,{currentDate:s,onDateChange:n,dateInspections:h||[],onDateClick:e=>{l(e)}}),(!h||0===h.length)&&t.jsxs("div",{className:"bg-white rounded-xl p-8 text-center",children:[t.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“…"}),t.jsx("h3",{className:"font-bold text-gray-900 mb-2",children:"No inspections yet"}),t.jsx("p",{className:"text-gray-600 text-sm",children:"Start inspecting locations to see them here"})]})]}),t.jsx(Q,{isOpen:!!r,onClose:()=>{l(null)},inspections:p||[],selectedDate:r||"",onInspectionClick:e=>{o(e)}}),t.jsx(Z,{isOpen:!!i,onClose:()=>{o(null)},inspection:i}),t.jsx(G,{})]})}},Symbol.toStringTag,{value:"Module"})),ee=Object.freeze(Object.defineProperty({__proto__:null,AnalyticsPage:()=>{const{user:e}=k(),[s,n]=g.useState("week"),[a,r]=g.useState(!1),[i,o]=g.useState(!1),{data:d,isLoading:x,error:h}=m({queryKey:["analytics",null==e?void 0:e.id,s],queryFn:async()=>{if(!(null==e?void 0:e.id))throw new Error("User not authenticated");const t=new Date;let n,a=E(t,"yyyy-MM-dd");switch(s){case"week":default:n=E($(t),"yyyy-MM-dd");break;case"month":n=E(P(t),"yyyy-MM-dd");break;case"year":n=E(new Date(t.getFullYear(),0,1),"yyyy-MM-dd")}const{data:r,error:l}=await C.from("inspection_records").select("\n          id,\n          inspection_date,\n          inspection_time,\n          responses,\n          location_id,\n          locations (\n            id,\n            name,\n            building,\n            floor\n          )\n        ").eq("user_id",e.id).gte("inspection_date",n).lte("inspection_date",a).order("inspection_date",{ascending:!0});if(l)throw l;const i=e=>{try{if(!e||"object"!=typeof e)return 0;const s=Object.values(e);if(0===s.length)return 0;const t=s.filter(e=>{if("boolean"==typeof e)return e;if("string"==typeof e){const s=e.toLowerCase().trim();return["good","excellent","baik","bersih","ada","yes","true","ok","lengkap"].includes(s)}return"number"==typeof e&&e>0}).length;return Math.round(t/s.length*100)}catch(s){return 0}},o=new Map;null==r||r.forEach(e=>{try{const s=e.inspection_date,t=i(e.responses);o.has(s)||o.set(s,{count:0,totalScore:0});const n=o.get(s);n.count++,n.totalScore+=t}catch(s){}});const c=Array.from(o.entries()).map(([e,s])=>({date:e,count:s.count,avgScore:s.count>0?Math.round(s.totalScore/s.count):0})),d=new Map;null==r||r.forEach(e=>{try{if(e.inspection_time&&"string"==typeof e.inspection_time){const s=e.inspection_time.split(":");if(s.length>0){const e=s[0],t=parseInt(e);!isNaN(t)&&t>=0&&t<=23&&d.set(t,(d.get(t)||0)+1)}}}catch(s){}});const x=Array.from(d.entries()).map(([e,s])=>({hour:e,count:s})).sort((e,s)=>e.hour-s.hour),m=x.length>0?x.reduce((e,s)=>s.count>e.count?s:e):null,h=new Map;null==r||r.forEach(e=>{try{if(!e.locations)return;const s=e.location_id,t=i(e.responses);h.has(s)||h.set(s,{name:e.locations.name||"Unknown Location",building:e.locations.building||void 0,floor:e.locations.floor||void 0,scores:[],count:0});const n=h.get(s);n.scores.push(t),n.count++}catch(s){}});const u=Array.from(h.entries()).map(([e,s])=>{const t=s.scores.length>0?Math.round(s.scores.reduce((e,s)=>e+s,0)/s.scores.length):0,n=s.scores.length>=2?s.scores[s.scores.length-1]-s.scores[0]:0;return{id:e,name:s.name,building:s.building,floor:s.floor,avgScore:t,count:s.count,trend:n}}).sort((e,s)=>s.avgScore-e.avgScore),g={excellent:0,good:0,fair:0,poor:0};null==r||r.forEach(e=>{try{const s=i(e.responses);s>=85?g.excellent++:s>=70?g.good++:s>=50?g.fair++:g.poor++}catch(s){}});const p=(null==r?void 0:r.length)||0,b=p>0?Math.round(r.reduce((e,s)=>e+i(s.responses),0)/p):0;let f,j;try{switch(s){case"week":default:f=E(L($(t),7),"yyyy-MM-dd"),j=E(L(Y(t),7),"yyyy-MM-dd");break;case"month":const e=new Date(t.getFullYear(),t.getMonth()-1,1);f=E(e,"yyyy-MM-dd"),j=E(new Date(e.getFullYear(),e.getMonth()+1,0),"yyyy-MM-dd");break;case"year":f=E(new Date(t.getFullYear()-1,0,1),"yyyy-MM-dd"),j=E(new Date(t.getFullYear()-1,11,31),"yyyy-MM-dd")}const{data:n}=await C.from("inspection_records").select("id, responses").eq("user_id",e.id).gte("inspection_date",f).lte("inspection_date",j),a=(null==n?void 0:n.length)||0,r=a>0?Math.round(n.reduce((e,s)=>e+i(s.responses),0)/a):0;return{totalInspections:p,avgScore:b,scoreChange:b-r,countChange:p-a,dailyTrend:c,hourlyDistribution:x,peakHour:m,locationPerformance:u,scoreRanges:g,topPerformer:u[0]||null,needsAttention:u.filter(e=>e.avgScore<70)}}catch(y){return{totalInspections:p,avgScore:b,scoreChange:0,countChange:0,dailyTrend:c,hourlyDistribution:x,peakHour:m,locationPerformance:u,scoreRanges:g,topPerformer:u[0]||null,needsAttention:u.filter(e=>e.avgScore<70)}}},enabled:!!(null==e?void 0:e.id),retry:2,staleTime:3e5}),u={week:"This Week",month:"This Month",year:"This Year"};return h?t.jsx("div",{className:"min-h-screen bg-white flex items-center justify-center p-4",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:t.jsx(v,{className:"w-8 h-8 text-red-600"})}),t.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:"Failed to Load Analytics"}),t.jsx("p",{className:"text-gray-600 mb-4",children:h instanceof Error?h.message:"An unexpected error occurred"}),t.jsx("button",{onClick:()=>window.location.reload(),className:"px-6 py-3 bg-blue-600 text-white rounded-xl font-medium hover:bg-blue-700 transition-colors",children:"Retry"})]})}):x?t.jsx("div",{className:"min-h-screen bg-white flex items-center justify-center",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-600 text-sm",children:"Loading analytics..."})]})}):t.jsxs("div",{className:"min-h-screen bg-white pb-24",children:[t.jsx(U,{isOpen:i,onClose:()=>o(!1)}),t.jsxs("div",{className:"bg-white p-6 border-b border-gray-100",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("button",{onClick:()=>o(!0),className:"w-10 h-10 bg-white rounded-full flex items-center justify-center shadow-md hover:shadow-lg transition-shadow border border-gray-100",children:t.jsx(j,{className:"w-5 h-5 text-gray-600"})}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Analytics"}),t.jsx("p",{className:"text-sm text-gray-500",children:"Performance insights & trends"})]})]}),t.jsx(l,{className:"w-6 h-6 text-gray-400"})]}),t.jsxs("div",{className:"relative",children:[t.jsxs("button",{onClick:()=>r(!a),className:"w-full bg-white shadow-md border border-gray-100 rounded-xl px-4 py-3 flex items-center justify-between text-gray-900 font-medium hover:shadow-lg transition-shadow",children:[t.jsx("span",{children:u[s]}),t.jsx(N,{className:"w-5 h-5 transition-transform "+(a?"rotate-180":"")})]}),a&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>r(!1)}),t.jsx("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white rounded-xl shadow-xl border border-gray-200 overflow-hidden z-20",children:["week","month","year"].map(e=>t.jsx("button",{onClick:()=>{n(e),r(!1)},className:`\n                      w-full px-4 py-3 text-left hover:bg-gray-50 transition-colors\n                      ${s===e?"bg-blue-50 text-blue-600 font-medium":"text-gray-900"}\n                    `,children:u[e]},e))})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-4",children:[t.jsxs("div",{className:"bg-white/15 backdrop-blur-sm rounded-2xl p-4 border border-white/20",children:[t.jsx("div",{className:"text-white/80 text-xs mb-1",children:"Total Inspections"}),t.jsxs("div",{className:"flex items-end gap-2",children:[t.jsx("span",{className:"text-3xl font-bold text-white",children:(null==d?void 0:d.totalInspections)||0}),d&&0!==d.countChange&&t.jsxs("span",{className:"text-sm flex items-center gap-1 mb-1 "+(d.countChange>0?"text-green-300":"text-red-300"),children:[d.countChange>0?t.jsx(y,{className:"w-3 h-3"}):t.jsx(w,{className:"w-3 h-3"}),Math.abs(d.countChange)]})]})]}),t.jsxs("div",{className:"bg-white/15 backdrop-blur-sm rounded-2xl p-4 border border-white/20",children:[t.jsx("div",{className:"text-white/80 text-xs mb-1",children:"Average Score"}),t.jsxs("div",{className:"flex items-end gap-2",children:[t.jsx("span",{className:"text-3xl font-bold text-white",children:(null==d?void 0:d.avgScore)||0}),d&&0!==d.scoreChange&&t.jsxs("span",{className:"text-sm flex items-center gap-1 mb-1 "+(d.scoreChange>0?"text-green-300":"text-red-300"),children:[d.scoreChange>0?t.jsx(y,{className:"w-3 h-3"}):t.jsx(w,{className:"w-3 h-3"}),Math.abs(d.scoreChange)]})]})]})]})]}),t.jsxs("div",{className:"p-4 space-y-4",children:[t.jsxs(S,{children:[t.jsx(A,{title:"Score Distribution",subtitle:"Quality breakdown",icon:t.jsx(_,{className:"w-5 h-5 text-purple-600"})}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Excellent (85-100)"}),t.jsx("span",{className:"text-sm font-bold text-green-600",children:(null==d?void 0:d.scoreRanges.excellent)||0})]}),t.jsx("div",{className:"h-3 bg-gray-100 rounded-full overflow-hidden",children:t.jsx("div",{className:"h-full bg-gradient-to-r from-green-500 to-green-400 rounded-full transition-all duration-500",style:{width:(null==d?void 0:d.totalInspections)?d.scoreRanges.excellent/d.totalInspections*100+"%":"0%"}})})]}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Good (70-84)"}),t.jsx("span",{className:"text-sm font-bold text-yellow-600",children:(null==d?void 0:d.scoreRanges.good)||0})]}),t.jsx("div",{className:"h-3 bg-gray-100 rounded-full overflow-hidden",children:t.jsx("div",{className:"h-full bg-gradient-to-r from-yellow-500 to-yellow-400 rounded-full transition-all duration-500",style:{width:(null==d?void 0:d.totalInspections)?d.scoreRanges.good/d.totalInspections*100+"%":"0%"}})})]}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Fair (50-69)"}),t.jsx("span",{className:"text-sm font-bold text-orange-600",children:(null==d?void 0:d.scoreRanges.fair)||0})]}),t.jsx("div",{className:"h-3 bg-gray-100 rounded-full overflow-hidden",children:t.jsx("div",{className:"h-full bg-gradient-to-r from-orange-500 to-orange-400 rounded-full transition-all duration-500",style:{width:(null==d?void 0:d.totalInspections)?d.scoreRanges.fair/d.totalInspections*100+"%":"0%"}})})]}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Needs Work (0-49)"}),t.jsx("span",{className:"text-sm font-bold text-red-600",children:(null==d?void 0:d.scoreRanges.poor)||0})]}),t.jsx("div",{className:"h-3 bg-gray-100 rounded-full overflow-hidden",children:t.jsx("div",{className:"h-full bg-gradient-to-r from-red-500 to-red-400 rounded-full transition-all duration-500",style:{width:(null==d?void 0:d.totalInspections)?d.scoreRanges.poor/d.totalInspections*100+"%":"0%"}})})]})]})]}),(null==d?void 0:d.peakHour)&&t.jsxs(S,{children:[t.jsx(A,{title:"Peak Inspection Hour",subtitle:"Most active time",icon:t.jsx(p,{className:"w-5 h-5 text-blue-600"})}),t.jsxs("div",{className:"flex items-center justify-between p-4 bg-blue-50 rounded-xl",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"Busiest at"}),t.jsxs("div",{className:"text-3xl font-bold text-blue-600",children:[d.peakHour.hour.toString().padStart(2,"0"),":00"]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"Total checks"}),t.jsx("div",{className:"text-2xl font-bold text-gray-900",children:d.peakHour.count})]})]})]}),t.jsxs(S,{children:[t.jsx(A,{title:"Location Rankings",subtitle:"Performance by location",icon:t.jsx(c,{className:"w-5 h-5 text-purple-600"})}),t.jsxs("div",{className:"space-y-2",children:[null==d?void 0:d.locationPerformance.slice(0,10).map((e,s)=>t.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-xl hover:bg-gray-100 transition-colors",children:[t.jsxs("div",{className:`\n                  w-8 h-8 rounded-lg flex items-center justify-center font-bold text-sm flex-shrink-0\n                  ${0===s?"bg-yellow-100 text-yellow-600":1===s?"bg-gray-100 text-gray-600":2===s?"bg-orange-100 text-orange-600":"bg-gray-50 text-gray-500"}\n                `,children:["#",s+1]}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"font-medium text-gray-900 truncate",children:e.name}),t.jsxs("div",{className:"text-xs text-gray-500",children:[e.count," inspections"]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"text-lg font-bold text-gray-900",children:e.avgScore}),0!==e.trend&&t.jsxs("div",{className:"text-xs flex items-center gap-0.5 "+(e.trend>0?"text-green-600":"text-red-600"),children:[e.trend>0?"â†‘":"â†“"," ",Math.abs(e.trend)]})]})]},e.id)),!(null==d?void 0:d.locationPerformance.length)&&t.jsx("p",{className:"text-center text-gray-500 py-8",children:"No location data available"})]})]}),(null==d?void 0:d.needsAttention)&&d.needsAttention.length>0&&t.jsxs(S,{children:[t.jsx(A,{title:"Needs Attention",subtitle:"Locations below 70 score",icon:t.jsx(v,{className:"w-5 h-5 text-red-600"})}),t.jsx("div",{className:"space-y-2",children:d.needsAttention.map(e=>t.jsxs("div",{className:"flex items-center gap-3 p-3 bg-red-50 rounded-xl border border-red-100",children:[t.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center flex-shrink-0",children:t.jsx(v,{className:"w-5 h-5 text-red-600"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"font-medium text-gray-900 truncate",children:e.name}),t.jsxs("div",{className:"text-xs text-gray-500",children:[e.building&&`${e.building} â€¢ `,e.floor]})]}),t.jsx("div",{className:"text-xl font-bold text-red-600",children:e.avgScore})]},e.id))})]}),t.jsxs("button",{onClick:()=>alert("Export feature coming soon!"),className:"w-full flex items-center justify-center gap-2 p-4 bg-white border-2 border-gray-200 rounded-2xl font-medium text-gray-900 hover:bg-gray-50 transition-colors active:scale-95",children:[t.jsx(M,{className:"w-5 h-5"}),t.jsx("span",{children:"Export Analytics Report"})]})]}),t.jsx(G,{})]})}},Symbol.toStringTag,{value:"Module"}));export{ee as A,G as B,X as R,U as S};
