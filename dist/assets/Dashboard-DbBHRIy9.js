import{f as e,r as s,a as t,j as r,O as a,U as l,d as n,g as i,M as d,t as o,z as c,x}from"./react-vendor-BYw-DaJy.js";import{u as m,s as h}from"./admin-qdYEAokf.js";import{S as g,B as p}from"./reports-MWgRG4S9.js";import"./vendor-BhGL79_Y.js";import"./supabase-vendor-BBQbdcgC.js";import"./date-vendor-cDx4sJEp.js";import"./inspection-CUNmxaai.js";const u=()=>{var u;const{user:b,profile:j,loading:y}=m(),w=e(),[f,N]=s.useState(!1),v=!y&&!!(null==b?void 0:b.id),{data:_,isLoading:C,error:k}=t({queryKey:["dashboard-stats",null==b?void 0:b.id],queryFn:async()=>{if(!(null==b?void 0:b.id))return null;const{data:e,error:s}=await h.from("inspection_records").select("id, overall_status, inspection_date, responses").eq("user_id",b.id).order("inspection_date",{ascending:!1}).limit(50);if(s)throw s;const t=(null==e?void 0:e.length)||0,r=new Date,a=r.toISOString().split("T")[0];new Date(r.getFullYear(),r.getMonth(),r.getDate());return{total:t,todayCount:(null==e?void 0:e.filter(e=>{if(!e.inspection_date)return!1;if(e.inspection_date===a)return!0;if(e.inspection_date.startsWith(a))return!0;try{const s=new Date(e.inspection_date);return s.getFullYear()===r.getFullYear()&&s.getMonth()===r.getMonth()&&s.getDate()===r.getDate()}catch{return!1}}).length)||0,completed:(null==e?void 0:e.filter(e=>{var s;return"completed"===e.overall_status||"excellent"===e.overall_status||"good"===e.overall_status||(null==(s=e.responses)?void 0:s.score)&&e.responses.score>=60}).length)||0,recent:(null==e?void 0:e.slice(0,3))||[]}},enabled:v,staleTime:12e4,gcTime:3e5,refetchOnMount:"always",refetchOnWindowFocus:!1,retry:1});if(y)return r.jsx("div",{className:"min-h-screen bg-white flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),r.jsx("p",{className:"text-gray-600 text-sm",children:"Loading..."})]})});if(!b)return w("/login",{replace:!0}),null;const D=_||{total:0,todayCount:0,completed:0,recent:[]};return r.jsxs("div",{className:"min-h-screen bg-white pb-20",children:[r.jsx(g,{isOpen:f,onClose:()=>N(!1)}),r.jsx("div",{className:"bg-white p-6 border-b border-gray-100",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("button",{onClick:()=>N(!0),className:"w-10 h-10 bg-white rounded-full flex items-center justify-center shadow-md hover:shadow-lg transition-shadow border border-gray-100",children:r.jsx(a,{className:"w-5 h-5 text-gray-600"})}),r.jsxs("div",{children:[r.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"WC Check"}),r.jsxs("p",{className:"text-sm text-gray-500",children:["Hi, ",(null==j?void 0:j.full_name)||(null==(u=null==b?void 0:b.email)?void 0:u.split("@")[0])||"User"]})]})]}),r.jsx("button",{onClick:()=>w("/profile"),className:"w-10 h-10 bg-white rounded-full flex items-center justify-center shadow-md hover:shadow-lg transition-shadow border border-gray-100",children:r.jsx(l,{className:"w-5 h-5 text-gray-600"})})]})}),r.jsxs("main",{className:"p-5 space-y-5",children:[r.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[r.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-[0_8px_30px_rgb(0,0,0,0.08)] border border-gray-50",children:[r.jsx("p",{className:"text-3xl font-bold text-gray-900",children:D.total}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Total"})]}),r.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-[0_8px_30px_rgb(0,0,0,0.08)] border border-gray-50",children:[r.jsx("p",{className:"text-3xl font-bold text-blue-600",children:D.todayCount}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Today"})]}),r.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-[0_8px_30px_rgb(0,0,0,0.08)] border border-gray-50",children:[r.jsx("p",{className:"text-3xl font-bold text-green-600",children:D.completed}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Done"})]})]}),r.jsx("button",{onClick:()=>w("/scan"),type:"button",className:"w-full bg-white rounded-3xl p-6 shadow-[0_12px_40px_rgb(0,0,0,0.12)] active:shadow-[0_8px_30px_rgb(0,0,0,0.1)] active:translate-y-1 transition-all border border-gray-100",children:r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx("div",{className:"w-16 h-16 bg-blue-600 rounded-2xl flex items-center justify-center shadow-lg",children:r.jsx(n,{className:"w-8 h-8 text-white"})}),r.jsxs("div",{className:"flex-1 text-left",children:[r.jsx("p",{className:"font-bold text-lg text-gray-900",children:"Scan QR Code"}),r.jsx("p",{className:"text-gray-500 text-sm",children:"Start new inspection"})]}),r.jsx(i,{className:"w-6 h-6 text-gray-400"})]})}),r.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[r.jsxs("button",{onClick:()=>w("/locations"),className:"bg-white rounded-2xl p-5 shadow-[0_8px_30px_rgb(0,0,0,0.08)] active:shadow-[0_4px_20px_rgb(0,0,0,0.06)] active:translate-y-1 transition-all border border-gray-50",children:[r.jsx(d,{className:"w-7 h-7 text-blue-600 mb-3"}),r.jsx("p",{className:"font-semibold text-gray-900 text-sm",children:"Locations"})]}),r.jsxs("button",{onClick:()=>w("/reports"),className:"bg-white rounded-2xl p-5 shadow-[0_8px_30px_rgb(0,0,0,0.08)] active:shadow-[0_4px_20px_rgb(0,0,0,0.06)] active:translate-y-1 transition-all border border-gray-50",children:[r.jsx(o,{className:"w-7 h-7 text-blue-600 mb-3"}),r.jsx("p",{className:"font-semibold text-gray-900 text-sm",children:"Reports"})]})]}),D.recent&&D.recent.length>0&&r.jsxs("div",{className:"bg-white rounded-2xl shadow-[0_8px_30px_rgb(0,0,0,0.08)] border border-gray-50 p-5",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("h2",{className:"font-bold text-gray-900",children:"Recent"}),r.jsx("button",{onClick:()=>w("/reports"),className:"text-blue-600 text-sm font-medium",children:"View All"})]}),r.jsx("div",{className:"space-y-3",children:D.recent.slice(0,3).map(e=>r.jsx("div",{className:"flex items-center justify-between",children:r.jsxs("div",{className:"flex items-center gap-3",children:["completed"===e.overall_status||"excellent"===e.overall_status||"good"===e.overall_status?r.jsx("div",{className:"w-10 h-10 bg-green-50 rounded-xl flex items-center justify-center",children:r.jsx(c,{className:"w-5 h-5 text-green-600"})}):r.jsx("div",{className:"w-10 h-10 bg-gray-50 rounded-xl flex items-center justify-center",children:r.jsx(x,{className:"w-5 h-5 text-gray-400"})}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Inspection"}),r.jsx("p",{className:"text-xs text-gray-500",children:e.inspection_date})]})]})},e.id))})]}),0===D.total&&r.jsxs("div",{className:"text-center py-12 bg-white rounded-2xl shadow-[0_8px_30px_rgb(0,0,0,0.08)] border border-gray-50",children:[r.jsx("div",{className:"w-20 h-20 bg-gray-50 rounded-full flex items-center justify-center mx-auto mb-4",children:r.jsx(n,{className:"w-10 h-10 text-gray-300"})}),r.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:"No Inspections Yet"}),r.jsx("p",{className:"text-gray-500 text-sm",children:"Scan a QR code to start"})]})]}),r.jsx(p,{})]})};export{u as Dashboard};
