var e=Object.defineProperty,s=(s,t,a)=>((s,t,a)=>t in s?e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a)(s,"symbol"!=typeof t?t+"":t,a);import{r as t,n as a,j as r,X as n,Z as i,a as l,C as o,b as c,u as d,c as m,H as u,d as x,Q as h,e as g,U as b,M as p,F as f,S as j,B as v,L as y,l as w,P as N,f as S,D as _,g as k,h as C,i as z,k as I,m as L,o as A,p as E,E as O,q as T,s as q,T as M,t as R,A as F,v as P,w as U,x as D,y as $,z as B,G as Q}from"./react-vendor-B7zQ2Eq0.js";import{j as V,c as G,o as W,Z as H,b as J,s as K,l as Z,n as Y}from"./vendor-CnJW_4UD.js";import{c as X}from"./supabase-vendor-Cq9hqQQH.js";import{f as ee,s as se}from"./date-vendor-CSGrVI8S.js";const te=new class{constructor(){s(this,"sessionId"),s(this,"userId"),s(this,"logs",[]),s(this,"maxLogs",100),s(this,"isDev",!1),this.sessionId=this.getOrCreateSessionId(),this.initSession()}getOrCreateSessionId(){let e=sessionStorage.getItem("app_session_id");return e||(e=`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,sessionStorage.setItem("app_session_id",e)),e}initSession(){this.info("Session started",{sessionId:this.sessionId,timestamp:(new Date).toISOString(),userAgent:navigator.userAgent,screen:`${window.screen.width}x${window.screen.height}`,viewport:`${window.innerWidth}x${window.innerHeight}`,platform:navigator.platform,language:navigator.language})}setUserId(e){this.userId=e,this.info("User authenticated",{userId:e})}createLogEntry(e,s,t){return{timestamp:(new Date).toISOString(),level:e,message:s,data:t,sessionId:this.sessionId,userId:this.userId,url:window.location.href,userAgent:navigator.userAgent}}addLog(e){this.logs.push(e),this.logs.length>this.maxLogs&&this.logs.shift();try{localStorage.setItem("app_logs",JSON.stringify(this.logs.slice(-20)))}catch(s){}}debug(e,s){if(!this.isDev)return;const t=this.createLogEntry("debug",e,s);this.addLog(t)}info(e,s){const t=this.createLogEntry("info",e,s);this.addLog(t)}warn(e,s){const t=this.createLogEntry("warn",e,s);this.addLog(t)}error(e,s){const t=this.createLogEntry("error",e,{error:(null==s?void 0:s.message)||s,stack:null==s?void 0:s.stack,name:null==s?void 0:s.name});this.addLog(t),this.sendErrorToServer(t)}startTimer(e){const s=performance.now();return this.debug(`â±ï¸ Timer started: ${e}`),()=>{const t=performance.now()-s;this.info(`â±ï¸ Timer ended: ${e}`,{duration:`${t.toFixed(2)}ms`,slow:t>1e3}),t>1e3&&this.warn(`Slow operation detected: ${e}`,{duration:t})}}logApiCall(e,s,t,a){const r=`API ${e} ${s}`;this[t&&t>=400?"error":"info"](r,{method:e,url:s,status:t,duration:a?`${a}ms`:void 0})}getLogs(e){return e?this.logs.filter(s=>s.level===e):this.logs}exportLogs(){return JSON.stringify({sessionId:this.sessionId,userId:this.userId,exportedAt:(new Date).toISOString(),logs:this.logs},null,2)}clearLogs(){this.logs=[],localStorage.removeItem("app_logs"),this.info("Logs cleared")}async sendErrorToServer(e){}};window.addEventListener("error",e=>{te.error("Uncaught error",{message:e.message,filename:e.filename,lineno:e.lineno,colno:e.colno,error:e.error})}),window.addEventListener("unhandledrejection",e=>{te.error("Unhandled promise rejection",{reason:e.reason})}),window.addEventListener("popstate",()=>{te.info("Navigation",{url:window.location.href,type:"popstate"})});const ae="https://zznhsfsvankfewasstel.supabase.co",re="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp6bmhzZnN2YW5rZmV3YXNzdGVsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA2MzY5MTQsImV4cCI6MjA3NjIxMjkxNH0.U2XCOfWSuZQpTzzgwMhkSAL0CJz1bqtHIkziLYpwmZ0";class ne extends Error{constructor(e){super(e),this.name="SupabaseConfigError"}}class ie extends Error{constructor(e){super(e),this.name="SupabaseConnectionError"}}const le=(()=>{try{(()=>{const e=[];if(e.length>0){const s=new ne(`Missing required environment variables: ${e.join(", ")}`);throw te.error("Supabase config validation failed",s),s}try{new URL(ae)}catch{const e=new ne("Invalid VITE_SUPABASE_URL format");throw te.error("Invalid Supabase URL",e),e}te.info("Supabase configuration validated",{url:`${ae.substring(0,25)}...`,hasKey:!0,keyLength:208})})();const e=X(ae,re,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"pkce",storage:localStorage},realtime:{params:{eventsPerSecond:10}},global:{headers:{"X-Client-Info":"wc-check-app","X-Client-Version":"1.0.0"}},db:{schema:"public"}});return te.info("Supabase client created successfully"),e}catch(e){throw te.error("Failed to create Supabase client",e),e}})();let oe=!1,ce=!1;(async()=>{const e=te.startTimer("Supabase connection test");try{te.info("Testing Supabase connection...");const{data:s,error:t}=await(async(e,s=3,a=1e3)=>{let r;for(let n=1;n<=s;n++)try{return await e()}catch(t){if(r=t,te.warn(`Retry attempt ${n}/${s} failed`,{attempt:n,maxRetries:s,error:r.message}),n===s)break;const i=a*Math.pow(2,n-1);te.debug(`Retrying in ${i}ms...`),await new Promise(e=>setTimeout(e,i))}throw te.error("All retry attempts failed",r),r})(async()=>{var e,s,t,a;const r=await le.auth.getSession();if((null==(s=null==(e=r.error)?void 0:e.message)?void 0:s.includes("fetch"))||(null==(a=null==(t=r.error)?void 0:t.message)?void 0:a.includes("network")))throw new ie(`Network error: ${r.error.message}`);return r});return e(),t?(te.error("Supabase connection test failed",t),!1):(te.info("Supabase connected successfully",{authenticated:!!s.session}),!0)}catch(s){return e(),te.error("Supabase connection test failed after retries",s),!1}})().then(e=>{oe=!0,ce=e,e?te.info("Supabase client initialized and ready"):te.error("Supabase client initialization failed")}),new Promise(e=>{const s=()=>{oe?e(ce):setTimeout(s,100)};s()});const de={save(e){var s;try{if(!e)return;const t={access_token:e.access_token,refresh_token:e.refresh_token,expires_at:e.expires_at,expires_in:e.expires_in,token_type:e.token_type,user:e.user};localStorage.setItem("supabase.auth.token",JSON.stringify(t)),localStorage.setItem("sb-auth-token",e.access_token),localStorage.setItem("sb-refresh-token",e.refresh_token),localStorage.setItem("sb-user-data",JSON.stringify(e.user)),localStorage.setItem("sb-expires-at",(null==(s=e.expires_at)?void 0:s.toString())||"")}catch(t){}},isValid(){try{const e=localStorage.getItem("supabase.auth.token");if(!e)return!1;const s=JSON.parse(e);return!(!s||"object"!=typeof s)&&!!s.access_token}catch(e){return!1}},clear(){try{const e=Object.keys(localStorage);e.filter(e=>e.startsWith("supabase.auth")||e.startsWith("sb-")).forEach(e=>{localStorage.removeItem(e)}),localStorage.removeItem("user"),localStorage.removeItem("session"),localStorage.removeItem("token"),sessionStorage.clear()}catch(e){try{localStorage.clear()}catch(s){}}},validateOnStartup(){(!this.isValid()&&this.hasStoredToken()||this.hasStoredToken()&&this.isTokenExpired())&&this.clear()},hasStoredToken(){try{const e=localStorage.getItem("supabase.auth.token");return null!==e&&"undefined"!==e&&""!==e}catch{return!1}},getTokenExpiry(){try{const e=localStorage.getItem("supabase.auth.token");if(!e)return null;const s=JSON.parse(e);return s.expires_at?new Date(1e3*s.expires_at):null}catch(e){return null}},isTokenExpired(){const e=this.getTokenExpiry();if(!e)return!0;const s=Date.now(),t=e.getTime()<s+6e4;return t},getTimeUntilExpiry(){const e=this.getTokenExpiry();if(!e)return 0;const s=Date.now(),t=e.getTime(),a=Math.floor((t-s)/1e3);return Math.max(0,a)},getUserId(){var e;try{const s=localStorage.getItem("supabase.auth.token");if(!s)return null;return(null==(e=JSON.parse(s).user)?void 0:e.id)||null}catch{return null}},debug(){Object.keys(localStorage).filter(e=>e.startsWith("supabase")||e.startsWith("sb-"))},emergencyReset(){this.clear(),window.location.href="/login"}};"undefined"!=typeof window&&(window.authStorage=de);let me=null,ue=0;function xe(){const[e,s]=t.useState(null),[a,r]=t.useState(null),[n,i]=t.useState(!0),[l,o]=t.useState(null),c=t.useRef(!1),d=async e=>{try{const s=Date.now();if(me&&s-ue<3e5)return me;const{data:t,error:a}=await le.from("users").select("id, email, full_name, is_active, occupation_id").eq("id",e).eq("is_active",!0).maybeSingle();return a?null:t?(me=t,ue=s,t):null}catch(s){return null}},m=t.useCallback(async()=>{if(!(null==e?void 0:e.id))return;const s=await d(e.id);r(s)},[null==e?void 0:e.id]);t.useEffect(()=>{if(c.current)return;c.current=!0;let e=!0;return(async()=>{const t=setTimeout(()=>{i(!1)},3e3);try{const{data:{session:a},error:n}=await le.auth.getSession();if(clearTimeout(t),!e)return void i(!1);if(n||!(null==a?void 0:a.user))return de.clear(),s(null),r(null),void i(!1);de.save(a);const l={id:a.user.id,email:a.user.email,user_metadata:a.user.user_metadata,app_metadata:a.user.app_metadata,created_at:a.user.created_at,updated_at:a.user.updated_at};s(l),d(a.user.id).then(s=>{e&&r(s)}),i(!1)}catch(a){s(null),r(null),i(!1)}})(),()=>{e=!1,c.current=!1}},[]),t.useEffect(()=>{const{data:{subscription:e}}=le.auth.onAuthStateChange(async(e,t)=>{switch(e){case"SIGNED_IN":if(null==t?void 0:t.user){de.save(t);const e={id:t.user.id,email:t.user.email,user_metadata:t.user.user_metadata,app_metadata:t.user.app_metadata,created_at:t.user.created_at,updated_at:t.user.updated_at};s(e);const a=await d(t.user.id);r(a),await(async e=>{try{await le.from("users").update({last_login_at:(new Date).toISOString()}).eq("id",e)}catch(s){}})(t.user.id)}break;case"TOKEN_REFRESHED":break;case"SIGNED_OUT":de.clear(),me=null,ue=0,s(null),r(null)}});return()=>{e.unsubscribe()}},[]);const u=t.useCallback(async()=>{try{await le.auth.signOut(),de.clear(),me=null,ue=0,s(null),r(null)}catch(e){}},[]);return{user:e,profile:a,loading:n,error:l,isAuthenticated:!!e,signOut:u,refreshProfile:m}}const he=({isOpen:e,onClose:s,onScan:d})=>{const m=t.useRef(null),u=t.useRef(null),x=t.useRef(null),h=t.useRef(null),[g,b]=t.useState(!1),[p,f]=t.useState(null),[j,v]=t.useState(!1),[y,w]=t.useState(!1),[N,S]=t.useState(!1),_=t.useCallback(()=>{const e=m.current,s=u.current;if(!e||!s||e.readyState!==e.HAVE_ENOUGH_DATA)return void(h.current=requestAnimationFrame(_));const t=s.getContext("2d",{willReadFrequently:!0});if(!t)return;s.width=e.videoWidth,s.height=e.videoHeight,t.drawImage(e,0,0,s.width,s.height);const r=t.getImageData(0,0,s.width,s.height),n=V(r.data,r.width,r.height,{inversionAttempts:"dontInvert"});if(n){const e=(e=>{try{if(e.includes("/locations/")){const s=e.match(/locations\/([0-9a-f-]{36})/i);return s?s[1]:null}return/^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)?e:null}catch(s){return null}})(n.data);if(e)return"vibrate"in navigator&&navigator.vibrate(200),a.success("Valid QR Code!"),d(e),void C();"vibrate"in navigator&&navigator.vibrate([100,50,100]),a.error("Invalid QR code format")}h.current=requestAnimationFrame(_)},[d]),k=t.useCallback(async()=>{try{b(!0),f(null);const e=await navigator.mediaDevices.getUserMedia({video:{facingMode:{ideal:"environment"},width:{ideal:1280},height:{ideal:720}}});x.current=e;const s=e.getVideoTracks()[0];s.getCapabilities().torch&&S(!0),m.current&&(m.current.srcObject=e,m.current.setAttribute("playsinline","true"),await m.current.play(),v(!0),b(!1),_())}catch(e){if("NotAllowedError"===e.name)f("âŒ Camera permission denied. Please enable camera in browser settings.");else if("NotFoundError"===e.name)f("âŒ No camera found on this device.");else if("NotReadableError"===e.name)f("âŒ Camera is being used by another app. Please close other apps and try again.");else if("OverconstrainedError"===e.name)try{const e=await navigator.mediaDevices.getUserMedia({video:!0});x.current=e,m.current&&(m.current.srcObject=e,m.current.setAttribute("playsinline","true"),await m.current.play(),v(!0),b(!1),_())}catch{f("âŒ Camera initialization failed. Please try again.")}else f("âŒ Camera initialization failed. Please try again.");b(!1)}},[_]),C=t.useCallback(()=>{h.current&&(cancelAnimationFrame(h.current),h.current=null),x.current&&(x.current.getTracks().forEach(e=>e.stop()),x.current=null),m.current&&(m.current.srcObject=null),v(!1),b(!1),w(!1)},[]);t.useEffect(()=>(e?k():C(),()=>{C()}),[e,k,C]);const z=()=>{C(),s()};return e?r.jsxs("div",{className:"fixed inset-0 bg-black z-50 flex flex-col",children:[r.jsx("video",{ref:m,className:"absolute inset-0 w-full h-full object-cover",playsInline:!0,muted:!0}),r.jsx("canvas",{ref:u,className:"hidden"}),j&&r.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:r.jsxs("div",{className:"relative w-64 h-64",children:[r.jsx("div",{className:"absolute top-0 left-0 w-12 h-12 border-t-4 border-l-4 border-white rounded-tl-2xl"}),r.jsx("div",{className:"absolute top-0 right-0 w-12 h-12 border-t-4 border-r-4 border-white rounded-tr-2xl"}),r.jsx("div",{className:"absolute bottom-0 left-0 w-12 h-12 border-b-4 border-l-4 border-white rounded-bl-2xl"}),r.jsx("div",{className:"absolute bottom-0 right-0 w-12 h-12 border-b-4 border-r-4 border-white rounded-br-2xl"}),r.jsx("div",{className:"absolute inset-0 overflow-hidden",children:r.jsx("div",{className:"absolute w-full h-1 bg-gradient-to-r from-transparent via-white to-transparent animate-scan"})})]})}),r.jsxs("div",{className:"absolute top-4 left-4 right-4 z-10 flex items-center justify-between",children:[r.jsx("button",{onClick:z,className:"bg-white/90 backdrop-blur-sm rounded-full p-3 shadow-lg active:scale-95 transition-transform",children:r.jsx(n,{className:"w-6 h-6 text-gray-700"})}),N&&j&&r.jsx("button",{onClick:async()=>{if(x.current)try{const e=x.current.getVideoTracks()[0],s=!y;await e.applyConstraints({advanced:[{torch:s}]}),w(s),a.success(s?"Flashlight ON":"Flashlight OFF")}catch(e){a.error("Flashlight not available")}},className:"backdrop-blur-sm rounded-full p-3 shadow-lg active:scale-95 transition-all "+(y?"bg-yellow-400":"bg-white/90"),children:y?r.jsx(i,{className:"w-6 h-6 text-gray-700"}):r.jsx(l,{className:"w-6 h-6 text-gray-700"})})]}),j&&r.jsx("div",{className:"absolute bottom-8 left-0 right-0 text-center px-6 z-10",children:r.jsxs("div",{className:"bg-black/60 backdrop-blur-sm rounded-2xl p-4 max-w-md mx-auto",children:[r.jsx(o,{className:"w-8 h-8 text-white mx-auto mb-2"}),r.jsx("p",{className:"text-white text-lg font-medium mb-1",children:"Scan QR Code"}),r.jsx("p",{className:"text-gray-300 text-sm",children:"Point camera at location QR code"})]})}),g&&r.jsx("div",{className:"absolute inset-0 bg-black/80 flex items-center justify-center z-20",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-4 border-white border-t-transparent mx-auto mb-4"}),r.jsx("p",{className:"text-white text-lg font-medium",children:"Initializing camera..."}),r.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"Please allow camera access"})]})}),p&&r.jsx("div",{className:"absolute inset-0 bg-black flex items-center justify-center p-6 z-20",children:r.jsxs("div",{className:"text-center max-w-md",children:[r.jsx(c,{className:"w-20 h-20 text-red-500 mx-auto mb-4"}),r.jsx("h3",{className:"text-2xl font-bold text-white mb-3",children:"Camera Error"}),r.jsx("p",{className:"text-gray-300 mb-6 leading-relaxed",children:p}),r.jsxs("div",{className:"bg-white/10 rounded-xl p-4 mb-6 text-left",children:[r.jsx("p",{className:"text-white font-medium mb-2",children:"ðŸ’¡ Troubleshooting:"}),r.jsxs("ul",{className:"text-gray-300 text-sm space-y-1",children:[r.jsx("li",{children:"â€¢ Check browser camera permissions"}),r.jsx("li",{children:"â€¢ Close other apps using camera"}),r.jsx("li",{children:"â€¢ Try refreshing the page"}),r.jsx("li",{children:"â€¢ Make sure you're on HTTPS"})]})]}),r.jsx("button",{onClick:z,className:"w-full bg-white text-gray-900 px-6 py-3 rounded-xl font-medium hover:bg-gray-100 transition-colors",children:"Close & Try Again"})]})}),r.jsx("style",{children:"\n        @keyframes scan {\n          0% {\n            transform: translateY(-100%);\n          }\n          100% {\n            transform: translateY(400%);\n          }\n        }\n        .animate-scan {\n          animation: scan 2s linear infinite;\n        }\n      "})]}):null},ge=[{id:"home",icon:u,label:"Home",path:"/"},{id:"history",icon:x,label:"History",path:"/history"},{id:"scan",icon:h,label:"Scan",path:"/scan",isCenter:!0},{id:"analytics",icon:g,label:"Analytics",path:"/analytics"},{id:"profile",icon:b,label:"Profile",path:"/profile"}],be=()=>{const e=d(),s=m(),[a,n]=t.useState(!1);return r.jsxs(r.Fragment,{children:[r.jsx("nav",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 z-50 safe-area-bottom",children:r.jsx("div",{className:"flex items-center justify-around relative px-2 pt-2 pb-2",children:ge.map(t=>{const a=t.icon,i=s.pathname===t.path||"/"!==t.path&&s.pathname.startsWith(t.path);return t.isCenter?r.jsx("div",{className:"flex-1 flex justify-center",children:r.jsx("button",{onClick:()=>n(!0),className:"\n                      w-14 h-14\n                      bg-gradient-to-br from-blue-600 to-blue-400\n                      rounded-full\n                      flex items-center justify-center\n                      text-white\n                      shadow-lg shadow-blue-600/30\n                      -mt-6\n                      transition-all duration-200\n                      active:scale-90\n                      hover:shadow-xl hover:shadow-blue-600/40\n                    ","aria-label":t.label,children:r.jsx(a,{className:"w-7 h-7",strokeWidth:2.5})})},t.id):r.jsxs("button",{onClick:()=>e(t.path),className:G("flex-1 flex flex-col items-center justify-center gap-1 py-2 px-2 rounded-xl transition-all duration-200",i?"text-blue-600":"text-gray-500 hover:text-gray-700 active:scale-95"),"aria-label":t.label,children:[r.jsxs("div",{className:G("relative",i&&"scale-110"),children:[r.jsx(a,{className:"w-6 h-6",strokeWidth:i?2.5:2}),i&&r.jsx("div",{className:"absolute -bottom-1 left-1/2 transform -translate-x-1/2 w-1 h-1 bg-blue-600 rounded-full"})]}),r.jsx("span",{className:G("text-[11px] font-medium",i?"text-blue-600":"text-gray-600"),children:t.label})]},t.id)})})}),r.jsx(he,{isOpen:a,onClose:()=>n(!1),onScan:s=>{n(!1),e(`/inspect/${s}`)}})]})};function pe(){const{user:e}=xe(),[s,a]=t.useState(!1),[r,n]=t.useState(!0);return t.useEffect(()=>{(async()=>{var s,t;if(!(null==e?void 0:e.id))return a(!1),void n(!1);try{try{const{data:e,error:s}=await le.rpc("is_admin");if(!s&&null!==e)return a(!0===e),void n(!1)}catch(r){}const{data:i,error:l}=await le.from("user_roles").select("\n            user_id,\n            role_id,\n            roles (\n              id,\n              name,\n              level\n            )\n          ").eq("user_id",e.id).maybeSingle();if(l)a(!1);else if(i){const e=(null==(s=i.roles)?void 0:s.level)||0;null==(t=i.roles)||t.name;a(e>=80)}else a(!1)}catch(i){a(!1)}finally{n(!1)}})()},[null==e?void 0:e.id]),{isAdmin:s,loading:r}}const fe=({isOpen:e,onClose:s})=>{var t;const a=d(),i=m(),{profile:l,signOut:o}=xe(),{isAdmin:c}=pe(),x=e=>{a(e),s()},g=[{icon:u,label:"Dashboard",path:"/"},{icon:h,label:"Scan QR",path:"/scan"},{icon:p,label:"Locations",path:"/locations",description:"Manual inspection"},{icon:f,label:"Reports",path:"/reports"},{icon:b,label:"Profile",path:"/profile"}],w=[{icon:j,label:"Organizations",path:"/admin/organizations",description:"Manage organizations"},{icon:v,label:"Buildings",path:"/admin/buildings",description:"Manage buildings"},{icon:p,label:"Manage Locations",path:"/admin/locations",description:"Admin location CRUD"}],N=e=>i.pathname===e;return e?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 transition-opacity",onClick:s}),r.jsxs("div",{className:"fixed inset-y-0 left-0 w-80 bg-white z-50 shadow-2xl transform transition-transform",children:[r.jsxs("div",{className:"bg-white border-b border-gray-100 p-6",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Menu"}),r.jsx("button",{onClick:s,className:"p-2 hover:bg-gray-100 rounded-xl transition-colors",children:r.jsx(n,{className:"w-6 h-6 text-gray-600"})})]}),l&&r.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-xl",children:[r.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center",children:r.jsx("span",{className:"text-lg font-bold text-white",children:(null==(t=l.full_name)?void 0:t.charAt(0).toUpperCase())||"U"})}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("div",{className:"font-semibold text-gray-900 truncate",children:l.full_name}),r.jsx("div",{className:"text-xs text-gray-500 truncate",children:l.email})]})]})]}),r.jsxs("div",{className:"p-4 space-y-1 overflow-y-auto max-h-[calc(100vh-280px)]",children:[g.map(e=>{const s=e.icon,t=N(e.path);return r.jsxs("button",{onClick:()=>x(e.path),className:`\n                  w-full flex items-center gap-3 p-4 rounded-xl transition-all\n                  ${t?"bg-blue-50 text-blue-600 shadow-sm":"text-gray-700 hover:bg-gray-50"}\n                `,children:[r.jsx(s,{className:"w-5 h-5 "+(t?"text-blue-600":"text-gray-400")}),r.jsxs("div",{className:"flex-1 text-left",children:[r.jsx("div",{className:"font-medium",children:e.label}),e.description&&r.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:e.description})]})]},e.path)}),c&&r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"pt-4 pb-2",children:r.jsx("div",{className:"text-xs font-semibold text-gray-400 uppercase tracking-wider px-4",children:"Admin"})}),w.map(e=>{const s=e.icon,t=N(e.path);return r.jsxs("button",{onClick:()=>x(e.path),className:`\n                      w-full flex items-center gap-3 p-4 rounded-xl transition-all\n                      ${t?"bg-purple-50 text-purple-600 shadow-sm":"text-gray-700 hover:bg-gray-50"}\n                    `,children:[r.jsx(s,{className:"w-5 h-5 "+(t?"text-purple-600":"text-gray-400")}),r.jsxs("div",{className:"flex-1 text-left",children:[r.jsx("div",{className:"font-medium",children:e.label}),e.description&&r.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:e.description})]})]},e.path)})]})]}),r.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-4 bg-white border-t border-gray-100",children:r.jsxs("button",{onClick:async()=>{window.confirm("Are you sure you want to logout?")&&(await o(),a("/login"),s())},className:"w-full flex items-center justify-center gap-2 p-4 bg-white shadow-md border border-gray-100 rounded-xl font-medium text-red-600 hover:bg-red-50 transition-colors",children:[r.jsx(y,{className:"w-5 h-5"}),r.jsx("span",{children:"Logout"})]})})]})]}):null},je=({children:e,variant:s="default",hoverable:t=!0,padding:a="md",className:n,...i})=>{const l=t?"hover:shadow-md hover:-translate-y-0.5 active:scale-[0.99]":"";return r.jsx("div",{className:G("bg-white rounded-2xl transition-all",{default:"shadow-sm border border-gray-100",flat:"border border-gray-200",bordered:"border-2 border-gray-200",glass:"glass"}[s],{none:"",sm:"p-3",md:"p-4",lg:"p-6"}[a],l,n),...i,children:e})},ve=({title:e,subtitle:s,action:t,icon:a})=>r.jsxs("div",{className:"flex items-center justify-between mb-3",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[a&&r.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center text-xl",children:a}),r.jsxs("div",{children:[r.jsx("h3",{className:"font-semibold text-gray-900",children:e}),s&&r.jsx("p",{className:"text-sm text-gray-500",children:s})]})]}),t&&r.jsx("div",{children:t})]}),ye=({variant:e="primary",size:s="md",children:t,loading:a=!1,className:n,disabled:i,...l})=>r.jsx("button",{className:G("font-medium rounded-2xl transition-all active:scale-95 focus:outline-none focus:ring-2 focus:ring-offset-2",{primary:"bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500 shadow-lg",secondary:"bg-gray-600 text-white hover:bg-gray-700 focus:ring-gray-500",outline:"border border-gray-300 text-gray-700 hover:bg-gray-50 focus:ring-blue-500 bg-white"}[e],{sm:"px-3 py-2 text-sm",md:"px-4 py-3 text-sm",lg:"px-6 py-4 text-base"}[s],(i||a)&&"opacity-50 cursor-not-allowed",n),disabled:i||a,...l,children:a?r.jsxs("div",{className:"flex items-center justify-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Loading..."]}):t}),we=({locations:e,onClose:s})=>{const a=t.useRef(null),i=e=>`https://wc-checks.vercel.app/locations/${e}`,l=1===e.length,o=w.useReactToPrint({content:()=>a.current,documentTitle:`QR-Codes-${(new Date).toISOString().split("T")[0]}`,pageStyle:`\n      @page {\n        size: A4;\n        margin: ${l?"10mm":"15mm"};\n      }\n      @media print {\n        body {\n          -webkit-print-color-adjust: exact;\n          print-color-adjust: exact;\n        }\n      }\n    `,onBeforeGetContent:()=>Promise.resolve(),onAfterPrint:()=>{},onPrintError:e=>{}});return r.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 overflow-y-auto",children:r.jsxs(je,{className:"w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[r.jsxs("div",{className:"sticky top-0 bg-white pb-4 border-b border-gray-200 flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"QR Code Generator"}),r.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[e.length," location",e.length>1?"s":""," â€¢ Production URL"]})]}),r.jsx("button",{onClick:s,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:r.jsx(n,{className:"w-5 h-5"})})]}),r.jsx("div",{className:"flex space-x-3 my-4",children:r.jsxs(ye,{onClick:o,className:"flex-1 flex items-center justify-center space-x-2",children:[r.jsx(N,{className:"w-5 h-5"}),r.jsxs("span",{children:["Print All (",e.length,")"]})]})}),r.jsx("div",{className:"space-y-4",children:e.map(e=>{const s=i(e.id);return r.jsx(je,{className:"bg-gray-50",children:r.jsxs("div",{className:"flex items-center space-x-4",children:[r.jsx("div",{id:`qr-${e.id}`,className:"flex-shrink-0 bg-white p-2 rounded-lg",children:r.jsx(S,{value:s,size:120,level:"H",includeMargin:!0})}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("h3",{className:"font-semibold text-gray-900 truncate",children:e.name}),e.code&&r.jsxs("p",{className:"text-sm text-blue-600 font-medium",children:["Code: ",e.code]}),r.jsxs("div",{className:"text-sm text-gray-600 mt-1 space-y-0.5",children:[e.building&&r.jsxs("p",{children:["ðŸ¢ ",e.building]}),e.floor&&r.jsxs("p",{children:["ðŸ“ ",e.floor]}),e.area&&r.jsxs("p",{children:["ðŸ“Œ ",e.area]})]}),r.jsxs("div",{className:"mt-2 p-2 bg-white rounded border border-gray-200",children:[r.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"QR URL:"}),r.jsx("p",{className:"text-xs font-mono text-gray-700 break-all",children:s})]})]}),r.jsx(ye,{variant:"outline",size:"sm",onClick:()=>(e=>{var s;const t=null==(s=document.getElementById(`qr-${e.id}`))?void 0:s.querySelector("svg");if(!t)return;const a=(new XMLSerializer).serializeToString(t),r=document.createElement("canvas"),n=r.getContext("2d"),i=new Image,l=512;r.width=l,r.height=l,i.onload=()=>{if(!n)return;n.fillStyle="#FFFFFF",n.fillRect(0,0,l,l);const s=t.width.baseVal.value||120,a=t.height.baseVal.value||120,o=Math.min(l/s,l/a),c=s*o,d=a*o,m=(l-c)/2,u=(l-d)/2;n.drawImage(i,m,u,c,d),r.toBlob(s=>{if(s){const t=URL.createObjectURL(s),a=document.createElement("a");a.download=`QR-${e.code||e.name}.png`,a.href=t,a.click(),URL.revokeObjectURL(t)}})},i.src="data:image/svg+xml;base64,"+btoa(a)})(e),className:"flex-shrink-0",title:"Download PNG",children:r.jsx(_,{className:"w-4 h-4"})})]})},e.id)})}),r.jsx("div",{style:{position:"absolute",left:"-9999px",top:0,width:"210mm",background:"white"},children:r.jsx("div",{ref:a,children:l?r.jsx("div",{style:{width:"100%",height:"100vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",padding:"20mm"},children:e.map(e=>{const s=i(e.id);return r.jsxs("div",{children:[r.jsx("div",{style:{marginBottom:"15mm"},children:r.jsx(S,{value:s,size:400,level:"H",includeMargin:!0})}),r.jsx("h1",{style:{fontSize:"32px",fontWeight:"bold",marginBottom:"12px",color:"#111827"},children:e.name}),e.code&&r.jsxs("p",{style:{fontSize:"24px",color:"#2563eb",fontWeight:"600",marginBottom:"12px"},children:["Code: ",e.code]}),r.jsxs("div",{style:{fontSize:"18px",color:"#6b7280",marginTop:"8mm"},children:[e.building&&r.jsxs("p",{style:{marginBottom:"6px"},children:["ðŸ¢ ",e.building]}),e.floor&&r.jsxs("p",{style:{marginBottom:"6px"},children:["ðŸ“ ",e.floor]}),e.area&&r.jsxs("p",{children:["ðŸ“Œ ",e.area]})]})]},e.id)})}):r.jsxs("div",{children:[r.jsx("style",{children:"\n                    @media print {\n                      .qr-grid-container {\n                        display: grid;\n                        grid-template-columns: 1fr 1fr;\n                        gap: 10mm;\n                        page-break-inside: avoid;\n                      }\n                      .qr-grid-item {\n                        border: 2px solid #e5e7eb;\n                        border-radius: 8px;\n                        padding: 8mm;\n                        text-align: center;\n                        background: white;\n                        page-break-inside: avoid;\n                      }\n                      .qr-page-break {\n                        page-break-after: always;\n                      }\n                    }\n                  "}),Array.from({length:Math.ceil(e.length/4)}).map((s,t)=>{const a=e.slice(4*t,4*(t+1)),n=t===Math.ceil(e.length/4)-1;return r.jsx("div",{className:n?"":"qr-page-break",children:r.jsx("div",{className:"qr-grid-container",children:a.map(e=>{const s=i(e.id);return r.jsxs("div",{className:"qr-grid-item",children:[r.jsx("div",{style:{marginBottom:"4mm"},children:r.jsx(S,{value:s,size:150,level:"H",includeMargin:!0})}),r.jsx("h3",{style:{fontSize:"16px",fontWeight:"bold",marginBottom:"4px",color:"#111827"},children:e.name}),e.code&&r.jsx("p",{style:{fontSize:"14px",color:"#2563eb",fontWeight:"600",marginBottom:"4px"},children:e.code}),r.jsxs("div",{style:{fontSize:"11px",color:"#6b7280"},children:[e.building&&r.jsx("div",{children:e.building}),e.floor&&r.jsx("div",{children:e.floor})]})]},e.id)})})},t)})]})})})]})})},Ne=Object.freeze(Object.defineProperty({__proto__:null,QRCodeGenerator:we},Symbol.toStringTag,{value:"Module"})),Se=({location:e,onClose:s,onSuccess:n})=>{var i;const{user:l}=xe(),o=k(),[c,d]=t.useState([]),[m,u]=t.useState([]),[x,h]=t.useState(!1),[g,b]=t.useState({name:(null==e?void 0:e.name)||"",code:(null==e?void 0:e.code)||"",organization_id:(null==e?void 0:e.organization_id)||"",building_id:(null==e?void 0:e.building_id)||"",floor:(null==e?void 0:e.floor)||"",area:(null==e?void 0:e.area)||"",section:(null==e?void 0:e.section)||"",description:(null==e?void 0:e.description)||""});t.useEffect(()=>{(async()=>{const{data:e,error:s}=await le.from("organizations").select("*").eq("is_active",!0).order("name");s||d(e||[])})()},[]),t.useEffect(()=>{(async()=>{if(!g.organization_id)return void u([]);h(!0);const{data:e,error:s}=await le.from("buildings").select("*").eq("organization_id",g.organization_id).eq("is_active",!0).order("name");s||u(e||[]),h(!1)})()},[g.organization_id]);const p=z({mutationFn:async s=>{if(!s.organization_id||!s.building_id)throw new Error("Organization and Building are required");if(e){const t={name:s.name,code:s.code,organization_id:s.organization_id,building_id:s.building_id,floor:s.floor,area:s.area,section:s.section,description:s.description,updated_at:(new Date).toISOString()},{error:a}=await le.from("locations").update(t).eq("id",e.id);if(a)throw a}else{const{data:e,error:t}=await le.from("buildings").select("short_code, organizations(short_code)").eq("id",s.building_id).single();if(t||!e)throw new Error("Building not found");const a=e.organizations.short_code+"-"+e.short_code+"-"+(s.code||"LOC")+"-"+Date.now().toString(36).slice(-4),r={name:s.name,code:s.code,organization_id:s.organization_id,building_id:s.building_id,floor:s.floor,area:s.area,section:s.section,description:s.description,qr_code:a.toUpperCase(),is_active:!0,created_by:(null==l?void 0:l.id)||null},{error:n}=await le.from("locations").insert(r);if(n)throw n}},onSuccess:()=>{a.success(e?"Location updated":"Location created"),o.invalidateQueries({queryKey:["locations"]}),n()},onError:e=>{a.error(e.message||"Failed to save location")}});return r.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:r.jsxs(je,{className:"w-full max-w-lg max-h-[90vh] overflow-y-auto",children:[r.jsxs("div",{className:"sticky top-0 bg-white pb-4 border-b border-gray-200",children:[r.jsx("h2",{className:"text-xl font-bold text-gray-900",children:e?"Edit Location":"Add Location"}),l&&r.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Created by: ",(null==(i=l.user_metadata)?void 0:i.name)||l.email]})]}),r.jsxs("form",{onSubmit:e=>{var s;e.preventDefault(),(null==(s=g.name)?void 0:s.trim())?g.organization_id?g.building_id?p.mutate(g):a.error("Building is required"):a.error("Organization is required"):a.error("Location name is required")},className:"space-y-4 mt-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Organization *"}),r.jsxs("select",{value:g.organization_id||"",onChange:e=>b({...g,organization_id:e.target.value,building_id:""}),className:"w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,disabled:p.isPending,children:[r.jsx("option",{value:"",children:"Select Organization"}),c.map(e=>r.jsxs("option",{value:e.id,children:[e.name," (",e.short_code,")"]},e.id))]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Building *"}),r.jsxs("select",{value:g.building_id||"",onChange:e=>b({...g,building_id:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,disabled:!g.organization_id||x||p.isPending,children:[r.jsx("option",{value:"",children:x?"Loading buildings...":g.organization_id?"Select Building":"Select organization first"}),m.map(e=>r.jsxs("option",{value:e.id,children:[e.name," (",e.short_code,")"]},e.id))]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Location Name *"}),r.jsx("input",{type:"text",value:g.name||"",onChange:e=>b({...g,name:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"e.g. Toilet Lantai 3",required:!0,disabled:p.isPending})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Location Code"}),r.jsx("input",{type:"text",value:g.code||"",onChange:e=>b({...g,code:e.target.value.toUpperCase()}),className:"w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"e.g. WC-03, T-MEN-1",disabled:p.isPending})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Floor"}),r.jsx("input",{type:"text",value:g.floor||"",onChange:e=>b({...g,floor:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Lantai 3",disabled:p.isPending})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Section"}),r.jsx("input",{type:"text",value:g.section||"",onChange:e=>b({...g,section:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Pria/Wanita",disabled:p.isPending})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Area Type"}),r.jsxs("select",{value:g.area||"",onChange:e=>b({...g,area:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:p.isPending,children:[r.jsx("option",{value:"",children:"Select Area Type"}),r.jsx("option",{value:"Public Area",children:"Public Area"}),r.jsx("option",{value:"Staff Area",children:"Staff Area"}),r.jsx("option",{value:"VIP Area",children:"VIP Area"}),r.jsx("option",{value:"Service Area",children:"Service Area"}),r.jsx("option",{value:"Emergency Area",children:"Emergency Area"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),r.jsx("textarea",{value:g.description||"",onChange:e=>b({...g,description:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",rows:3,placeholder:"Additional information...",disabled:p.isPending})]}),r.jsxs("div",{className:"flex space-x-3 pt-4",children:[r.jsx(ye,{type:"button",variant:"outline",onClick:s,className:"flex-1",disabled:p.isPending,children:"Cancel"}),r.jsx(ye,{type:"submit",className:"flex-1",disabled:p.isPending||!g.name||!g.organization_id||!g.building_id,children:p.isPending?"Saving...":e?"Update":"Create"})]})]})]})})},_e=Object.freeze(Object.defineProperty({__proto__:null,LocationsManager:()=>{var e,s;const n=d(),{user:i,loading:l}=xe(),{isAdmin:o,loading:c}=pe(),m=k(),[u,x]=t.useState(!1),[g,f]=t.useState(null),[j,v]=t.useState(""),[y,w]=t.useState(!1),[N,S]=t.useState([]),[_,R]=t.useState(null),[F,P]=t.useState(!1),{data:U,isLoading:D}=C({queryKey:["locations"],queryFn:async()=>{const{data:e,error:s}=await le.from("locations").select("*").order("created_at",{ascending:!1});if(s)throw s;return e}}),$=null==U?void 0:U.filter(e=>{var s,t;return e.name.toLowerCase().includes(j.toLowerCase())||(null==(s=e.building)?void 0:s.toLowerCase().includes(j.toLowerCase()))||(null==(t=e.code)?void 0:t.toLowerCase().includes(j.toLowerCase()))}),B=z({mutationFn:async e=>{const{error:s}=await le.from("locations").delete().eq("id",e);if(s)throw s},onSuccess:()=>{m.invalidateQueries({queryKey:["locations"]}),a.success("Location deleted")},onError:e=>{a.error(e.message||"Failed to delete")}}),Q=e=>`${window.location.origin}/locations/${e}`;return l||c?r.jsx("div",{className:"min-h-screen bg-white flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),r.jsx("p",{className:"text-gray-600 text-sm",children:"Checking permissions..."})]})}):i&&o?D?r.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):r.jsxs("div",{className:"min-h-screen bg-gray-50 pb-24",children:[r.jsx("div",{className:"bg-white p-6 shadow-md border-b border-gray-100",children:r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("button",{onClick:()=>P(!0),className:"w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center hover:bg-gray-200 transition-colors",children:r.jsx(L,{className:"w-5 h-5 text-gray-700"})}),r.jsxs("div",{children:[r.jsx("h1",{className:"text-2xl font-bold text-gray-900",style:{textShadow:"1px 1px 2px rgba(0,0,0,0.15)"},children:"Location Management"}),r.jsx("p",{className:"text-gray-600 text-sm",children:"Manage toilet locations & QR codes"})]})]}),i&&r.jsxs("div",{className:"hidden sm:flex items-center space-x-2 bg-gray-100 px-3 py-2 rounded-lg",children:[r.jsx(b,{className:"w-4 h-4 text-gray-600"}),r.jsx("span",{className:"text-gray-700 text-sm font-medium",children:(null==(e=i.user_metadata)?void 0:e.name)||i.email})]})]})}),r.jsxs("div",{className:"p-4 space-y-4",children:[i&&r.jsx(je,{className:"sm:hidden p-3 bg-white border-gray-200",children:r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx(b,{className:"w-4 h-4 text-gray-600"}),r.jsx("span",{className:"text-gray-700 text-sm font-medium",children:(null==(s=i.user_metadata)?void 0:s.name)||i.email})]})}),r.jsx(je,{children:r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"relative",children:[r.jsx(A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),r.jsx("input",{type:"text",placeholder:"Search locations...",value:j,onChange:e=>v(e.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[r.jsxs(ye,{onClick:()=>{f(null),x(!0)},className:"flex items-center justify-center space-x-2",children:[r.jsx(E,{className:"w-5 h-5"}),r.jsx("span",{children:"Add"})]}),r.jsxs(ye,{variant:"outline",onClick:()=>{U&&0!==U.length?(S(U),w(!0)):a.error("No locations available")},className:"flex items-center justify-center space-x-2",children:[r.jsx(h,{className:"w-5 h-5"}),r.jsx("span",{children:"Bulk QR"})]})]})]})}),r.jsx("div",{className:"space-y-3",children:0===(null==$?void 0:$.length)?r.jsx(je,{children:r.jsxs("div",{className:"text-center py-8 text-gray-500",children:[r.jsx(p,{className:"w-12 h-12 mx-auto mb-2 text-gray-300"}),r.jsx("p",{children:"No locations found"})]})}):null==$?void 0:$.map(e=>r.jsxs(je,{className:"relative",children:[r.jsxs("div",{className:"pr-10",children:[r.jsxs("div",{className:"flex items-start space-x-3 mb-3",children:[r.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center text-xl flex-shrink-0",children:"ðŸš½"}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("h3",{className:"font-semibold text-gray-900 truncate",children:e.name}),e.code&&r.jsx("span",{className:"inline-block mt-1 px-2 py-0.5 bg-blue-100 text-blue-700 text-xs rounded-full",children:e.code})]})]}),r.jsxs("div",{className:"text-sm text-gray-600 space-y-1 mb-3",children:[e.building&&r.jsxs("p",{className:"truncate",children:["ðŸ¢ ",e.building]}),e.floor&&r.jsxs("p",{className:"truncate",children:["ðŸ“ ",e.floor]}),e.area&&r.jsxs("p",{className:"truncate",children:["ðŸ—ºï¸ ",e.area]})]}),e.created_by&&r.jsxs("div",{className:"text-xs text-gray-500 mb-2",children:["Created by: ",e.created_by===(null==i?void 0:i.id)?"You":e.created_by]}),r.jsxs("details",{className:"text-xs",children:[r.jsx("summary",{className:"text-blue-600 cursor-pointer hover:text-blue-700 font-medium",children:"View URL"}),r.jsx("div",{className:"mt-2 p-2 bg-gray-50 rounded-lg border border-gray-200",children:r.jsx("p",{className:"text-gray-600 break-all font-mono",children:Q(e.id)})})]})]}),r.jsxs("div",{className:"absolute top-4 right-4",children:[r.jsx("button",{onClick:()=>R(_===e.id?null:e.id),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:r.jsx(O,{className:"w-5 h-5 text-gray-600"})}),_===e.id&&r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>R(null)}),r.jsxs("div",{className:"absolute right-0 top-full mt-2 w-48 bg-white rounded-xl shadow-xl border border-gray-200 z-20 overflow-hidden",children:[r.jsxs("button",{onClick:()=>(e=>{S([e]),w(!0),R(null)})(e),className:"w-full px-4 py-3 text-left hover:bg-gray-50 flex items-center space-x-3 transition-colors",children:[r.jsx(h,{className:"w-5 h-5 text-blue-600"}),r.jsx("span",{className:"text-sm font-medium text-gray-900",children:"Generate QR"})]}),r.jsxs("button",{onClick:()=>(e=>{const s=Q(e.id);navigator.clipboard.writeText(s),a.success("URL copied!"),R(null)})(e),className:"w-full px-4 py-3 text-left hover:bg-gray-50 flex items-center space-x-3 transition-colors border-t border-gray-100",children:[r.jsx(T,{className:"w-5 h-5 text-gray-600"}),r.jsx("span",{className:"text-sm font-medium text-gray-900",children:"Copy URL"})]}),r.jsxs("button",{onClick:()=>(e=>{f(e),x(!0),R(null)})(e),className:"w-full px-4 py-3 text-left hover:bg-gray-50 flex items-center space-x-3 transition-colors border-t border-gray-100",children:[r.jsx(q,{className:"w-5 h-5 text-gray-600"}),r.jsx("span",{className:"text-sm font-medium text-gray-900",children:"Edit"})]}),r.jsxs("button",{onClick:()=>(async(e,s)=>{window.confirm(`Delete "${s}"?`)&&(B.mutate(e),R(null))})(e.id,e.name),className:"w-full px-4 py-3 text-left hover:bg-red-50 flex items-center space-x-3 transition-colors border-t border-gray-100",children:[r.jsx(M,{className:"w-5 h-5 text-red-600"}),r.jsx("span",{className:"text-sm font-medium text-red-600",children:"Delete"})]})]})]})]})]},e.id))})]}),u&&r.jsx(Se,{location:g,onClose:()=>{x(!1),f(null)},onSuccess:()=>{m.invalidateQueries({queryKey:["locations"]}),x(!1),f(null)}}),y&&r.jsx(we,{locations:N,onClose:()=>{w(!1),S([])}}),r.jsx(fe,{isOpen:F,onClose:()=>P(!1)}),r.jsx(be,{})]}):r.jsx("div",{className:"min-h-screen bg-white flex items-center justify-center p-6",children:r.jsxs("div",{className:"text-center max-w-md",children:[r.jsx(I,{className:"w-20 h-20 text-red-500 mx-auto mb-4"}),r.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-3",children:"Admin Access Required"}),r.jsx("p",{className:"text-gray-600 mb-6 leading-relaxed",children:"This page is only accessible to administrators."}),r.jsxs("div",{className:"mb-6 p-4 bg-gray-100 rounded-lg text-left",children:[r.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Debug Info:"}),r.jsxs("p",{className:"text-xs text-gray-800",children:["User: ",(null==i?void 0:i.email)||"Not logged in"]}),r.jsxs("p",{className:"text-xs text-gray-800",children:["Admin Status: ",o?"Yes":"No"]})]}),r.jsx("button",{onClick:()=>n("/"),className:"w-full bg-blue-600 text-white px-6 py-3 rounded-xl font-medium hover:bg-blue-700 transition-colors",children:"Return to Dashboard"})]})})}},Symbol.toStringTag,{value:"Module"})),ke=W({name:K().min(2,"Organization name must be at least 2 characters").max(255,"Organization name is too long"),short_code:K().min(1,"Short code is required").max(10,"Short code must be 10 characters or less").regex(/^[A-Z0-9\-_]+$/,"Short code must contain only uppercase letters, numbers, hyphens, and underscores").transform(e=>e.toUpperCase()),email:K().email("Invalid email format").optional().or(Z("")),phone:K().regex(/^[\d\s\-\+\(\)]*$/,"Invalid phone number format").optional().or(Z("")),address:K().max(500,"Address is too long").optional().or(Z("")),is_active:J().default(!0)}),Ce=Object.freeze(Object.defineProperty({__proto__:null,OrganizationsManager:()=>{var e;const s=d(),{user:n,loading:i}=xe(),{isAdmin:l,loading:o}=pe(),c=k(),[m,u]=t.useState(!1),[x,h]=t.useState(null),[g,p]=t.useState(""),[f,j]=t.useState(null),[y,w]=t.useState(!1),[N,S]=t.useState({name:"",short_code:"",address:"",email:"",phone:"",is_active:!0}),{data:_,isLoading:T}=C({queryKey:["organizations"],queryFn:async()=>{const{data:e,error:s}=await le.from("organizations").select("*").order("created_at",{ascending:!1});if(s)throw s;return e}}),R=null==_?void 0:_.filter(e=>{var s;return e.name.toLowerCase().includes(g.toLowerCase())||e.short_code.toLowerCase().includes(g.toLowerCase())||(null==(s=e.email)?void 0:s.toLowerCase().includes(g.toLowerCase()))}),F=z({mutationFn:async e=>{if(x){const{error:s}=await le.from("organizations").update(e).eq("id",x.id);if(s)throw s}else{const{error:s}=await le.from("organizations").insert([{...e,created_by:null==n?void 0:n.id}]);if(s)throw s}},onSuccess:()=>{c.invalidateQueries({queryKey:["organizations"]}),a.success(x?"Organization updated":"Organization created"),u(!1),U()},onError:e=>{a.error(e.message||"Failed to save")}}),P=z({mutationFn:async e=>{const{error:s}=await le.from("organizations").delete().eq("id",e);if(s)throw s},onSuccess:()=>{c.invalidateQueries({queryKey:["organizations"]}),a.success("Organization deleted")},onError:e=>{a.error(e.message||"Failed to delete")}}),U=()=>{S({name:"",short_code:"",address:"",email:"",phone:"",is_active:!0}),h(null)};return i||o?r.jsx("div",{className:"min-h-screen bg-white flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),r.jsx("p",{className:"text-gray-600 text-sm",children:"Checking permissions..."})]})}):n&&l?T?r.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):r.jsxs("div",{className:"min-h-screen bg-gray-50 pb-24",children:[r.jsx("div",{className:"bg-white p-6 shadow-md border-b border-gray-100",children:r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("button",{onClick:()=>w(!0),className:"w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center hover:bg-gray-200",children:r.jsx(L,{className:"w-5 h-5 text-gray-700"})}),r.jsxs("div",{children:[r.jsx("h1",{className:"text-2xl font-bold text-gray-900",style:{textShadow:"1px 1px 2px rgba(0,0,0,0.15)"},children:"Organizations"}),r.jsx("p",{className:"text-gray-600 text-sm",children:"Manage organizations & generate QR codes"})]})]}),n&&r.jsxs("div",{className:"hidden sm:flex items-center space-x-2 bg-gray-100 px-3 py-2 rounded-lg",children:[r.jsx(b,{className:"w-4 h-4 text-gray-600"}),r.jsx("span",{className:"text-gray-700 text-sm font-medium",children:(null==(e=n.user_metadata)?void 0:e.name)||n.email})]})]})}),r.jsxs("div",{className:"p-4 space-y-4",children:[r.jsx(je,{children:r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"relative",children:[r.jsx(A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),r.jsx("input",{type:"text",placeholder:"Search organizations...",value:g,onChange:e=>p(e.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),r.jsxs(ye,{onClick:()=>{U(),u(!0)},className:"w-full flex items-center justify-center space-x-2",children:[r.jsx(E,{className:"w-5 h-5"}),r.jsx("span",{children:"Add Organization"})]})]})}),r.jsx("div",{className:"space-y-3",children:0===(null==R?void 0:R.length)?r.jsx(je,{children:r.jsxs("div",{className:"text-center py-8 text-gray-500",children:[r.jsx(v,{className:"w-12 h-12 mx-auto mb-2 text-gray-300"}),r.jsx("p",{children:"No organizations found"})]})}):null==R?void 0:R.map(e=>r.jsxs(je,{className:"relative",children:[r.jsxs("div",{className:"pr-10",children:[r.jsxs("div",{className:"flex items-start space-x-3 mb-3",children:[r.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center flex-shrink-0",children:"ðŸ¢"}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("h3",{className:"font-semibold text-gray-900 truncate",children:e.name}),r.jsx("span",{className:"inline-block mt-1 px-2 py-0.5 bg-blue-100 text-blue-700 text-xs rounded-full",children:e.short_code})]})]}),r.jsxs("div",{className:"text-sm text-gray-600 space-y-1 mb-2",children:[e.email&&r.jsxs("p",{className:"truncate",children:["ðŸ“§ ",e.email]}),e.phone&&r.jsxs("p",{children:["ðŸ“± ",e.phone]}),e.address&&r.jsxs("p",{className:"truncate",children:["ðŸ“ ",e.address]})]}),r.jsx("div",{className:"flex items-center gap-2",children:r.jsx("span",{className:"inline-block px-2 py-1 text-xs rounded-full "+(e.is_active?"bg-green-100 text-green-700":"bg-gray-100 text-gray-600"),children:e.is_active?"âœ“ Active":"âœ— Inactive"})})]}),r.jsxs("div",{className:"absolute top-4 right-4",children:[r.jsx("button",{onClick:()=>j(f===e.id?null:e.id),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:r.jsx(O,{className:"w-5 h-5 text-gray-600"})}),f===e.id&&r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>j(null)}),r.jsxs("div",{className:"absolute right-0 top-12 z-20 bg-white rounded-xl shadow-2xl border border-gray-200 py-2 min-w-[160px]",children:[r.jsxs("button",{onClick:()=>(e=>{h(e),S({name:e.name,short_code:e.short_code,address:e.address||"",email:e.email||"",phone:e.phone||"",is_active:e.is_active}),u(!0),j(null)})(e),className:"w-full px-4 py-2 text-left hover:bg-gray-50 flex items-center gap-2 text-gray-700",children:[r.jsx(q,{className:"w-4 h-4"}),"Edit"]}),r.jsxs("button",{onClick:()=>(async(e,s)=>{window.confirm(`Delete organization "${s}"? This will affect all buildings and locations!`)&&(P.mutate(e),j(null))})(e.id,e.name),className:"w-full px-4 py-2 text-left hover:bg-gray-50 flex items-center gap-2 text-red-600",children:[r.jsx(M,{className:"w-4 h-4"}),"Delete"]})]})]})]})]},e.id))})]}),m&&r.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:r.jsxs(je,{className:"w-full max-w-lg max-h-[90vh] overflow-y-auto",children:[r.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:x?"Edit Organization":"Add Organization"}),r.jsxs("form",{onSubmit:e=>{e.preventDefault();try{const e=ke.parse(N);F.mutate(e)}catch(s){if(s instanceof H){const e=s.errors[0];a.error(e.message)}else a.error("Validation failed")}},className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name *"}),r.jsx("input",{type:"text",value:N.name,onChange:e=>S({...N,name:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Short Code *"}),r.jsx("input",{type:"text",value:N.short_code,onChange:e=>S({...N,short_code:e.target.value.toUpperCase()}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"e.g., ORG01",required:!0})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),r.jsx("input",{type:"email",value:N.email,onChange:e=>S({...N,email:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone"}),r.jsx("input",{type:"tel",value:N.phone,onChange:e=>S({...N,phone:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Address"}),r.jsx("textarea",{value:N.address,onChange:e=>S({...N,address:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",rows:3})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("input",{type:"checkbox",id:"is_active",checked:N.is_active,onChange:e=>S({...N,is_active:e.target.checked}),className:"w-4 h-4"}),r.jsx("label",{htmlFor:"is_active",className:"text-sm text-gray-700",children:"Active"})]}),r.jsxs("div",{className:"flex gap-2 pt-4",children:[r.jsx(ye,{type:"submit",className:"flex-1",disabled:F.isPending,children:F.isPending?"Saving...":"Save"}),r.jsx(ye,{type:"button",variant:"outline",onClick:()=>{u(!1),U()},className:"flex-1",children:"Cancel"})]})]})]})}),r.jsx(fe,{isOpen:y,onClose:()=>w(!1)}),r.jsx(be,{})]}):r.jsx("div",{className:"min-h-screen bg-white flex items-center justify-center p-6",children:r.jsxs("div",{className:"text-center max-w-md",children:[r.jsx(I,{className:"w-20 h-20 text-red-500 mx-auto mb-4"}),r.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-3",children:"Admin Access Required"}),r.jsx("button",{onClick:()=>s("/"),className:"w-full bg-blue-600 text-white px-6 py-3 rounded-xl font-medium hover:bg-blue-700",children:"Return to Dashboard"})]})})}},Symbol.toStringTag,{value:"Module"})),ze=W({name:K().min(2,"Building name must be at least 2 characters").max(255,"Building name is too long"),short_code:K().min(1,"Short code is required").max(10,"Short code must be 10 characters or less").regex(/^[A-Z0-9\-_]+$/,"Short code must contain only uppercase letters, numbers, hyphens, and underscores").transform(e=>e.toUpperCase()),organization_id:K().uuid("Invalid organization selected").min(1,"Organization is required"),type:K().max(50,"Type is too long").optional().or(Z("")),address:K().max(500,"Address is too long").optional().or(Z("")),total_floors:Y().int("Total floors must be a whole number").min(1,"Total floors must be at least 1").max(200,"Total floors cannot exceed 200").optional().or(Z(void 0)),is_active:J().default(!0)}),Ie=Object.freeze(Object.defineProperty({__proto__:null,BuildingsManager:()=>{var e;const s=d(),{user:n,loading:i}=xe(),{isAdmin:l,loading:o}=pe(),c=k(),[m,u]=t.useState(!1),[x,h]=t.useState(null),[g,p]=t.useState(""),[f,j]=t.useState(null),[y,w]=t.useState(!1),[N,S]=t.useState({name:"",short_code:"",organization_id:"",address:"",type:"",total_floors:void 0,is_active:!0}),{data:_,isLoading:T}=C({queryKey:["buildings"],queryFn:async()=>{const{data:e,error:s}=await le.from("buildings").select("*").order("created_at",{ascending:!1});if(s)throw s;return e}}),{data:R}=C({queryKey:["organizations"],queryFn:async()=>{const{data:e,error:s}=await le.from("organizations").select("*").eq("is_active",!0).order("name");if(s)throw s;return e}}),F=null==_?void 0:_.filter(e=>{var s;return e.name.toLowerCase().includes(g.toLowerCase())||e.short_code.toLowerCase().includes(g.toLowerCase())||(null==(s=e.address)?void 0:s.toLowerCase().includes(g.toLowerCase()))}),P=z({mutationFn:async e=>{if(x){const{error:s}=await le.from("buildings").update(e).eq("id",x.id);if(s)throw s}else{const{error:s}=await le.from("buildings").insert([{...e,created_by:null==n?void 0:n.id}]);if(s)throw s}},onSuccess:()=>{c.invalidateQueries({queryKey:["buildings"]}),a.success(x?"Building updated":"Building created"),u(!1),D()},onError:e=>{a.error(e.message||"Failed to save")}}),U=z({mutationFn:async e=>{const{error:s}=await le.from("buildings").delete().eq("id",e);if(s)throw s},onSuccess:()=>{c.invalidateQueries({queryKey:["buildings"]}),a.success("Building deleted")},onError:e=>{a.error(e.message||"Failed to delete")}}),D=()=>{S({name:"",short_code:"",organization_id:"",address:"",type:"",total_floors:void 0,is_active:!0}),h(null)};return i||o?r.jsx("div",{className:"min-h-screen bg-white flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),r.jsx("p",{className:"text-gray-600 text-sm",children:"Checking permissions..."})]})}):n&&l?T?r.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):r.jsxs("div",{className:"min-h-screen bg-gray-50 pb-24",children:[r.jsx("div",{className:"bg-white p-6 shadow-md border-b border-gray-100",children:r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("button",{onClick:()=>w(!0),className:"w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center hover:bg-gray-200",children:r.jsx(L,{className:"w-5 h-5 text-gray-700"})}),r.jsxs("div",{children:[r.jsx("h1",{className:"text-2xl font-bold text-gray-900",style:{textShadow:"1px 1px 2px rgba(0,0,0,0.15)"},children:"Buildings"}),r.jsx("p",{className:"text-gray-600 text-sm",children:"Manage buildings & generate QR codes"})]})]}),n&&r.jsxs("div",{className:"hidden sm:flex items-center space-x-2 bg-gray-100 px-3 py-2 rounded-lg",children:[r.jsx(b,{className:"w-4 h-4 text-gray-600"}),r.jsx("span",{className:"text-gray-700 text-sm font-medium",children:(null==(e=n.user_metadata)?void 0:e.name)||n.email})]})]})}),r.jsxs("div",{className:"p-4 space-y-4",children:[r.jsx(je,{children:r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"relative",children:[r.jsx(A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),r.jsx("input",{type:"text",placeholder:"Search buildings...",value:g,onChange:e=>p(e.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),r.jsxs(ye,{onClick:()=>{D(),u(!0)},className:"w-full flex items-center justify-center space-x-2",children:[r.jsx(E,{className:"w-5 h-5"}),r.jsx("span",{children:"Add Building"})]})]})}),r.jsx("div",{className:"space-y-3",children:0===(null==F?void 0:F.length)?r.jsx(je,{children:r.jsxs("div",{className:"text-center py-8 text-gray-500",children:[r.jsx(v,{className:"w-12 h-12 mx-auto mb-2 text-gray-300"}),r.jsx("p",{children:"No buildings found"})]})}):null==F?void 0:F.map(e=>{return r.jsxs(je,{className:"relative",children:[r.jsxs("div",{className:"pr-10",children:[r.jsxs("div",{className:"flex items-start space-x-3 mb-3",children:[r.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center flex-shrink-0",children:"ðŸ›ï¸"}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("h3",{className:"font-semibold text-gray-900 truncate",children:e.name}),r.jsx("span",{className:"inline-block mt-1 px-2 py-0.5 bg-blue-100 text-blue-700 text-xs rounded-full",children:e.short_code})]})]}),r.jsx("div",{className:"mb-2",children:r.jsxs("span",{className:"inline-block px-2 py-1 bg-purple-100 text-purple-700 text-xs rounded-lg",children:["ðŸ¢ ",(s=e.organization_id,(null==(t=null==R?void 0:R.find(e=>e.id===s))?void 0:t.name)||"Unknown")]})}),r.jsxs("div",{className:"text-sm text-gray-600 space-y-1 mb-2",children:[e.type&&r.jsxs("p",{children:["ðŸ—ï¸ ",e.type]}),e.total_floors&&r.jsxs("p",{children:["ðŸ“Š ",e.total_floors," floors"]}),e.address&&r.jsxs("p",{className:"truncate",children:["ðŸ“ ",e.address]})]}),r.jsx("div",{className:"flex items-center gap-2",children:r.jsx("span",{className:"inline-block px-2 py-1 text-xs rounded-full "+(e.is_active?"bg-green-100 text-green-700":"bg-gray-100 text-gray-600"),children:e.is_active?"âœ“ Active":"âœ— Inactive"})})]}),r.jsxs("div",{className:"absolute top-4 right-4",children:[r.jsx("button",{onClick:()=>j(f===e.id?null:e.id),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:r.jsx(O,{className:"w-5 h-5 text-gray-600"})}),f===e.id&&r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>j(null)}),r.jsxs("div",{className:"absolute right-0 top-12 z-20 bg-white rounded-xl shadow-2xl border border-gray-200 py-2 min-w-[160px]",children:[r.jsxs("button",{onClick:()=>(e=>{h(e),S({name:e.name,short_code:e.short_code,organization_id:e.organization_id,address:e.address||"",type:e.type||"",total_floors:e.total_floors||void 0,is_active:e.is_active}),u(!0),j(null)})(e),className:"w-full px-4 py-2 text-left hover:bg-gray-50 flex items-center gap-2 text-gray-700",children:[r.jsx(q,{className:"w-4 h-4"}),"Edit"]}),r.jsxs("button",{onClick:()=>(async(e,s)=>{window.confirm(`Delete building "${s}"? This will affect all locations!`)&&(U.mutate(e),j(null))})(e.id,e.name),className:"w-full px-4 py-2 text-left hover:bg-gray-50 flex items-center gap-2 text-red-600",children:[r.jsx(M,{className:"w-4 h-4"}),"Delete"]})]})]})]})]},e.id);var s,t})})]}),m&&r.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:r.jsxs(je,{className:"w-full max-w-lg max-h-[90vh] overflow-y-auto",children:[r.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:x?"Edit Building":"Add Building"}),r.jsxs("form",{onSubmit:e=>{e.preventDefault();try{const e=ze.parse(N);P.mutate(e)}catch(s){if(s instanceof H){const e=s.errors[0];a.error(e.message)}else a.error("Validation failed")}},className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Organization *"}),r.jsxs("select",{value:N.organization_id,onChange:e=>S({...N,organization_id:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0,children:[r.jsx("option",{value:"",children:"Select organization"}),null==R?void 0:R.map(e=>r.jsxs("option",{value:e.id,children:[e.name," (",e.short_code,")"]},e.id))]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Building Name *"}),r.jsx("input",{type:"text",value:N.name,onChange:e=>S({...N,name:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Short Code *"}),r.jsx("input",{type:"text",value:N.short_code,onChange:e=>S({...N,short_code:e.target.value.toUpperCase()}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"e.g., BLD01",required:!0})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Building Type"}),r.jsxs("select",{value:N.type,onChange:e=>S({...N,type:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[r.jsx("option",{value:"",children:"Select type"}),r.jsx("option",{value:"Office",children:"Office"}),r.jsx("option",{value:"Residential",children:"Residential"}),r.jsx("option",{value:"Commercial",children:"Commercial"}),r.jsx("option",{value:"Industrial",children:"Industrial"}),r.jsx("option",{value:"Mixed Use",children:"Mixed Use"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Total Floors"}),r.jsx("input",{type:"number",value:N.total_floors||"",onChange:e=>S({...N,total_floors:e.target.value?parseInt(e.target.value):void 0}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",min:"1"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Address"}),r.jsx("textarea",{value:N.address,onChange:e=>S({...N,address:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",rows:3})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("input",{type:"checkbox",id:"is_active",checked:N.is_active,onChange:e=>S({...N,is_active:e.target.checked}),className:"w-4 h-4"}),r.jsx("label",{htmlFor:"is_active",className:"text-sm text-gray-700",children:"Active"})]}),r.jsxs("div",{className:"flex gap-2 pt-4",children:[r.jsx(ye,{type:"submit",className:"flex-1",disabled:P.isPending,children:P.isPending?"Saving...":"Save"}),r.jsx(ye,{type:"button",variant:"outline",onClick:()=>{u(!1),D()},className:"flex-1",children:"Cancel"})]})]})]})}),r.jsx(fe,{isOpen:y,onClose:()=>w(!1)}),r.jsx(be,{})]}):r.jsx("div",{className:"min-h-screen bg-white flex items-center justify-center p-6",children:r.jsxs("div",{className:"text-center max-w-md",children:[r.jsx(I,{className:"w-20 h-20 text-red-500 mx-auto mb-4"}),r.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-3",children:"Admin Access Required"}),r.jsx("button",{onClick:()=>s("/"),className:"w-full bg-blue-600 text-white px-6 py-3 rounded-xl font-medium hover:bg-blue-700",children:"Return to Dashboard"})]})})}},Symbol.toStringTag,{value:"Module"})),Le=({icon:e,title:s,description:t,path:a,color:n="blue",count:i,badge:l})=>{var o;const c=d(),m={blue:"bg-blue-100 text-blue-600",purple:"bg-purple-100 text-purple-600",green:"bg-green-100 text-green-600",orange:"bg-orange-100 text-orange-600",red:"bg-red-100 text-red-600",cyan:"bg-cyan-100 text-cyan-600"};return r.jsxs("button",{onClick:()=>c(a),className:"\n        relative w-full p-6 bg-white rounded-2xl shadow-sm border border-gray-100\n        hover:shadow-lg hover:scale-[1.02] active:scale-[0.98]\n        transition-all duration-200\n        text-left group\n      ",children:[l&&r.jsx("div",{className:"absolute top-4 right-4 px-2 py-1 bg-red-500 text-white text-xs font-bold rounded-full",children:l}),r.jsx("div",{className:`\n        w-14 h-14 ${m[n]||m.blue} \n        rounded-2xl flex items-center justify-center mb-4\n        group-hover:scale-110 transition-transform\n      `,children:r.jsx(e,{className:"w-7 h-7"})}),r.jsxs("div",{className:"mb-4",children:[r.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-1",children:s}),r.jsx("p",{className:"text-sm text-gray-600",children:t})]}),r.jsxs("div",{className:"flex items-center justify-between",children:[void 0!==i&&r.jsx("div",{className:"text-2xl font-bold text-gray-900",children:i}),r.jsxs("div",{className:`\n          ml-auto flex items-center gap-1 text-sm font-medium\n          ${(null==(o=m[n])?void 0:o.split(" ")[1])||"text-blue-600"}\n          group-hover:gap-2 transition-all\n        `,children:[r.jsx("span",{children:"Manage"}),r.jsx(R,{className:"w-4 h-4"})]})]})]})},Ae=Object.freeze(Object.defineProperty({__proto__:null,AdminDashboard:()=>{var e;e="HomePage",t.useEffect(()=>{const s=performance.now();return te.debug(`Component mounted: ${e}`),()=>{const t=performance.now()-s;te.debug(`Component unmounted: ${e}`,{lifetime:`${t.toFixed(2)}ms`})}},[e]),t.useEffect(()=>{if("undefined"==typeof window)return;const e=()=>{const e=performance.getEntriesByType("navigation")[0];if(e){const s={dns:e.domainLookupEnd-e.domainLookupStart,tcp:e.connectEnd-e.connectStart,ttfb:e.responseStart-e.requestStart,download:e.responseEnd-e.responseStart,domParse:e.domInteractive-e.responseEnd,domReady:e.domContentLoadedEventEnd-e.domContentLoadedEventStart,onload:e.loadEventEnd-e.loadEventStart,total:e.loadEventEnd-e.fetchStart};te.info("Page performance",{url:window.location.pathname,metrics:Object.entries(s).map(([e,s])=>`${e}: ${s.toFixed(2)}ms`).join(", "),slowPage:s.total>3e3}),s.ttfb>800&&te.warn("Slow Time To First Byte (TTFB)",{ttfb:`${s.ttfb.toFixed(2)}ms`,threshold:"800ms"}),s.total>3e3&&te.warn("Slow page load",{total:`${s.total.toFixed(2)}ms`,threshold:"3000ms"})}};if("complete"!==document.readyState)return window.addEventListener("load",e),()=>window.removeEventListener("load",e);e()},[]);const{profile:s}=xe(),a=d(),{data:n,isLoading:i}=C({queryKey:["admin-stats"],queryFn:async()=>{const e=ee(new Date,"yyyy-MM-dd"),s=ee(se(new Date,1),"yyyy-MM-dd"),t=ee(se(new Date,7),"yyyy-MM-dd"),{count:a}=await le.from("users").select("*",{count:"exact",head:!0}).eq("is_active",!0),{count:r}=await le.from("locations").select("*",{count:"exact",head:!0}).eq("is_active",!0),{count:n}=await le.from("inspection_records").select("*",{count:"exact",head:!0}),{count:i}=await le.from("inspection_records").select("*",{count:"exact",head:!0}).eq("inspection_date",e),{count:l}=await le.from("inspection_records").select("*",{count:"exact",head:!0}).eq("inspection_date",s),{count:o}=await le.from("users").select("*",{count:"exact",head:!0}).gte("last_login_at",t).eq("is_active",!0),{data:c}=await le.from("inspection_records").select("responses").limit(100);return{totalUsers:a||0,totalLocations:r||0,totalInspections:n||0,todayInspections:i||0,activeUsers:o||0,avgScore:c&&c.length>0?Math.round(c.reduce((e,s)=>e+(e=>{const s=Object.values(e||{});if(0===s.length)return 0;const t=s.filter(e=>!0===e||"good"===e||"excellent"===e||"baik"===e||"bersih"===e||"ada"===e).length;return Math.round(t/s.length*100)})(s.responses),0)/c.length):0,userGrowth:0,inspectionGrowth:l&&l>0?Math.round(((i||0)-l)/l*100):0}}});return i?r.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):r.jsxs("div",{className:"min-h-screen bg-gray-50 pb-8",children:[r.jsxs("div",{className:"bg-gradient-to-br from-purple-600 via-purple-500 to-pink-500 p-6 rounded-b-3xl shadow-lg",children:[r.jsxs("div",{className:"flex items-center justify-between text-white mb-6",children:[r.jsx("button",{onClick:()=>a(-1),className:"p-2 hover:bg-white/10 rounded-xl transition-colors",children:r.jsx(F,{className:"w-6 h-6"})}),r.jsx("button",{onClick:()=>a("/profile"),className:"p-2 hover:bg-white/10 rounded-xl transition-colors",children:r.jsx(P,{className:"w-6 h-6"})})]}),r.jsxs("div",{className:"flex items-center gap-3 text-white mb-2",children:[r.jsx("div",{className:"w-12 h-12 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center",children:r.jsx(j,{className:"w-7 h-7"})}),r.jsxs("div",{children:[r.jsx("h1",{className:"text-2xl font-bold",children:"Admin Dashboard"}),r.jsxs("p",{className:"text-purple-100",children:["Welcome back, ",null==s?void 0:s.full_name,"!"]})]})]})]}),r.jsxs("div",{className:"px-6 -mt-8",children:[r.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-6",children:[r.jsxs(je,{className:"p-4 bg-gradient-to-br from-blue-50 to-cyan-50 border-blue-100",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center",children:r.jsx(U,{className:"w-5 h-5 text-blue-600"})}),n&&0!==n.inspectionGrowth&&r.jsxs("div",{className:"flex items-center gap-1 text-xs font-medium "+(n.inspectionGrowth>0?"text-green-600":"text-red-600"),children:[n.inspectionGrowth>0?r.jsx(D,{className:"w-3 h-3"}):r.jsx($,{className:"w-3 h-3"}),r.jsxs("span",{children:[Math.abs(n.inspectionGrowth),"%"]})]})]}),r.jsx("div",{className:"text-2xl font-bold text-gray-900",children:(null==n?void 0:n.todayInspections)||0}),r.jsx("div",{className:"text-xs text-gray-600",children:"Today's Inspections"})]}),r.jsxs(je,{className:"p-4 bg-gradient-to-br from-green-50 to-emerald-50 border-green-100",children:[r.jsx("div",{className:"flex items-center justify-between mb-2",children:r.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-xl flex items-center justify-center",children:r.jsx(g,{className:"w-5 h-5 text-green-600"})})}),r.jsx("div",{className:"text-2xl font-bold text-gray-900",children:(null==n?void 0:n.avgScore)||0}),r.jsx("div",{className:"text-xs text-gray-600",children:"Average Score"})]}),r.jsxs(je,{className:"p-4 bg-gradient-to-br from-purple-50 to-pink-50 border-purple-100",children:[r.jsx("div",{className:"flex items-center justify-between mb-2",children:r.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-xl flex items-center justify-center",children:r.jsx(B,{className:"w-5 h-5 text-purple-600"})})}),r.jsx("div",{className:"text-2xl font-bold text-gray-900",children:(null==n?void 0:n.totalUsers)||0}),r.jsx("div",{className:"text-xs text-gray-600",children:"Total Users"})]}),r.jsxs(je,{className:"p-4 bg-gradient-to-br from-orange-50 to-amber-50 border-orange-100",children:[r.jsx("div",{className:"flex items-center justify-between mb-2",children:r.jsx("div",{className:"w-10 h-10 bg-orange-100 rounded-xl flex items-center justify-center",children:r.jsx(U,{className:"w-5 h-5 text-orange-600"})})}),r.jsx("div",{className:"text-2xl font-bold text-gray-900",children:(null==n?void 0:n.activeUsers)||0}),r.jsx("div",{className:"text-xs text-gray-600",children:"Active Users (7d)"})]})]}),r.jsxs("div",{className:"mb-6",children:[r.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-3",children:"Management"}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsx(Le,{icon:B,title:"User Management",description:"Manage users, roles, and permissions",path:"/admin/users",color:"blue",count:null==n?void 0:n.totalUsers}),r.jsx(Le,{icon:p,title:"Locations",description:"Manage toilet locations and QR codes",path:"/admin/locations",color:"green",count:null==n?void 0:n.totalLocations}),r.jsx(Le,{icon:Q,title:"Occupations",description:"Manage job titles and roles",path:"/admin/occupations",color:"purple"}),r.jsx(Le,{icon:v,title:"Organizations",description:"Manage buildings and organizations",path:"/admin/organizations",color:"cyan"}),r.jsx(Le,{icon:f,title:"Templates",description:"Manage inspection templates",path:"/admin/templates",color:"orange"}),r.jsx(Le,{icon:g,title:"Reports",description:"View detailed analytics and reports",path:"/admin/reports",color:"red",count:null==n?void 0:n.totalInspections})]})]}),r.jsxs(je,{children:[r.jsx(ve,{title:"System Overview",subtitle:"Key metrics at a glance",icon:r.jsx(U,{className:"w-5 h-5 text-blue-600"})}),r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-xl",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(f,{className:"w-5 h-5 text-gray-500"}),r.jsx("span",{className:"text-sm font-medium text-gray-900",children:"Total Inspections"})]}),r.jsx("span",{className:"text-lg font-bold text-gray-900",children:(null==n?void 0:n.totalInspections)||0})]}),r.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-xl",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(p,{className:"w-5 h-5 text-gray-500"}),r.jsx("span",{className:"text-sm font-medium text-gray-900",children:"Active Locations"})]}),r.jsx("span",{className:"text-lg font-bold text-gray-900",children:(null==n?void 0:n.totalLocations)||0})]}),r.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-xl",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(x,{className:"w-5 h-5 text-gray-500"}),r.jsx("span",{className:"text-sm font-medium text-gray-900",children:"Today's Activity"})]}),r.jsx("span",{className:"text-lg font-bold text-gray-900",children:(null==n?void 0:n.todayInspections)||0})]})]})]})]})]})}},Symbol.toStringTag,{value:"Module"}));export{Ae as A,be as B,je as C,_e as L,Ce as O,Ne as Q,fe as S,ve as a,de as b,he as c,pe as d,Ie as e,te as l,le as s,xe as u};
