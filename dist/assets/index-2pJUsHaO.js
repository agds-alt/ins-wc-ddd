const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Dashboard-wn9AxUL4.js","assets/react-vendor-B_wON18L.js","assets/vendor-C4HD8sBH.js","assets/admin-DxXcpQLf.js","assets/supabase-vendor-Ck00pQO2.js","assets/date-vendor-DWqTPjCA.js","assets/reports-CYvdUc55.js","assets/inspection-Bd6L4SDO.js","assets/ScanPage-DrD1uUt0.js","assets/ProfilePage-CrZ9b7MC.js","assets/LocationsListPage-COzsmXE_.js","assets/AddLocationPage-D6L-n3bC.js"])))=>i.map(i=>d[i]);
var e=Object.defineProperty,s=(s,t,r)=>((s,t,r)=>t in s?e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r)(s,"symbol"!=typeof t?t+"":t,r);import{r as t,j as r,y as a,a2 as l,J as n,f as o,a3 as i,a4 as c,a5 as d,a6 as m,L as x,a7 as u,a8 as h,a9 as p,aa as f,ab as g,ac as b,ad as j,ae as y,af as w,Y as v}from"./react-vendor-B_wON18L.js";import{_ as N}from"./supabase-vendor-Ck00pQO2.js";import{y as _,z as P,B as E,C as S}from"./vendor-C4HD8sBH.js";import{l as k,b as L,s as A,u as I}from"./admin-DxXcpQLf.js";import{t as R}from"./toast-vendor-D-cKeREv.js";import"./date-vendor-DWqTPjCA.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const t of e)if("childList"===t.type)for(const e of t.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&s(e)}).observe(document,{childList:!0,subtree:!0})}function s(e){if(e.ep)return;e.ep=!0;const s=function(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?s.credentials="include":"anonymous"===e.crossOrigin?s.credentials="omit":s.credentials="same-origin",s}(e);fetch(e.href,s)}}();class O extends t.Component{constructor(e){super(e),s(this,"handleReload",()=>{window.location.reload()}),s(this,"handleHome",()=>{window.location.href="/"}),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e,errorInfo:null}}componentDidCatch(e,s){k.error("React component error",{error:e.message,stack:e.stack,componentStack:s.componentStack}),this.setState({error:e,errorInfo:s})}render(){return this.state.hasError?this.props.fallback?this.props.fallback:r.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:r.jsx("div",{className:"max-w-md w-full bg-white rounded-2xl shadow-xl p-6",children:r.jsxs("div",{className:"flex flex-col items-center text-center",children:[r.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-4",children:r.jsx(a,{className:"w-8 h-8 text-red-600"})}),r.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:"Oops! Something went wrong"}),r.jsx("p",{className:"text-gray-600 mb-4",children:"We've logged the error and will look into it. Please try reloading the page."}),!1,r.jsxs("div",{className:"flex gap-3 w-full",children:[r.jsxs("button",{onClick:this.handleReload,className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-xl font-medium transition-colors flex items-center justify-center gap-2",children:[r.jsx(l,{className:"w-4 h-4"}),"Reload Page"]}),r.jsxs("button",{onClick:this.handleHome,className:"flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 py-3 px-4 rounded-xl font-medium transition-colors flex items-center justify-center gap-2",children:[r.jsx(n,{className:"w-4 h-4"}),"Go Home"]})]})]})})}):this.props.children}}const C=()=>{const[e,s]=t.useState(!1),[r,a]=t.useState(k.getLogs()),[l,n]=t.useState("all");return t.useEffect(()=>{if(!e)return;const s=setInterval(()=>{a(k.getLogs())},1e3);return()=>clearInterval(s)},[e]),null};function D(){const e=o(),[s,l]=t.useState(""),[n,h]=t.useState(""),[p,f]=t.useState(!1),[g,b]=t.useState(!1),[j,y]=t.useState(null),[w,v]=t.useState(null);return r.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-blue-50 flex items-center justify-center p-4",children:r.jsxs("div",{className:"w-full max-w-md",children:[r.jsxs("div",{className:"text-center mb-8",children:[r.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-blue-600 rounded-2xl shadow-lg mb-4",children:r.jsx("span",{className:"text-3xl",children:"ðŸš½"})}),r.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Smart Toilet Monitor"}),r.jsx("p",{className:"text-gray-600",children:"Sign in to manage your facilities"})]}),r.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8 border border-gray-100",children:[j&&r.jsxs("div",{className:"mb-6 bg-red-50 border border-red-200 rounded-lg p-4 flex items-start gap-3",children:[r.jsx(a,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),r.jsxs("div",{className:"flex-1",children:[r.jsx("p",{className:"text-sm font-medium text-red-800",children:"Error"}),r.jsx("p",{className:"text-sm text-red-700 mt-1",children:j})]})]}),w&&r.jsxs("div",{className:"mb-6 bg-green-50 border border-green-200 rounded-lg p-4 flex items-start gap-3",children:[r.jsx("div",{className:"w-5 h-5 bg-green-600 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",children:r.jsx("span",{className:"text-white text-xs",children:"âœ“"})}),r.jsxs("div",{className:"flex-1",children:[r.jsx("p",{className:"text-sm font-medium text-green-800",children:"Success"}),r.jsx("p",{className:"text-sm text-green-700 mt-1",children:w})]})]}),r.jsxs("form",{onSubmit:async t=>{if(t.preventDefault(),!g)if(y(null),v(null),s&&n){b(!0);try{L.clear();const{data:t,error:r}=await A.auth.signInWithPassword({email:s.trim(),password:n});if(r)throw r;(null==t?void 0:t.user)&&(v("Login successful! Redirecting..."),setTimeout(()=>{e("/dashboard")},500))}catch(r){r.message.includes("Invalid login credentials")?y("Invalid email or password. Please try again."):r.message.includes("Email not confirmed")?y("Please verify your email address before logging in."):y(r.message||"Failed to login. Please try again.")}finally{b(!1)}}else y("Email and password are required")},className:"space-y-5",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address"}),r.jsxs("div",{className:"relative",children:[r.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:r.jsx(i,{className:"h-5 w-5 text-gray-400"})}),r.jsx("input",{type:"email",value:s,onChange:e=>l(e.target.value),className:"block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",placeholder:"your.email@example.com",disabled:g,autoComplete:"email",required:!0})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Password"}),r.jsxs("div",{className:"relative",children:[r.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:r.jsx(c,{className:"h-5 w-5 text-gray-400"})}),r.jsx("input",{type:p?"text":"password",value:n,onChange:e=>h(e.target.value),className:"block w-full pl-10 pr-12 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",placeholder:"Enter your password",disabled:g,autoComplete:"current-password",required:!0}),r.jsx("button",{type:"button",onClick:()=>f(!p),className:"absolute inset-y-0 right-0 pr-3 flex items-center hover:text-blue-600 transition-colors",disabled:g,tabIndex:-1,children:p?r.jsx(d,{className:"h-5 w-5 text-gray-400"}):r.jsx(m,{className:"h-5 w-5 text-gray-400"})})]})]}),r.jsx("div",{className:"flex items-center justify-end",children:r.jsx("button",{type:"button",onClick:async()=>{if(s){b(!0),y(null);try{const{error:e}=await A.auth.resetPasswordForEmail(s,{redirectTo:`${window.location.origin}/reset-password`});if(e)throw e;v("Password reset link sent! Check your email.")}catch(e){y(e.message||"Failed to send reset email")}finally{b(!1)}}else y("Please enter your email address first")},className:"text-sm font-medium text-blue-600 hover:text-blue-700 transition-colors",disabled:g,children:"Forgot Password?"})}),r.jsx("button",{type:"submit",disabled:g,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-4 rounded-lg shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 active:translate-y-0 transition-all duration-150 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none flex items-center justify-center gap-2",style:{boxShadow:"0 4px 14px 0 rgba(37, 99, 235, 0.39)"},children:g?r.jsxs(r.Fragment,{children:[r.jsx(x,{className:"w-5 h-5 animate-spin"}),r.jsx("span",{children:"Signing in..."})]}):r.jsxs(r.Fragment,{children:[r.jsx(c,{className:"w-5 h-5"}),r.jsx("span",{children:"Sign In"})]})})]}),r.jsxs("div",{className:"relative my-6",children:[r.jsx("div",{className:"absolute inset-0 flex items-center",children:r.jsx("div",{className:"w-full border-t border-gray-300"})}),r.jsx("div",{className:"relative flex justify-center text-sm",children:r.jsx("span",{className:"px-4 bg-white text-gray-500",children:"Don't have an account?"})})]}),r.jsx(u,{to:"/register",className:"w-full bg-white hover:bg-gray-50 text-blue-600 font-semibold py-3 px-4 rounded-lg border-2 border-blue-600 shadow-md hover:shadow-lg transform hover:-translate-y-0.5 transition-all duration-150 flex items-center justify-center gap-2",children:r.jsx("span",{children:"Create New Account"})})]}),r.jsxs("div",{className:"mt-8 text-center text-sm text-gray-600",children:[r.jsx("p",{children:"Â© 2025 Smart Toilet Monitor. All rights reserved."}),r.jsxs("p",{className:"mt-2",children:[r.jsx("a",{href:"#",className:"text-blue-600 hover:text-blue-700",children:"Privacy Policy"})," Â· ",r.jsx("a",{href:"#",className:"text-blue-600 hover:text-blue-700",children:"Terms of Service"})]})]})]})})}const T=_({full_name:P().min(2,"Full name must be at least 2 characters"),email:P().email("Invalid email address"),password:P().min(6,"Password must be at least 6 characters"),confirmPassword:P(),occupation_id:P().optional()}).refine(e=>e.password===e.confirmPassword,{message:"Passwords don't match",path:["confirmPassword"]}),F=()=>{const[e,s]=t.useState(!1),[a,l]=t.useState([]),[n,i]=t.useState(!0),c=o(),{register:d,handleSubmit:m,formState:{errors:x}}=h({resolver:E(T)});t.useEffect(()=>{(async()=>{try{const{data:e,error:s}=await A.from("user_occupations").select("*").eq("is_active",!0).order("display_name");if(s)throw s;l((e||[]).map(e=>({...e,icon:e.icon||"ðŸ‘¤",color:e.color||"#3B82F6",description:e.description||""})))}catch(e){l([])}finally{i(!1)}})()},[]);return r.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4 safe-area",children:r.jsxs("div",{className:"max-w-md w-full space-y-8",children:[r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"mx-auto h-16 w-16 bg-blue-600 rounded-2xl flex items-center justify-center mb-4",children:r.jsx("span",{className:"text-white text-2xl font-bold",children:"ðŸš½"})}),r.jsx("h2",{className:"text-3xl font-bold text-gray-900",children:"Create Account"}),r.jsx("p",{className:"mt-2 text-gray-600",children:"Sign up to start inspections"})]}),r.jsxs("form",{onSubmit:m(async e=>{s(!0);try{const{data:s,error:t}=await A.auth.signUp({email:e.email,password:e.password,options:{data:{full_name:e.full_name}}});if(t)throw t;if(s.user){const{error:t}=await A.from("users").insert({id:s.user.id,email:e.email,full_name:e.full_name,password_hash:"supabase_auth",occupation_id:e.occupation_id||null,is_active:!0,phone:null,profile_photo_url:null,last_login_at:null});if(t)throw new Error(`Failed to create profile: ${t.message}`)}R.success("Registration successful!"),c("/login")}catch(t){let e=t.message;t.message.includes("password_hash")?e="Database configuration error. Please contact administrator.":t.message.includes("users_pkey")&&(e="User already exists with this email."),R.error(e)}finally{s(!1)}}),className:"mt-8 space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"full_name",className:"block text-sm font-medium text-gray-700",children:"Full Name"}),r.jsx("input",{...d("full_name"),type:"text",className:"mt-1 block w-full px-4 py-3 bg-white border border-gray-300 rounded-2xl shadow-sm focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter your full name"}),x.full_name&&r.jsx("p",{className:"mt-1 text-sm text-red-600",children:x.full_name.message})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email"}),r.jsx("input",{...d("email"),type:"email",className:"mt-1 block w-full px-4 py-3 bg-white border border-gray-300 rounded-2xl shadow-sm focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter your email"}),x.email&&r.jsx("p",{className:"mt-1 text-sm text-red-600",children:x.email.message})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"occupation_id",className:"block text-sm font-medium text-gray-700",children:"Occupation (Optional)"}),n?r.jsx("div",{className:"mt-1 block w-full px-4 py-3 bg-gray-100 border border-gray-300 rounded-2xl",children:r.jsx("span",{className:"text-gray-500",children:"Loading..."})}):r.jsxs("select",{...d("occupation_id"),className:"mt-1 block w-full px-4 py-3 bg-white border border-gray-300 rounded-2xl shadow-sm focus:ring-blue-500 focus:border-blue-500",children:[r.jsx("option",{value:"",children:"Select your occupation"}),a.map(e=>r.jsxs("option",{value:e.id,children:[e.icon," ",e.display_name]},e.id))]})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"Password"}),r.jsx("input",{...d("password"),type:"password",className:"mt-1 block w-full px-4 py-3 bg-white border border-gray-300 rounded-2xl shadow-sm focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter your password"}),x.password&&r.jsx("p",{className:"mt-1 text-sm text-red-600",children:x.password.message})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700",children:"Confirm Password"}),r.jsx("input",{...d("confirmPassword"),type:"password",className:"mt-1 block w-full px-4 py-3 bg-white border border-gray-300 rounded-2xl shadow-sm focus:ring-blue-500 focus:border-blue-500",placeholder:"Confirm your password"}),x.confirmPassword&&r.jsx("p",{className:"mt-1 text-sm text-red-600",children:x.confirmPassword.message})]}),r.jsx("button",{type:"submit",disabled:e,className:"w-full flex justify-center py-3 px-4 border border-transparent rounded-2xl shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:e?"Creating Account...":"Create Account"})]}),r.jsx("div",{className:"text-center",children:r.jsxs("p",{className:"text-gray-600",children:["Already have an account?"," ",r.jsx(u,{to:"/login",className:"text-blue-600 hover:text-blue-700 font-medium",children:"Sign in"})]})})]})})},z=t.lazy(()=>N(()=>import("./Dashboard-wn9AxUL4.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])).then(e=>({default:e.Dashboard}))),V=t.lazy(()=>N(()=>import("./ScanPage-DrD1uUt0.js"),__vite__mapDeps([8,1,2,3,4,5,6,7])).then(e=>({default:e.ScanPage}))),q=t.lazy(()=>N(()=>import("./inspection-Bd6L4SDO.js").then(e=>e.a),__vite__mapDeps([7,1,2,5,3,4])).then(e=>({default:e.InspectionPage}))),M=t.lazy(()=>N(()=>import("./reports-CYvdUc55.js").then(e=>e.R),__vite__mapDeps([6,1,2,3,4,5,7])).then(e=>({default:e.ReportsPage}))),Q=t.lazy(()=>N(()=>import("./reports-CYvdUc55.js").then(e=>e.A),__vite__mapDeps([6,1,2,3,4,5,7])).then(e=>({default:e.AnalyticsPage}))),B=t.lazy(()=>N(()=>import("./ProfilePage-CrZ9b7MC.js"),__vite__mapDeps([9,1,2,3,4,5,6,7])).then(e=>({default:e.ProfilePage}))),G=t.lazy(()=>N(()=>import("./LocationsListPage-COzsmXE_.js"),__vite__mapDeps([10,1,2,3,4,5,6,7])).then(e=>({default:e.LocationsListPage}))),H=t.lazy(()=>N(()=>import("./AddLocationPage-D6L-n3bC.js"),__vite__mapDeps([11,1,2,3,4,5,6,7])).then(e=>({default:e.AddLocationPage}))),W=t.lazy(()=>N(()=>import("./admin-DxXcpQLf.js").then(e=>e.L),__vite__mapDeps([3,1,2,4,5])).then(e=>({default:e.LocationsManager}))),U=t.lazy(()=>N(()=>import("./admin-DxXcpQLf.js").then(e=>e.A),__vite__mapDeps([3,1,2,4,5])).then(e=>({default:e.AdminDashboard}))),$=t.lazy(()=>N(()=>import("./admin-DxXcpQLf.js").then(e=>e.Q),__vite__mapDeps([3,1,2,4,5])).then(e=>({default:e.QRCodeGenerator}))),J=new S({defaultOptions:{queries:{refetchOnWindowFocus:!1,retry:1,onError:e=>{k.error("React Query error",e)}},mutations:{retry:0,onError:e=>{k.error("React Query mutation error",e)}}}}),K=()=>r.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),r.jsx("p",{className:"text-gray-600",children:"Loading..."})]})}),Y=()=>r.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:r.jsxs("div",{className:"text-center",children:[r.jsx("h1",{className:"text-6xl font-bold text-gray-300 mb-4",children:"404"}),r.jsx("p",{className:"text-gray-600 mb-4",children:"Page not found"}),r.jsx("a",{href:"/",className:"text-blue-600 hover:underline font-medium",children:"Back to Dashboard"})]})});function X(){const{user:e}=I();return r.jsx(t.Suspense,{fallback:r.jsx(K,{}),children:r.jsxs(b,{children:[r.jsx(j,{path:"/login",element:e?r.jsx(y,{to:"/",replace:!0}):r.jsx(D,{})}),r.jsx(j,{path:"/register",element:e?r.jsx(y,{to:"/",replace:!0}):r.jsx(F,{})}),r.jsx(j,{path:"/",element:e?r.jsx(z,{}):r.jsx(y,{to:"/login",replace:!0})}),r.jsx(j,{path:"/dashboard",element:e?r.jsx(y,{to:"/",replace:!0}):r.jsx(y,{to:"/login",replace:!0})}),r.jsx(j,{path:"/scan",element:e?r.jsx(V,{}):r.jsx(y,{to:"/login",replace:!0})}),r.jsx(j,{path:"/inspect/:locationId",element:e?r.jsx(q,{}):r.jsx(y,{to:"/login",replace:!0})}),r.jsx(j,{path:"/reports",element:e?r.jsx(M,{}):r.jsx(y,{to:"/login",replace:!0})}),r.jsx(j,{path:"/history",element:e?r.jsx(M,{}):r.jsx(y,{to:"/login",replace:!0})}),r.jsx(j,{path:"/analytics",element:e?r.jsx(Q,{}):r.jsx(y,{to:"/login",replace:!0})}),r.jsx(j,{path:"/locations",element:e?r.jsx(G,{}):r.jsx(y,{to:"/login",replace:!0})}),r.jsx(j,{path:"/locations/add",element:e?r.jsx(H,{}):r.jsx(y,{to:"/login",replace:!0})}),r.jsx(j,{path:"/admin/locations",element:e?r.jsx(W,{}):r.jsx(y,{to:"/login",replace:!0})}),r.jsx(j,{path:"/profile",element:e?r.jsx(B,{}):r.jsx(y,{to:"/login",replace:!0})}),r.jsx(j,{path:"/admin",element:e?r.jsx(U,{}):r.jsx(y,{to:"/login",replace:!0})}),r.jsx(j,{path:"/admin/QRCodeGenerator",element:e?r.jsx($,{}):r.jsx(y,{to:"/login",replace:!0})}),r.jsx(j,{path:"*",element:r.jsx(Y,{})})]})})}function Z(){return k.info("App initialized",{env:"production",version:"1.0.0"}),r.jsx(p,{client:J,children:r.jsx(f,{children:r.jsxs(O,{children:[r.jsx(X,{}),r.jsx(C,{}),r.jsx(g,{position:"top-center",toastOptions:{duration:3e3,style:{background:"#363636",color:"#fff",borderRadius:"12px"},success:{iconTheme:{primary:"#10b981",secondary:"#fff"}},error:{iconTheme:{primary:"#ef4444",secondary:"#fff"}}}})]})})})}L.validateOnStartup(),w.createRoot(document.getElementById("root")).render(r.jsx(v.StrictMode,{children:r.jsx(Z,{})}));
